<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on 暮鼓晨钟</title><link>https://caijemmy.github.io/post/</link><description>Recent content in Posts on 暮鼓晨钟</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Wed, 24 Jul 2024 00:00:00 +0000</lastBuildDate><atom:link href="https://caijemmy.github.io/post/index.xml" rel="self" type="application/rss+xml"/><item><title>1.0 nginx</title><link>https://caijemmy.github.io/p/1.0-nginx/</link><pubDate>Wed, 24 Jul 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/1.0-nginx/</guid><description>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/cover.jpg" alt="Featured image of post 1.0 nginx" />&lt;h2 id="nginx-安装">nginx 安装
&lt;/h2>&lt;p>常用版本4大阵营&lt;/p>
&lt;ul>
&lt;li>Nginx开源版本：&lt;a class="link" href="https://nginx.org/" target="_blank" rel="noopener"
>nginx&lt;/a>&lt;/li>
&lt;li>Nginx plus 商业版：&lt;a class="link" href="https://www.f5.com/go/product/welcome-to-nginx" target="_blank" rel="noopener"
>Welcome to F5 NGINX&lt;/a>&lt;/li>
&lt;li>openresty：&lt;a class="link" href="https://openresty.org/cn/" target="_blank" rel="noopener"
>OpenResty® - 开源官方站&lt;/a>&lt;/li>
&lt;li>Tengine：&lt;a class="link" href="https://tengine.taobao.org/" target="_blank" rel="noopener"
>The Tengine Web Server&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>安装参考链接：&lt;a class="link" href="https://nginx.org/en/linux_packages.html#Debian" target="_blank" rel="noopener"
>nginx：Linux 软件包&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 前提条件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install curl gnupg2 ca-certificates lsb-release debian-archive-keyring
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 导入官方 nginx 签名密钥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl https://nginx.org/keys/nginx_signing.key &lt;span class="p">|&lt;/span> gpg --dearmor &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="p">|&lt;/span> sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg &amp;gt;/dev/null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 验证下载的文件是否包含正确的密钥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pub rsa4096 2024-05-29 &lt;span class="o">[&lt;/span>SC&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 8540A6F18833A80E9C1653A42FD21310B49F6B46
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uid nginx signing key &amp;lt;signing-key-2@nginx.com&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pub rsa2048 2011-08-19 &lt;span class="o">[&lt;/span>SC&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>expires: 2027-05-24&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 573BFD6B3D8FBC641079A6ABABF5BD827BD9BF62
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uid nginx signing key &amp;lt;signing-key@nginx.com&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pub rsa4096 2024-05-29 &lt;span class="o">[&lt;/span>SC&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 9E9BE90EACBCDE69FE9B204CBCDCD8A38D88A2B3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uid nginx signing key &amp;lt;signing-key-3@nginx.com&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 为稳定的 nginx 软件包设置 apt 存储库&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">http://nginx.org/packages/debian `lsb_release -cs` nginx&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="p">|&lt;/span> sudo tee /etc/apt/sources.list.d/nginx.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装 nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="nginx-启动及验证">nginx 启动及验证
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 启动&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# /usr/sbin/nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# ps -ef&lt;span class="p">|&lt;/span>grep nginx &lt;span class="p">|&lt;/span> grep -v grep
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root &lt;span class="m">6683&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">0&lt;/span> 19:54 ? 00:00:00 nginx: master process /usr/sbin/nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx &lt;span class="m">6684&lt;/span> &lt;span class="m">6683&lt;/span> &lt;span class="m">0&lt;/span> 19:54 ? 00:00:00 nginx: worker process
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx &lt;span class="m">6685&lt;/span> &lt;span class="m">6683&lt;/span> &lt;span class="m">0&lt;/span> 19:54 ? 00:00:00 nginx: worker process
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx &lt;span class="m">6686&lt;/span> &lt;span class="m">6683&lt;/span> &lt;span class="m">0&lt;/span> 19:54 ? 00:00:00 nginx: worker process
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx &lt;span class="m">6687&lt;/span> &lt;span class="m">6683&lt;/span> &lt;span class="m">0&lt;/span> 19:54 ? 00:00:00 nginx: worker process
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>vmware 上配置本地端口到虚机端口的映射&lt;/li>
&lt;li>虚机上如果有防火墙，注意防火墙的配置&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-nginx%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E6%88%90%E5%8A%9F.png"
width="1134"
height="406"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-nginx%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E6%88%90%E5%8A%9F_hu_91a04b10d8fb7700.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-nginx%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E6%88%90%E5%8A%9F_hu_69a4874d1e3ba54f.png 1024w"
loading="lazy"
alt="image-nginx服务启动成功"
class="gallery-image"
data-flex-grow="279"
data-flex-basis="670px"
>&lt;/p>
&lt;h3 id="配置启动服务">配置启动服务
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看/lib/systemd/system/nginx.service 或 /usr/lib/systemd/system/nginx.service 文件是否存在&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 注意安装路径的修改&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Unit&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Description&lt;/span>&lt;span class="o">=&lt;/span>nginx - high performance web server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Documentation&lt;/span>&lt;span class="o">=&lt;/span>https://nginx.org/en/docs/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">After&lt;/span>&lt;span class="o">=&lt;/span>network-online.target remote-fs.target nss-lookup.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Wants&lt;/span>&lt;span class="o">=&lt;/span>network-online.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Service&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Type&lt;/span>&lt;span class="o">=&lt;/span>forking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">PIDFile&lt;/span>&lt;span class="o">=&lt;/span>/run/nginx.pid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Environment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;CONFFILE=/etc/nginx/nginx.conf&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">EnvironmentFile&lt;/span>&lt;span class="o">=&lt;/span>-/etc/default/nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>/usr/sbin/nginx -c &lt;span class="si">${&lt;/span>&lt;span class="nv">CONFFILE&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecReload&lt;/span>&lt;span class="o">=&lt;/span>/bin/sh -c &lt;span class="s2">&amp;#34;/bin/kill -s HUP &lt;/span>&lt;span class="k">$(&lt;/span>/bin/cat /run/nginx.pid&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStop&lt;/span>&lt;span class="o">=&lt;/span>/bin/sh -c &lt;span class="s2">&amp;#34;/bin/kill -s TERM &lt;/span>&lt;span class="k">$(&lt;/span>/bin/cat /run/nginx.pid&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecQuit&lt;/span>&lt;span class="o">=&lt;/span>/bin/sh -c &lt;span class="s2">&amp;#34;/bin/kill -s QUIT &lt;/span>&lt;span class="k">$(&lt;/span>/bin/cat /run/nginx.pid&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Install&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">WantedBy&lt;/span>&lt;span class="o">=&lt;/span>multi-user.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看服务是否可用，开机自启动&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl status nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="nginx-常用命令">nginx 常用命令
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看版本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# nginx -v
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx version: nginx/1.28.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 停止命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# nginx -s stop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# ps -ef&lt;span class="p">|&lt;/span>grep nginx &lt;span class="p">|&lt;/span> grep -v grep
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 启动命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# /usr/sbin/nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# ps -ef&lt;span class="p">|&lt;/span>grep nginx &lt;span class="p">|&lt;/span> grep -v grep
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root &lt;span class="m">6797&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">0&lt;/span> 20:21 ? 00:00:00 nginx: master process /usr/sbin/nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx &lt;span class="m">6798&lt;/span> &lt;span class="m">6797&lt;/span> &lt;span class="m">0&lt;/span> 20:21 ? 00:00:00 nginx: worker process
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx &lt;span class="m">6799&lt;/span> &lt;span class="m">6797&lt;/span> &lt;span class="m">0&lt;/span> 20:21 ? 00:00:00 nginx: worker process
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx &lt;span class="m">6800&lt;/span> &lt;span class="m">6797&lt;/span> &lt;span class="m">0&lt;/span> 20:21 ? 00:00:00 nginx: worker process
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx &lt;span class="m">6801&lt;/span> &lt;span class="m">6797&lt;/span> &lt;span class="m">0&lt;/span> 20:21 ? 00:00:00 nginx: worker process
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置重新加载&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# /usr/sbin/nginx -s reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# ps -ef&lt;span class="p">|&lt;/span>grep nginx &lt;span class="p">|&lt;/span> grep -v grep
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root &lt;span class="m">6797&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="m">0&lt;/span> 20:21 ? 00:00:00 nginx: master process /usr/sbin/nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx &lt;span class="m">6809&lt;/span> &lt;span class="m">6797&lt;/span> &lt;span class="m">0&lt;/span> 20:23 ? 00:00:00 nginx: worker process
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx &lt;span class="m">6810&lt;/span> &lt;span class="m">6797&lt;/span> &lt;span class="m">0&lt;/span> 20:23 ? 00:00:00 nginx: worker process
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx &lt;span class="m">6811&lt;/span> &lt;span class="m">6797&lt;/span> &lt;span class="m">0&lt;/span> 20:23 ? 00:00:00 nginx: worker process
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx &lt;span class="m">6812&lt;/span> &lt;span class="m">6797&lt;/span> &lt;span class="m">0&lt;/span> 20:23 ? 00:00:00 nginx: worker process
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置默认路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# ls -l /etc/nginx/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">28&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">2&lt;/span> root root &lt;span class="m">4096&lt;/span> May &lt;span class="m">17&lt;/span> 19:39 conf.d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">1007&lt;/span> Apr &lt;span class="m">23&lt;/span> 07:48 fastcgi_params
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">5349&lt;/span> Apr &lt;span class="m">23&lt;/span> 07:48 mime.types
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lrwxrwxrwx &lt;span class="m">1&lt;/span> root root &lt;span class="m">22&lt;/span> Apr &lt;span class="m">23&lt;/span> 08:39 modules -&amp;gt; /usr/lib/nginx/modules
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">644&lt;/span> Apr &lt;span class="m">23&lt;/span> 08:39 nginx.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">636&lt;/span> Apr &lt;span class="m">23&lt;/span> 07:48 scgi_params
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">664&lt;/span> Apr &lt;span class="m">23&lt;/span> 07:48 uwsgi_params
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="停止nginx的其他方式">停止nginx的其他方式
&lt;/h3>&lt;p>参考链接：&lt;a class="link" href="https://nginx.org/en/docs/beginners_guide.html" target="_blank" rel="noopener"
>Beginner’s Guide&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># to stop nginx processes with waiting for the worker processes to finish serving current requests&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx -s quit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 通过 kill 命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span> -f /var/run/nginx.pid &lt;span class="o">]&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> cat /var/run/nginx.pid &lt;span class="p">|&lt;/span> xargs &lt;span class="nb">kill&lt;/span> -s QUIT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看nginx资源使用情况&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ps axw -o pid,ppid,user,%cpu,vsz,wchan,command &lt;span class="p">|&lt;/span> egrep &lt;span class="s1">&amp;#39;(nginx|PID)&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="配置文件">配置文件
&lt;/h2>&lt;p>指令种类：简单指令，块指令。&lt;/p>
&lt;p>全局块：就是最开始的简单指令。从配置文件开始到events&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">user nginx&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker_processes auto&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">error_log /var/log/nginx/error.log notice&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pid /run/nginx.pid&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>events块：配置服务器和用户网络连接相关的参数。&lt;/p>
&lt;p>http块：配置代理、缓存、日志及第三方模块等。&lt;/p>
&lt;h3 id="最小化配置文件">最小化配置文件
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cat /etc/nginx/nginx.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user nginx&lt;span class="p">;&lt;/span> &lt;span class="c1"># worker进程启动时以哪个用户启动，限制 worker 进程的权限，提高安全性。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">worker_processes auto&lt;span class="p">;&lt;/span> &lt;span class="c1"># 启动nginx时，启动多少个worker进程，设置为 CPU 核心数或 2 倍 CPU 核心数。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">error_log /var/log/nginx/error.log notice&lt;span class="p">;&lt;/span> &lt;span class="c1"># 指定错误日志的路径和日志级别。notice 表示记录 notice 级别及以上的日志（如 notice、warn、error）。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pid /run/nginx.pid&lt;span class="p">;&lt;/span> &lt;span class="c1"># 指定存储 Nginx 主进程 PID 的文件路径。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">events &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> worker_connections 1024&lt;span class="p">;&lt;/span> &lt;span class="c1"># 设置每个 worker 进程的最大连接数。总并发连接数 = worker_processes × worker_connections。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">http &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include /etc/nginx/mime.types&lt;span class="p">;&lt;/span> &lt;span class="c1"># 包含MIME类型配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default_type application/octet-stream&lt;span class="p">;&lt;/span> &lt;span class="c1"># 默认的MIME类型&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> log_format main &lt;span class="s1">&amp;#39;$remote_addr - $remote_user [$time_local] &amp;#34;$request&amp;#34; &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;$status $body_bytes_sent &amp;#34;$http_referer&amp;#34; &amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#34;$http_user_agent&amp;#34; &amp;#34;$http_x_forwarded_for&amp;#34;&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># 定义日志格式。main 是日志格式的名称，后面是具体的格式字符串。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> access_log /var/log/nginx/access.log main&lt;span class="p">;&lt;/span> &lt;span class="c1"># 指定访问日志的路径和日志格式。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sendfile on&lt;span class="p">;&lt;/span> &lt;span class="c1"># 启用 sendfile 机制，直接通过内核发送文件，减少用户态和内核态之间的数据拷贝。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#tcp_nopush on; # 启用 TCP_NOPUSH 选项，确保数据包填满后再发送&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> keepalive_timeout 65&lt;span class="p">;&lt;/span> &lt;span class="c1"># 设置客户端保持连接的超时时间（单位为秒）。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#gzip on; # 启用 gzip 压缩&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> include /etc/nginx/conf.d/*.conf&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># /etc/nginx/conf.d/default.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># server 块可以是多个&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 80&lt;span class="p">;&lt;/span> &lt;span class="c1"># 指定 Nginx 监听的端口号。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name localhost&lt;span class="p">;&lt;/span> &lt;span class="c1"># 指定服务器的域名或主机名。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#access_log /var/log/nginx/host.access.log main;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># location 块可以是多个&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / &lt;span class="o">{&lt;/span> &lt;span class="c1"># 定义根路径（/）的请求处理规则。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /usr/share/nginx/html&lt;span class="p">;&lt;/span> &lt;span class="c1"># 指定根路径的静态文件存储目录。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> index index.html index.htm&lt;span class="p">;&lt;/span> &lt;span class="c1"># 指定默认的索引文件。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#error_page 404 /404.html;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># redirect server error pages to the static page /50x.html&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> error_page &lt;span class="m">500&lt;/span> &lt;span class="m">502&lt;/span> &lt;span class="m">503&lt;/span> &lt;span class="m">504&lt;/span> /50x.html&lt;span class="p">;&lt;/span> &lt;span class="c1"># 定义当服务器返回 500、502、503 或 504 错误时，重定向到 /50x.html 页面。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">location&lt;/span> &lt;span class="o">=&lt;/span> /50x.html &lt;span class="o">{&lt;/span> &lt;span class="c1"># 定义 /50x.html 路径的请求处理规则。= 表示精确匹配。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /usr/share/nginx/html&lt;span class="p">;&lt;/span> &lt;span class="c1"># 指定 /50x.html 文件的存储目录。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># proxy the PHP scripts to Apache listening on 127.0.0.1:80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#location ~ \.php$ { # 匹配所有以 .php 结尾的请求路径。~ 表示正则表达式匹配。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># proxy_pass http://127.0.0.1; # 将 PHP 请求代理到 http://127.0.0.1（通常是 Apache 服务器）。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#location ~ \.php$ { # 匹配所有以 .php 结尾的请求路径。~ 表示正则表达式匹配。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># root html; # 指定根路径的静态文件存储目录。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># fastcgi_pass 127.0.0.1:9000; # 将 PHP 请求转发给 FastCGI 服务器（如 PHP-FPM）处理。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># fastcgi_index index.php; # 指定FastCGI 服务器默认的索引文件。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; # 设置 FastCGI 参数，指定 PHP 脚本的路径。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># include fastcgi_params; # 包含 FastCGI 的默认参数配置文件。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># deny access to .htaccess files, if Apache&amp;#39;s document root&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># concurs with nginx&amp;#39;s one&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#location ~ /\.ht { # 匹配所有以 .ht 开头的文件路径（如 .htaccess）。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># deny all; # 禁止访问匹配的文件。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="反向代理">反向代理
&lt;/h2>&lt;h3 id="单台代理">单台代理
&lt;/h3>&lt;h4 id="目标">目标
&lt;/h4>&lt;ul>
&lt;li>在浏览器访问一个地址: http://127.0.0.1:3000/。&lt;/li>
&lt;li>Nginx接受上面的请求。&lt;/li>
&lt;li>转发请求到tomcat。&lt;/li>
&lt;li>tomcat响应一个页面，页面中有：&amp;ldquo;tomcat hello !!!&amp;quot;。&lt;/li>
&lt;/ul>
&lt;h4 id="操作步骤1安装tomcat">操作步骤1：安装tomcat
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装java&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install openjdk-17-jdk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装tomcat&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# wget https://dlcdn.apache.org/tomcat/tomcat-11/v11.0.7/bin/apache-tomcat-11.0.7.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# sudo tar -xzf apache-tomcat-11.0.7.tar.gz -C /opt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# sudo mv /opt/apache-tomcat-11.0.7/ /opt/tomcat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置环境变量&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat# vim /etc/profile
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> -d /opt/tomcat &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">export&lt;/span> &lt;span class="nv">CATALINA_HOME&lt;/span>&lt;span class="o">=&lt;/span>/opt/tomcat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$PATH&lt;/span>:&lt;span class="nv">$CATALINA_HOME&lt;/span>/bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建tomcat用户&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat# sudo useradd -r -m -U -d /opt/tomcat -s /bin/false tomcat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">useradd: warning: the home directory /opt/tomcat already exists.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">useradd: Not copying any file from skel directory into it.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat# sudo chown -R tomcat: /opt/tomcat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置tomcat服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat# vim /etc/systemd/system/tomcat.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Unit&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Description&lt;/span>&lt;span class="o">=&lt;/span>Apache Tomcat Web Application Container
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">After&lt;/span>&lt;span class="o">=&lt;/span>network.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Service&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Type&lt;/span>&lt;span class="o">=&lt;/span>forking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">User&lt;/span>&lt;span class="o">=&lt;/span>tomcat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Group&lt;/span>&lt;span class="o">=&lt;/span>tomcat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Environment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Environment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;CATALINA_PID=/opt/tomcat/temp/tomcat.pid&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Environment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;CATALINA_HOME=/opt/tomcat&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Environment&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;CATALINA_BASE=/opt/tomcat&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>/opt/tomcat/bin/startup.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStop&lt;/span>&lt;span class="o">=&lt;/span>/opt/tomcat/bin/shutdown.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">RestartSec&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Restart&lt;/span>&lt;span class="o">=&lt;/span>always
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Install&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">WantedBy&lt;/span>&lt;span class="o">=&lt;/span>multi-user.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 生成目标页面&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~ &lt;span class="c1"># cd /opt/tomcat/webapps/ROOT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat/webapps/ROOT# vim index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tomcat hello !!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 启动服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat# sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat# sudo systemctl start tomcat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat# sudo systemctl status tomcat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">● tomcat.service - Apache Tomcat Web Application Container
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Loaded: loaded &lt;span class="o">(&lt;/span>/etc/systemd/system/tomcat.service&lt;span class="p">;&lt;/span> disabled&lt;span class="p">;&lt;/span> preset: enabled&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Active: active &lt;span class="o">(&lt;/span>running&lt;span class="o">)&lt;/span> since Mon 2025-05-19 09:36:27 EDT&lt;span class="p">;&lt;/span> 5s ago
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Process: &lt;span class="m">2271&lt;/span> &lt;span class="nv">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>/opt/tomcat/bin/startup.sh &lt;span class="o">(&lt;/span>&lt;span class="nv">code&lt;/span>&lt;span class="o">=&lt;/span>exited, &lt;span class="nv">status&lt;/span>&lt;span class="o">=&lt;/span>0/SUCCESS&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Main PID: &lt;span class="m">2278&lt;/span> &lt;span class="o">(&lt;/span>java&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tasks: &lt;span class="m">38&lt;/span> &lt;span class="o">(&lt;/span>limit: 2241&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Memory: 80.5M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CPU: 2.304s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CGroup: /system.slice/tomcat.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └─2278 /usr/lib/jvm/java-17-openjdk-amd64/bin/java -Djava.util.logging.config.file&lt;span class="o">=&lt;/span>/opt/tomcat/conf/logging.properties -Djava.util.logging.m&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">May &lt;span class="m">19&lt;/span> 09:36:27 debian systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: Starting tomcat.service - Apache Tomcat Web Application Container...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">May &lt;span class="m">19&lt;/span> 09:36:27 debian startup.sh&lt;span class="o">[&lt;/span>2271&lt;span class="o">]&lt;/span>: Tomcat started.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">May &lt;span class="m">19&lt;/span> 09:36:27 debian systemd&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>: Started tomcat.service - Apache Tomcat Web Application Container.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 本地验证&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat/webapps/ROOT# curl localhost:8080/index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tomcat hello !!!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="操作步骤2nginx配置">操作步骤2：nginx配置
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置nginx代理地址:端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat/webapps/ROOT# &lt;span class="nb">cd&lt;/span> /etc/nginx/conf.d/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/etc/nginx/conf.d# vim default.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># root /usr/share/nginx/html;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># index index.html index.htm;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://127.0.0.1:8080&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 重新加载nginx配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/etc/nginx/conf.d# /usr/sbin/nginx -s reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="操作步骤3本地验证">操作步骤3：本地验证
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\Y&lt;/span>Y&amp;gt;curl http://127.0.0.1:3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tomcat hello !!!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%811.png"
width="698"
height="289"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%811_hu_b1ad05c57644e02.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%811_hu_71c80484568c822e.png 1024w"
loading="lazy"
alt="image-反向代理验证1"
class="gallery-image"
data-flex-grow="241"
data-flex-basis="579px"
>&lt;/p>
&lt;h3 id="多台代理">多台代理
&lt;/h3>&lt;h4 id="目标-1">目标
&lt;/h4>&lt;ul>
&lt;li>浏览器访问：（http://127.0.0.1:3000/beijing），通过nginx，跳转到一个tomcat上 （http://localhost:8081），在浏览器上显示：beijing。&lt;/li>
&lt;li>浏览器访问：（http://127.0.0.1:3000/shanghai），通过nginx，跳转到一个tomcat上（http://localhost:8082），在浏览器上显示：shanghai&lt;/li>
&lt;/ul>
&lt;h4 id="操作步骤1安装tomcat-1">操作步骤1：安装tomcat
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在单台代理的基础上，拷贝两个tomcat，再配置两个tomcat&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8081/conf# vim server.xml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;Server &lt;span class="nv">port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;8015&amp;#34;&lt;/span> &lt;span class="nv">shutdown&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;SHUTDOWN&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;Connector &lt;span class="nv">port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;8081&amp;#34;&lt;/span> &lt;span class="nv">protocol&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;HTTP/1.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">connectionTimeout&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;20000&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">redirectPort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;8443&amp;#34;&lt;/span> /&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8082/conf# vim server.xml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;Server &lt;span class="nv">port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;8025&amp;#34;&lt;/span> &lt;span class="nv">shutdown&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;SHUTDOWN&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;Connector &lt;span class="nv">port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;8082&amp;#34;&lt;/span> &lt;span class="nv">protocol&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;HTTP/1.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">connectionTimeout&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;20000&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">redirectPort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;8453&amp;#34;&lt;/span> /&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 停止tomcat&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8082/conf# systemctl stop tomcat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8082/conf# systemctl status tomcat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">○ tomcat.service - Apache Tomcat Web Application Container
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Loaded: loaded &lt;span class="o">(&lt;/span>/etc/systemd/system/tomcat.service&lt;span class="p">;&lt;/span> disabled&lt;span class="p">;&lt;/span> preset: enabled&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Active: inactive &lt;span class="o">(&lt;/span>dead&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改html文件内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8081/webapps/beijing &lt;span class="c1"># vim index.html&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">beijing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8082/webapps/shanghai &lt;span class="c1"># vim index.html&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">shanghai
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 启动服务并验证&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">CATALINA_HOME&lt;/span>&lt;span class="o">=&lt;/span>/opt/tomcat8081
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$CATALINA_HOME&lt;/span>/bin:&lt;span class="nv">$PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8081# ./bin/startup.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8081# curl http://localhost:8081
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">beijing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">CATALINA_HOME&lt;/span>&lt;span class="o">=&lt;/span>/opt/tomcat8082
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$CATALINA_HOME&lt;/span>/bin:&lt;span class="nv">$PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8082# ./bin/startup.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8082# curl http://localhost:8082
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">shanghai
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="操作步骤2nginx配置-1">操作步骤2：nginx配置
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置nginx代理地址:端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat/webapps/ROOT# &lt;span class="nb">cd&lt;/span> /etc/nginx/conf.d/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/etc/nginx/conf.d# vim default.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location ~ /beijing/ &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://127.0.0.1:8081&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location ~ /shanghai/ &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://127.0.0.1:8082&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># root /usr/share/nginx/html;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># index index.html index.htm;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://127.0.0.1:8080&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 重新加载nginx配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/etc/nginx/conf.d# /usr/sbin/nginx -s reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="操作步骤3本地验证-1">操作步骤3：本地验证
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\Y&lt;/span>Y&amp;gt;curl http://127.0.0.1:3000/shanghai/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">shanghai
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\Y&lt;/span>Y&amp;gt;curl http://127.0.0.1:3000/shanghai/index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">shanghai
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\Y&lt;/span>Y&amp;gt;curl http://127.0.0.1:3000/beijing/index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">beijing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\Y&lt;/span>Y&amp;gt;curl http://127.0.0.1:3000/beijing/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">beijing
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%81%E5%A4%9A%E5%8F%B01.png"
width="701"
height="158"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%81%E5%A4%9A%E5%8F%B01_hu_2aeff50651581a00.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%81%E5%A4%9A%E5%8F%B01_hu_85bec14e5a55d61.png 1024w"
loading="lazy"
alt="image-反向代理验证多台1"
class="gallery-image"
data-flex-grow="443"
data-flex-basis="1064px"
>&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%81%E5%A4%9A%E5%8F%B02.png"
width="784"
height="170"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%81%E5%A4%9A%E5%8F%B02_hu_2583ff73fbb9165a.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%81%E5%A4%9A%E5%8F%B02_hu_1f3a8ffdab141b91.png 1024w"
loading="lazy"
alt="image-反向代理验证多台2"
class="gallery-image"
data-flex-grow="461"
data-flex-basis="1106px"
>&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%81%E5%A4%9A%E5%8F%B03.png"
width="659"
height="152"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%81%E5%A4%9A%E5%8F%B03_hu_496c4dc84b1c6863.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%81%E5%A4%9A%E5%8F%B03_hu_5a4597dc6b12f832.png 1024w"
loading="lazy"
alt="image-反向代理验证多台3"
class="gallery-image"
data-flex-grow="433"
data-flex-basis="1040px"
>&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%81%E5%A4%9A%E5%8F%B04.png"
width="798"
height="153"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%81%E5%A4%9A%E5%8F%B04_hu_1b2d73a83bc8d029.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%AA%8C%E8%AF%81%E5%A4%9A%E5%8F%B04_hu_b7817ab95575409c.png 1024w"
loading="lazy"
alt="image-反向代理验证多台4"
class="gallery-image"
data-flex-grow="521"
data-flex-basis="1251px"
>&lt;/p>
&lt;h2 id="负载均衡">负载均衡
&lt;/h2>&lt;h3 id="目标-2">目标
&lt;/h3>&lt;ul>
&lt;li>通过浏览器多次访问一个地址（http://www.cainiao.com/load-balance）。&lt;/li>
&lt;li>nginx接受上面的请求，并进行转发。&lt;/li>
&lt;li>那么每个请求的响应，是来自于不同的tomcat提供的。（2台tomcat，端口：8081，8082）。 两台tomcat，不同的响应内容：“8081”和“8082”。&lt;/li>
&lt;/ul>
&lt;h3 id="操作步骤">操作步骤
&lt;/h3>&lt;h4 id="部署tomcat">部署tomcat
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 还是使用多台代理时的tomcat&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# &lt;span class="nb">cd&lt;/span> /opt/tomcat8081/webapps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8081/webapps# mkdir load-balance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8081/webapps# vim load-balance/index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">8081&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# &lt;span class="nb">cd&lt;/span> /opt/tomcat8082/webapps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8082/webapps# mkdir load-balance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8082/webapps# vim load-balance/index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">8082&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 启动服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">CATALINA_HOME&lt;/span>&lt;span class="o">=&lt;/span>/opt/tomcat8081
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$CATALINA_HOME&lt;/span>/bin:&lt;span class="nv">$PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8081# /opt/tomcat8081/bin/startup.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">CATALINA_HOME&lt;/span>&lt;span class="o">=&lt;/span>/opt/tomcat8082
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$CATALINA_HOME&lt;/span>/bin:&lt;span class="nv">$PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8082# /opt/tomcat8082/bin/startup.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8082# curl http://127.0.0.1/load-balance/index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">8081&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8082# curl http://127.0.0.1/load-balance/index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">8082&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置nginx">配置nginx
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:/opt/tomcat8082# cat /etc/nginx/conf.d/default.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># upstream 要配置在http块中&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">upstream myServers &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server 127.0.0.1:8081&lt;span class="p">;&lt;/span> &lt;span class="c1"># server 指令只能指定 IP 地址（或域名）和端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server 127.0.0.1:8082&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 80&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name localhost&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># root /usr/share/nginx/html;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># index index.html index.htm;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://myServers&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 重新加载服务配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/etc/nginx/conf.d# /usr/sbin/nginx -s reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>注意&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>upstream 要配置在http块中&lt;/li>
&lt;li>upstream 的server 指令只能指定 IP 地址（或域名）和端口&lt;/li>
&lt;/ul>
&lt;h4 id="验证">验证
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\Y&lt;/span>Y&amp;gt;curl http://127.0.0.1:3000/load-balance/index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">8081&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\U&lt;/span>sers&lt;span class="se">\Y&lt;/span>Y&amp;gt;curl http://127.0.0.1:3000/load-balance/index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">8082&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%AA%8C%E8%AF%811.png"
width="851"
height="156"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%AA%8C%E8%AF%811_hu_e88eccb4f1276ab.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%AA%8C%E8%AF%811_hu_20f21a5154f24930.png 1024w"
loading="lazy"
alt="image-负载均衡验证1"
class="gallery-image"
data-flex-grow="545"
data-flex-basis="1309px"
>&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%AA%8C%E8%AF%812.png"
width="874"
height="141"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%AA%8C%E8%AF%812_hu_d1d840b9ae3405db.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%AA%8C%E8%AF%812_hu_69ce617b94182124.png 1024w"
loading="lazy"
alt="image-负载均衡验证2"
class="gallery-image"
data-flex-grow="619"
data-flex-basis="1487px"
>&lt;/p>
&lt;h3 id="负载均衡的方法算法">负载均衡的方法（算法）
&lt;/h3>&lt;p>参考链接：https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/&lt;/p>
&lt;h4 id="round-robin">Round Robin
&lt;/h4>&lt;p>Requests are distributed evenly across the servers, with &lt;a class="link" href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/#weights" target="_blank" rel="noopener"
>server weights&lt;/a> taken into consideration. This method is used by default (there is no directive for enabling it)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">upstream backend &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># no load balancing method is specified for Round Robin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend1.example.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend2.example.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="least-connections">Least Connections
&lt;/h4>&lt;p>A request is sent to the server with the least number of active connections, again with &lt;a class="link" href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/#weights" target="_blank" rel="noopener"
>server weights&lt;/a> taken into consideration&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">upstream backend &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> least_conn&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend1.example.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend2.example.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ip-hash">IP Hash
&lt;/h4>&lt;p>The server to which a request is sent is determined from the client IP address. In this case, either the first three octets of the IPv4 address or the whole IPv6 address are used to calculate the hash value. The method guarantees that requests from the same address get to the same server unless it is not available.&lt;/p>
&lt;p>通过这种方式，客户端的请求会转发到同一台服务器上&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">upstream backend &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip_hash&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend1.example.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend2.example.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend3.example.com down&lt;span class="p">;&lt;/span> &lt;span class="c1"># 如果一台服务器不能整体提供服务，自动转发到下一台服务器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="generic-hash">Generic Hash
&lt;/h4>&lt;p>The server to which a request is sent is determined from a user‑defined key which can be a text string, variable, or a combination. For example, the key may be a paired source IP address and port, or a URI as in this example:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">upstream backend &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">hash&lt;/span> &lt;span class="nv">$request_uri&lt;/span> consistent&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend1.example.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend2.example.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="least-time-nginx-plus-only">Least Time (NGINX Plus only)
&lt;/h4>&lt;p>For each request, NGINX Plus selects the server with the lowest average latency and the lowest number of active connections, where the lowest average latency is calculated based on which of the following parameters to the least_time directive is included:&lt;/p>
&lt;p>&lt;strong>暂不涉及，使用时再查看文档&lt;/strong>&lt;/p>
&lt;h4 id="random">Random
&lt;/h4>&lt;p>Each request will be passed to a randomly selected server. If the two parameter is specified, first, NGINX randomly selects two servers taking into account server weights, and then chooses one of these servers using the specified method:&lt;/p>
&lt;ul>
&lt;li>least_conn – The least number of active connections&lt;/li>
&lt;li>least_time=header (NGINX Plus) – The least average time to receive the response header from the server ($upstream_header_time)&lt;/li>
&lt;li>least_time=last_byte (NGINX Plus) – The least average time to receive the full response from the server ($upstream_response_time)&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">upstream backend &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> random two &lt;span class="nv">least_time&lt;/span>&lt;span class="o">=&lt;/span>last_byte&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend1.example.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend2.example.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend3.example.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend4.example.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="server-weights权重">Server Weights(权重)
&lt;/h3>&lt;p>By default, NGINX distributes requests among the servers in the group according to their weights using the Round Robin method. The &lt;a class="link" href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#weight" target="_blank" rel="noopener"
>&lt;code>weight&lt;/code>&lt;/a> parameter to the &lt;a class="link" href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#server" target="_blank" rel="noopener"
>&lt;code>server&lt;/code>&lt;/a> directive sets the weight of a server; the default is &lt;code>1&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">upstream backend &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend1.example.com &lt;span class="nv">weight&lt;/span>&lt;span class="o">=&lt;/span>5&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server backend2.example.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server 192.0.0.1 backup&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># With this configuration of weights, out of every 6 requests, 5 are sent to backend1.example.com and 1 to backend2.example.com.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="动静分离">动静分离
&lt;/h2>&lt;h3 id="什么是-nginx-的动静分离">什么是 Nginx 的动静分离？
&lt;/h3>&lt;p>动静分离是指将 &lt;strong>静态资源（如 HTML、CSS、JavaScript、图片等）&lt;/strong> 和 &lt;strong>动态资源（如 PHP、Java、Python 等生成的动态内容）&lt;/strong> 分别处理，以提高服务器性能和资源利用率。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>静态资源&lt;/strong>：内容固定不变，可以直接从磁盘或缓存中读取，不需要经过后端应用服务器处理。&lt;/li>
&lt;li>&lt;strong>动态资源&lt;/strong>：内容根据请求动态生成，需要经过后端应用服务器（如 Tomcat、PHP-FPM 等）处理。&lt;/li>
&lt;/ul>
&lt;p>通过动静分离，可以将静态资源交给 Nginx 直接处理，而动态资源则转发给后端应用服务器处理，从而减轻后端服务器的压力，并提高静态资源的访问速度。&lt;/p>
&lt;h3 id="为什么要做动静分离">为什么要做动静分离？
&lt;/h3>&lt;ol>
&lt;li>&lt;strong>提高性能&lt;/strong>：Nginx 处理静态资源的性能非常高，远高于后端应用服务器。&lt;/li>
&lt;li>&lt;strong>减轻后端压力&lt;/strong>：将静态资源交给 Nginx 处理，减少后端服务器的负载。&lt;/li>
&lt;li>&lt;strong>提高用户体验&lt;/strong>：静态资源加载更快，提升页面响应速度。&lt;/li>
&lt;li>&lt;strong>便于扩展&lt;/strong>：静态资源可以单独部署到 CDN 或专门的静态资源服务器上。&lt;/li>
&lt;/ol>
&lt;h3 id="如何实现-nginx-的动静分离">如何实现 Nginx 的动静分离？
&lt;/h3>&lt;h4 id="静态资源和动态资源的分类">静态资源和动态资源的分类
&lt;/h4>&lt;ul>
&lt;li>静态资源：&lt;code>.html&lt;/code>, &lt;code>.css&lt;/code>, &lt;code>.js&lt;/code>, &lt;code>.jpg&lt;/code>, &lt;code>.png&lt;/code>, &lt;code>.gif&lt;/code>, &lt;code>.ico&lt;/code>, &lt;code>.woff&lt;/code>, &lt;code>.ttf&lt;/code> 等。&lt;/li>
&lt;li>动态资源：&lt;code>.php&lt;/code>, &lt;code>.jsp&lt;/code>, &lt;code>.do&lt;/code>, &lt;code>.py&lt;/code> 等。&lt;/li>
&lt;/ul>
&lt;h4 id="nginx-配置动静分离">Nginx 配置动静分离
&lt;/h4>&lt;p>通过 &lt;code>location&lt;/code> 块将静态资源和动态资源分别处理。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">server &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 8000&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name cainiao.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 静态资源处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location ~* &lt;span class="se">\.&lt;/span>&lt;span class="o">(&lt;/span>html&lt;span class="p">|&lt;/span>css&lt;span class="p">|&lt;/span>js&lt;span class="p">|&lt;/span>jpg&lt;span class="p">|&lt;/span>jpeg&lt;span class="p">|&lt;/span>png&lt;span class="p">|&lt;/span>gif&lt;span class="p">|&lt;/span>ico&lt;span class="p">|&lt;/span>woff&lt;span class="p">|&lt;/span>ttf&lt;span class="o">)&lt;/span>$ &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /var/www/static&lt;span class="p">;&lt;/span> &lt;span class="c1"># 静态资源存放目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> expires 30d&lt;span class="p">;&lt;/span> &lt;span class="c1"># 设置缓存过期时间&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 动态资源处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://backend_server&lt;span class="p">;&lt;/span> &lt;span class="c1"># 转发到后端应用服务器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Host &lt;span class="nv">$host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Real-IP &lt;span class="nv">$remote_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Forwarded-For &lt;span class="nv">$proxy_add_x_forwarded_for&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">upstream backend_server &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server 127.0.0.1:8080&lt;span class="p">;&lt;/span> &lt;span class="c1"># 后端应用服务器地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置说明">配置说明
&lt;/h4>&lt;ol>
&lt;li>&lt;strong>静态资源处理&lt;/strong>：
&lt;ul>
&lt;li>使用 &lt;code>location ~* \.(html|css|js|jpg|jpeg|png|gif|ico|woff|ttf)$&lt;/code> 匹配静态资源文件。&lt;/li>
&lt;li>&lt;code>root /var/www/static&lt;/code>：指定静态资源的存放目录。&lt;/li>
&lt;li>&lt;code>expires 30d&lt;/code>：设置静态资源的缓存过期时间，减少客户端请求。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>动态资源处理&lt;/strong>：
&lt;ul>
&lt;li>使用 &lt;code>location /&lt;/code> 匹配所有请求。&lt;/li>
&lt;li>&lt;code>proxy_pass http://backend_server&lt;/code>：将动态资源请求转发到后端应用服务器。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>后端服务器&lt;/strong>：
&lt;ul>
&lt;li>使用 &lt;code>upstream&lt;/code> 定义后端应用服务器组。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h4 id="测试动静分离">测试动静分离
&lt;/h4>&lt;p>&lt;strong>配置修改步骤&lt;/strong>：&lt;/p>
&lt;p>1、域名映射&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\W&lt;/span>indows&lt;span class="se">\S&lt;/span>ystem32&lt;span class="se">\d&lt;/span>rivers&lt;span class="se">\e&lt;/span>tc&lt;span class="se">\h&lt;/span>osts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1 cainiao.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>2、配置nginx&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:/etc/nginx# vim nginx.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在http模块的最后添加如下内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 8000&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name cainiao.com&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 静态资源处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location ~* &lt;span class="se">\.&lt;/span>&lt;span class="o">(&lt;/span>html&lt;span class="p">|&lt;/span>css&lt;span class="p">|&lt;/span>js&lt;span class="p">|&lt;/span>jpg&lt;span class="p">|&lt;/span>jpeg&lt;span class="p">|&lt;/span>png&lt;span class="p">|&lt;/span>gif&lt;span class="p">|&lt;/span>ico&lt;span class="p">|&lt;/span>woff&lt;span class="p">|&lt;/span>ttf&lt;span class="o">)&lt;/span>$ &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /var/www/static&lt;span class="p">;&lt;/span> &lt;span class="c1"># 静态资源存放目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> expires 30d&lt;span class="p">;&lt;/span> &lt;span class="c1"># 设置缓存过期时间&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 动态资源处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://backend_server&lt;span class="p">;&lt;/span> &lt;span class="c1"># 转发到后端应用服务器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Host &lt;span class="nv">$host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Real-IP &lt;span class="nv">$remote_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Forwarded-For &lt;span class="nv">$proxy_add_x_forwarded_for&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> upstream backend_server &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server 127.0.0.1:8080&lt;span class="p">;&lt;/span> &lt;span class="c1"># 后端应用服务器地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 重新加载服务配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/etc/nginx/conf.d# /usr/sbin/nginx -s reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>3、配置资源&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:/etc/nginx# mkdir -p /var/www/static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 上传一个名为logo.png的图片到该目录下&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>4、主机配置端口映射&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A88000%E7%AB%AF%E5%8F%A3.png"
width="888"
height="583"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A88000%E7%AB%AF%E5%8F%A3_hu_38038ea2f1c224c7.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A88000%E7%AB%AF%E5%8F%A3_hu_236a80a9eba6e487.png 1024w"
loading="lazy"
alt="image-主机配置端口映射到服务器8000端口"
class="gallery-image"
data-flex-grow="152"
data-flex-basis="365px"
>&lt;/p>
&lt;p>5、浏览器验证静态资源&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%AD%A3%E5%B8%B8%E8%BF%94%E5%9B%9E.png"
width="1964"
height="1612"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%AD%A3%E5%B8%B8%E8%BF%94%E5%9B%9E_hu_d805c8f593a5b5e3.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%AD%A3%E5%B8%B8%E8%BF%94%E5%9B%9E_hu_410b0165db76e75b.png 1024w"
loading="lazy"
alt="image-静态资源正常返回"
class="gallery-image"
data-flex-grow="121"
data-flex-basis="292px"
>&lt;/p>
&lt;p>6、浏览器验证动态资源&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90%E6%AD%A3%E5%B8%B8%E8%BF%94%E5%9B%9E.png"
width="1784"
height="811"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90%E6%AD%A3%E5%B8%B8%E8%BF%94%E5%9B%9E_hu_5d2b6ab120673d96.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90%E6%AD%A3%E5%B8%B8%E8%BF%94%E5%9B%9E_hu_c3c9f3452c817e67.png 1024w"
loading="lazy"
alt="image-动态资源正常返回"
class="gallery-image"
data-flex-grow="219"
data-flex-basis="527px"
>&lt;/p>
&lt;h3 id="进一步优化">进一步优化
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>&lt;strong>使用 CDN&lt;/strong>： 将静态资源部署到 CDN（内容分发网络），进一步提高静态资源的访问速度。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>启用 Gzip 压缩&lt;/strong>： 在 Nginx 中启用 Gzip 压缩，减少静态资源的传输大小。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">gzip on&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>设置缓存策略&lt;/strong>： 为静态资源设置合理的缓存策略，减少客户端请求。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">location ~* &lt;span class="se">\.&lt;/span>&lt;span class="o">(&lt;/span>html&lt;span class="p">|&lt;/span>css&lt;span class="p">|&lt;/span>js&lt;span class="p">|&lt;/span>jpg&lt;span class="p">|&lt;/span>jpeg&lt;span class="p">|&lt;/span>png&lt;span class="p">|&lt;/span>gif&lt;span class="p">|&lt;/span>ico&lt;span class="p">|&lt;/span>woff&lt;span class="p">|&lt;/span>ttf&lt;span class="o">)&lt;/span>$ &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /var/www/static&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> expires 30d&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add_header Cache-Control &lt;span class="s2">&amp;#34;public, no-transform&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="高可用">高可用
&lt;/h2>&lt;h3 id="架构图">架构图
&lt;/h3>&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84%E5%9B%BE.png"
width="1304"
height="805"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84%E5%9B%BE_hu_14f65318d7d8c3f3.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84%E5%9B%BE_hu_6b65b6a924b2ca90.png 1024w"
loading="lazy"
alt="image-高可用架构图"
class="gallery-image"
data-flex-grow="161"
data-flex-basis="388px"
>&lt;/p>
&lt;h3 id="环境准备">环境准备
&lt;/h3>&lt;h4 id="前提条件">前提条件
&lt;/h4>&lt;p>拷贝复制前面nginx虚机，修改虚机IP为192.168.52.70&lt;/p>
&lt;h4 id="安装keepalived">安装keepalived
&lt;/h4>&lt;p>&lt;strong>每个虚机都安装&lt;/strong>，详细可以参考：&lt;a class="link" href="https://caijemmy.github.io/p/1.0-keepalived/" target="_blank" rel="noopener"
>keepalived入门介绍&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">apt -y install keepalived
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 主节点&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/etc/keepalived# vim keepalived.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! Configuration File &lt;span class="k">for&lt;/span> keepalived
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">global_defs &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vrrp_instance VI_1 &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> state MASTER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interface ens33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> virtual_router_id &lt;span class="m">51&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> priority &lt;span class="m">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> advert_int &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> auth_type PASS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> auth_pass &lt;span class="m">1111&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> virtual_ipaddress &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 192.168.52.99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 备节点&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/etc/keepalived# cat keepalived.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! Configuration File &lt;span class="k">for&lt;/span> keepalived
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">global_defs &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vrrp_instance VI_1 &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> state BACKUP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interface ens33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> virtual_router_id &lt;span class="m">51&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> priority &lt;span class="m">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> advert_int &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> auth_type PASS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> auth_pass &lt;span class="m">1111&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> virtual_ipaddress &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 192.168.52.99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 启动服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/etc/keepalived# systemctl start keepalived.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/etc/keepalived# systemctl status keepalived.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">● keepalived.service - Keepalive Daemon &lt;span class="o">(&lt;/span>LVS and VRRP&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Loaded: loaded &lt;span class="o">(&lt;/span>/lib/systemd/system/keepalived.service&lt;span class="p">;&lt;/span> enabled&lt;span class="p">;&lt;/span> preset: enabled&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Active: active &lt;span class="o">(&lt;/span>running&lt;span class="o">)&lt;/span> since Tue 2025-05-20 22:14:30 EDT&lt;span class="p">;&lt;/span> 1s ago
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Docs: man:keepalived&lt;span class="o">(&lt;/span>8&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> man:keepalived.conf&lt;span class="o">(&lt;/span>5&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> man:genhash&lt;span class="o">(&lt;/span>1&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> https://keepalived.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Main PID: &lt;span class="m">1681&lt;/span> &lt;span class="o">(&lt;/span>keepalived&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tasks: &lt;span class="m">2&lt;/span> &lt;span class="o">(&lt;/span>limit: 2241&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Memory: 3.7M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CPU: 17ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CGroup: /system.slice/keepalived.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├─1681 /usr/sbin/keepalived --dont-fork
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └─1682 /usr/sbin/keepalived --dont-fork
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="验证-1">验证
&lt;/h3>&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%AA%8C%E8%AF%811.png"
width="1915"
height="524"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%AA%8C%E8%AF%811_hu_69a6eaec32084434.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%AA%8C%E8%AF%811_hu_2ea8cf5f198d34a6.png 1024w"
loading="lazy"
alt="image-高可用验证"
class="gallery-image"
data-flex-grow="365"
data-flex-basis="877px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 停止主节点192.168.52.60上的keepalived服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# ip a s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">65536&lt;/span> qdisc noqueue state UNKNOWN group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 127.0.0.1/8 scope host lo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 ::1/128 scope host noprefixroute
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2: ens33: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1500&lt;/span> qdisc fq_codel state UP group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 00:0c:29:dc:2d:71 brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> altname enp2s1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 192.168.52.60/24 brd 192.168.52.255 scope global noprefixroute ens33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 192.168.52.99/32 scope global ens33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 fe80::20c:29ff:fedc:2d71/64 scope link noprefixroute
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# systemctl stop keepalived.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# ip a s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">65536&lt;/span> qdisc noqueue state UNKNOWN group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 127.0.0.1/8 scope host lo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 ::1/128 scope host noprefixroute
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2: ens33: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu &lt;span class="m">1500&lt;/span> qdisc fq_codel state UP group default qlen &lt;span class="m">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 00:0c:29:dc:2d:71 brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> altname enp2s1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 192.168.52.60/24 brd 192.168.52.255 scope global noprefixroute ens33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 fe80::20c:29ff:fedc:2d71/64 scope link noprefixroute
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>再次通过浏览器访问&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-nginx/image-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%AA%8C%E8%AF%812.png"
width="1915"
height="524"
srcset="https://caijemmy.github.io/p/1.0-nginx/image-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%AA%8C%E8%AF%812_hu_69a6eaec32084434.png 480w, https://caijemmy.github.io/p/1.0-nginx/image-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%AA%8C%E8%AF%812_hu_2ea8cf5f198d34a6.png 1024w"
loading="lazy"
alt="image-高可用验证"
class="gallery-image"
data-flex-grow="365"
data-flex-basis="877px"
>&lt;/p></description></item><item><title>2.0 nginx</title><link>https://caijemmy.github.io/p/2.0-nginx/</link><pubDate>Wed, 24 Jul 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/2.0-nginx/</guid><description>&lt;img src="https://caijemmy.github.io/p/2.0-nginx/cover.jpg" alt="Featured image of post 2.0 nginx" />&lt;h2 id="servername的多种匹配方式">servername的多种匹配方式
&lt;/h2>&lt;h3 id="同一端口配置不同域名">同一端口配置不同域名
&lt;/h3>&lt;h4 id="提前准备">提前准备
&lt;/h4>&lt;p>本地主机配置hosts文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\W&lt;/span>indows&lt;span class="se">\S&lt;/span>ystem32&lt;span class="se">\d&lt;/span>rivers&lt;span class="se">\e&lt;/span>tc&lt;span class="se">\h&lt;/span>osts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># nginx验证同一端口配置不同域名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.60 cainiao1.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.60 cainiao2.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>虚拟主机做以下配置&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:/var/www# mkdir cainiao1 cainiao2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/var/www# &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;this is &amp;lt;br&amp;gt; cainiao1&amp;#39;&lt;/span> &amp;gt; cainiao1/index.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/var/www# &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;this is &amp;lt;br&amp;gt; cainiao2&amp;#39;&lt;/span> &amp;gt; cainiao2/index.html
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置nginx">配置nginx
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将以下内容防止配置文件http模块最后
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">root@debian:~&lt;/span>&lt;span class="c1"># vim /etc/nginx/nginx.conf
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="s">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">cainiao1.com&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">root&lt;/span> &lt;span class="s">/var/www/cainiao1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">index&lt;/span> &lt;span class="s">index.html&lt;/span> &lt;span class="s">index.htm&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">expires&lt;/span> &lt;span class="s">30d&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">cainiao2.com&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">root&lt;/span> &lt;span class="s">/var/www/cainiao2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">index&lt;/span> &lt;span class="s">index.html&lt;/span> &lt;span class="s">index.htm&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">expires&lt;/span> &lt;span class="s">30d&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 重新加载配置
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">root@debian:~&lt;/span>&lt;span class="c1"># systemctl reload nginx.service
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="验证">验证
&lt;/h4>&lt;p>&lt;img src="https://caijemmy.github.io/p/2.0-nginx/image-nginx%E9%AA%8C%E8%AF%81%E5%90%8C%E4%B8%80%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D1.png"
width="572"
height="190"
srcset="https://caijemmy.github.io/p/2.0-nginx/image-nginx%E9%AA%8C%E8%AF%81%E5%90%8C%E4%B8%80%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D1_hu_9ef81a8ea03abcc5.png 480w, https://caijemmy.github.io/p/2.0-nginx/image-nginx%E9%AA%8C%E8%AF%81%E5%90%8C%E4%B8%80%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D1_hu_2f2eab728184a085.png 1024w"
loading="lazy"
alt="image-nginx验证同一端口配置不同域名1"
class="gallery-image"
data-flex-grow="301"
data-flex-basis="722px"
>&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/2.0-nginx/image-nginx%E9%AA%8C%E8%AF%81%E5%90%8C%E4%B8%80%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D2.png"
width="570"
height="182"
srcset="https://caijemmy.github.io/p/2.0-nginx/image-nginx%E9%AA%8C%E8%AF%81%E5%90%8C%E4%B8%80%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D2_hu_9d1ee4e3255c9b18.png 480w, https://caijemmy.github.io/p/2.0-nginx/image-nginx%E9%AA%8C%E8%AF%81%E5%90%8C%E4%B8%80%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D2_hu_9c5cd28373cbfc0e.png 1024w"
loading="lazy"
alt="image-nginx验证同一端口配置不同域名2"
class="gallery-image"
data-flex-grow="313"
data-flex-basis="751px"
>&lt;/p>
&lt;h3 id="不同域名指向同一访问路径">不同域名指向同一访问路径
&lt;/h3>&lt;h4 id="提前准备-1">提前准备
&lt;/h4>&lt;p>本地主机配置hosts文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">C:&lt;span class="se">\W&lt;/span>indows&lt;span class="se">\S&lt;/span>ystem32&lt;span class="se">\d&lt;/span>rivers&lt;span class="se">\e&lt;/span>tc&lt;span class="se">\h&lt;/span>osts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># nginx验证同一端口配置不同域名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.60 cainiao1.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.60 cainiao2.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.60 xxoo.cainiao1.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.60 xx.cainiao1.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.60 oo.cainiao1.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.60 cainiao2.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.60 cainiao2.net
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置nginx-1">配置nginx
&lt;/h4>&lt;p>&lt;strong>注意：server_name配置域名时，域名间有空格&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">root@debian:~&lt;/span>&lt;span class="c1"># vim /etc/nginx/nginx.conf
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="s">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># server_name cainiao1.com xxoo.cainiao1.com xx.cainiao1.com oo.cainiao1.com;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">cainiao1.com&lt;/span> &lt;span class="s">*.cainiao1.com&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1"># 可以使用*通配符
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">root&lt;/span> &lt;span class="s">/var/www/cainiao1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">index&lt;/span> &lt;span class="s">index.html&lt;/span> &lt;span class="s">index.htm&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">expires&lt;/span> &lt;span class="s">30d&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">cainiao2.*&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">root&lt;/span> &lt;span class="s">/var/www/cainiao2&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">expires&lt;/span> &lt;span class="s">30d&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 重新加载配置
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">root@debian:~&lt;/span>&lt;span class="c1"># systemctl reload nginx.service
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="验证-1">验证
&lt;/h4>&lt;p>&lt;img src="https://caijemmy.github.io/p/2.0-nginx/image-nginx%E9%AA%8C%E8%AF%81%E5%90%8C%E4%B8%80%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D3.png"
width="647"
height="190"
srcset="https://caijemmy.github.io/p/2.0-nginx/image-nginx%E9%AA%8C%E8%AF%81%E5%90%8C%E4%B8%80%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D3_hu_5adb1566d1e028e6.png 480w, https://caijemmy.github.io/p/2.0-nginx/image-nginx%E9%AA%8C%E8%AF%81%E5%90%8C%E4%B8%80%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D3_hu_ca9e1cbf177d8203.png 1024w"
loading="lazy"
alt="image-nginx验证同一端口配置不同域名3"
class="gallery-image"
data-flex-grow="340"
data-flex-basis="817px"
>&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/2.0-nginx/image-nginx%E9%AA%8C%E8%AF%81%E5%90%8C%E4%B8%80%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D4.png"
width="569"
height="181"
srcset="https://caijemmy.github.io/p/2.0-nginx/image-nginx%E9%AA%8C%E8%AF%81%E5%90%8C%E4%B8%80%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D4_hu_77f85b634cbd8547.png 480w, https://caijemmy.github.io/p/2.0-nginx/image-nginx%E9%AA%8C%E8%AF%81%E5%90%8C%E4%B8%80%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%90%8C%E5%9F%9F%E5%90%8D4_hu_24dfdfc5652a39a5.png 1024w"
loading="lazy"
alt="image-nginx验证同一端口配置不同域名4"
class="gallery-image"
data-flex-grow="314"
data-flex-basis="754px"
>&lt;/p>
&lt;h2 id="负载均衡参数详解">负载均衡参数详解
&lt;/h2>&lt;h3 id="nginx配置">nginx配置
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">root@debian:/opt/tomcat8082&lt;/span>&lt;span class="c1"># cat /etc/nginx/conf.d/default.conf
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="s">upstream&lt;/span> &lt;span class="s">myServers&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server&lt;/span> &lt;span class="n">127.0.0.1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">8081&lt;/span> &lt;span class="s">weight=4&lt;/span> &lt;span class="s">down&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server&lt;/span> &lt;span class="n">127.0.0.1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">8082&lt;/span> &lt;span class="s">weight=1&lt;/span> &lt;span class="s">backup&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server&lt;/span> &lt;span class="n">127.0.0.1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">8083&lt;/span> &lt;span class="s">weight=1&lt;/span> &lt;span class="s">max_fails=3&lt;/span> &lt;span class="s">fail_timeout=10s&lt;/span> &lt;span class="s">slow_start=30s&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">localhost&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">location&lt;/span> &lt;span class="s">/&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># root /usr/share/nginx/html;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1"># index index.html index.htm;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://myServers&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">......&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>配置说明&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>&lt;code>weight&lt;/code>&lt;/strong> 在实际生产中使用普遍，主要根据服务器配置、网络带宽对集群权重进行调整。权重越高，分配的请求越多。&lt;/li>
&lt;li>&lt;strong>&lt;code>down&lt;/code>&lt;/strong> 标记某个后端服务器为不可用状态，nginx不转发请求到此服务器。&lt;strong>实际中几乎不用&lt;/strong>。&lt;/li>
&lt;li>&lt;strong>&lt;code>backup&lt;/code>&lt;/strong> 用于将某台服务器标记为备用服务器。只有当所有非备用服务器不可用时，才会将请求分配到备用服务器。&lt;/li>
&lt;li>&lt;strong>&lt;code>max_fails&lt;/code> 和 &lt;code>fail_timeout&lt;/code>&lt;/strong> 在 &lt;code>fail_timeout&lt;/code> 时间窗口内允许的最大失败次数（&lt;code>max_fails&lt;/code>）。&lt;/li>
&lt;li>&lt;strong>&lt;code>resolve&lt;/code>&lt;/strong> 动态解析域名，适用于后端服务器使用域名的情况。&lt;/li>
&lt;li>&lt;strong>&lt;code>slow_start&lt;/code>&lt;/strong> 当服务器从 &lt;code>down&lt;/code> 状态恢复时，逐渐增加其权重。&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>顺序说明&lt;/strong>&lt;/p>
&lt;p>虽然 Nginx 的 &lt;code>upstream&lt;/code> 参数顺序不影响功能，但为了代码的规范性和可读性，建议按照以下顺序书写参数：&lt;/p>
&lt;ol>
&lt;li>服务器地址（IP 或域名）&lt;/li>
&lt;li>&lt;code>weight&lt;/code>&lt;/li>
&lt;li>&lt;code>max_fails&lt;/code> 和 &lt;code>fail_timeout&lt;/code>&lt;/li>
&lt;li>&lt;code>backup&lt;/code>&lt;/li>
&lt;li>&lt;code>down&lt;/code>&lt;/li>
&lt;li>其他参数（如 &lt;code>resolve&lt;/code>、&lt;code>slow_start&lt;/code> 等）&lt;/li>
&lt;/ol>
&lt;p>这样可以确保配置清晰易懂，便于后续维护和调试。&lt;/p>
&lt;h3 id="负载均衡算法">负载均衡算法
&lt;/h3>&lt;p>&lt;strong>实际配置情况&lt;/strong>&lt;/p>
&lt;p>&lt;strong>&lt;code>Round Robin（轮询）&lt;/code>&lt;/strong> 生产中使用这种，生产系统使用无状态会话技术即可。&lt;/p>
&lt;p>&lt;strong>&lt;code>Least Connections（最少连接）&lt;/code>&lt;/strong> 生产中不用，后端服务无法会话保持。&lt;/p>
&lt;p>&lt;strong>&lt;code>IP Hash&lt;/code>&lt;/strong> 生产中不用，移动端IP变化后，后端服务无法会话保持。&lt;/p>
&lt;p>&lt;strong>&lt;code>Generic Hash&lt;/code>&lt;/strong> url hash 定向流量转发，固定资源不在统一服务器，才用的到。&lt;strong>可能会出现流量偏移&lt;/strong>。&lt;/p>
&lt;p>&lt;strong>&lt;code>Random&lt;/code>&lt;/strong> 生产中不用，后端服务无法会话保持。&lt;/p>
&lt;h2 id="nginx-的正则表达式">Nginx 的正则表达式
&lt;/h2>&lt;p>Nginx 的正则表达式（Regular Expressions）主要用于 &lt;code>location&lt;/code> 块、&lt;code>rewrite&lt;/code> 指令、&lt;code>if&lt;/code> 条件等场景中，用于匹配 URL 或其他字符串。Nginx 使用的是 &lt;strong>PCRE（Perl Compatible Regular Expressions）&lt;/strong> 库，因此其语法与 Perl 的正则表达式兼容。&lt;/p>
&lt;h3 id="正则表达式的基本语法">正则表达式的基本语法
&lt;/h3>&lt;p>Nginx 的正则表达式语法与 PCRE 一致，以下是一些常用的元字符和语法：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>元字符&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>.&lt;/code>&lt;/td>
&lt;td>匹配任意单个字符（除换行符 &lt;code>\n&lt;/code> 外）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>*&lt;/code>&lt;/td>
&lt;td>匹配前面的字符 0 次或多次&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>+&lt;/code>&lt;/td>
&lt;td>匹配前面的字符 1 次或多次&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>?&lt;/code>&lt;/td>
&lt;td>匹配前面的字符 0 次或 1 次&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>{n}&lt;/code>&lt;/td>
&lt;td>匹配前面的字符恰好 n 次&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>{n,}&lt;/code>&lt;/td>
&lt;td>匹配前面的字符至少 n 次&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>{n,m}&lt;/code>&lt;/td>
&lt;td>匹配前面的字符至少 n 次，至多 m 次&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>^&lt;/code>&lt;/td>
&lt;td>匹配字符串的开头&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>$&lt;/code>&lt;/td>
&lt;td>匹配字符串的结尾&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>\&lt;/code>&lt;/td>
&lt;td>转义字符，用于匹配特殊字符（如 &lt;code>.&lt;/code>、&lt;code>*&lt;/code> 等）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>[]&lt;/code>&lt;/td>
&lt;td>字符集，匹配其中任意一个字符（如 &lt;code>[abc]&lt;/code> 匹配 &lt;code>a&lt;/code>、&lt;code>b&lt;/code> 或 &lt;code>c&lt;/code>）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>[^]&lt;/code>&lt;/td>
&lt;td>否定字符集，匹配不在其中的任意字符（如 &lt;code>[^abc]&lt;/code> 匹配非 &lt;code>a&lt;/code>、&lt;code>b&lt;/code>、&lt;code>c&lt;/code> 的字符）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>`&lt;/td>
&lt;td>`&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>()&lt;/code>&lt;/td>
&lt;td>分组，用于捕获匹配的内容或定义子表达式&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="nginx-中的正则表达式匹配">Nginx 中的正则表达式匹配
&lt;/h3>&lt;p>在 Nginx 中，正则表达式通常用于以下场景：&lt;/p>
&lt;h4 id="location">&lt;strong>&lt;code>location&lt;/code> 块中的正则匹配&lt;/strong>
&lt;/h4>&lt;p>&lt;code>location&lt;/code> 块可以使用正则表达式匹配 URL。正则表达式必须以 &lt;code>~&lt;/code>（区分大小写）或 &lt;code>~*&lt;/code>（不区分大小写）开头。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>区分大小写匹配&lt;/strong>：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">location&lt;/span> &lt;span class="p">~&lt;/span> &lt;span class="sr">\.php$&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 匹配以 .php 结尾的 URL
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>不区分大小写匹配&lt;/strong>：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">location&lt;/span> &lt;span class="p">~&lt;/span>&lt;span class="sr">*&lt;/span> &lt;span class="s">\.(jpg|jpeg|png|gif)&lt;/span>$ &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 匹配以 .jpg、.jpeg、.png 或 .gif 结尾的 URL，不区分大小写
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="rewrite">&lt;strong>&lt;code>rewrite&lt;/code> 指令中的正则匹配&lt;/strong>
&lt;/h4>&lt;p>&lt;code>rewrite&lt;/code> 指令可以使用正则表达式匹配 URL 并进行重写。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>示例：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">rewrite&lt;/span> &lt;span class="s">^/old/(.*)&lt;/span>$ &lt;span class="s">/new/\&lt;/span>&lt;span class="nv">$1&lt;/span> &lt;span class="s">permanent&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>解释：&lt;/p>
&lt;ul>
&lt;li>&lt;code>^/old/(.*)$&lt;/code>：匹配以 &lt;code>/old/&lt;/code> 开头的 URL，并捕获后面的内容。&lt;/li>
&lt;li>&lt;code>/new/\$1&lt;/code>：将匹配的 URL 重写为 &lt;code>/new/&lt;/code> 加上捕获的内容。&lt;/li>
&lt;li>&lt;code>permanent&lt;/code>：返回 301 永久重定向。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="if">&lt;strong>&lt;code>if&lt;/code> 条件中的正则匹配&lt;/strong>
&lt;/h4>&lt;p>&lt;code>if&lt;/code> 指令可以使用正则表达式进行条件判断。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>示例：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="s">(&lt;/span>&lt;span class="nv">$request_uri&lt;/span> &lt;span class="p">~&lt;/span>&lt;span class="sr">*&lt;/span> &lt;span class="s">&amp;#34;^/admin&amp;#34;)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">return&lt;/span> &lt;span class="mi">403&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>解释：&lt;/p>
&lt;ul>
&lt;li>如果请求的 URL 以 &lt;code>/admin&lt;/code> 开头（不区分大小写），则返回 403 状态码。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="正则表达式的捕获与引用">正则表达式的捕获与引用
&lt;/h3>&lt;p>在 Nginx 中，正则表达式的捕获内容可以通过 &lt;code>\$1&lt;/code>、&lt;code>\$2&lt;/code> 等变量引用。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>示例：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">location&lt;/span> &lt;span class="p">~&lt;/span> &lt;span class="sr">^/user/(\d+)$&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://backend/user/\&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>解释：&lt;/p>
&lt;ul>
&lt;li>&lt;code>(\d+)&lt;/code>：捕获 URL 中的数字部分。&lt;/li>
&lt;li>&lt;code>\$1&lt;/code>：引用捕获的内容。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="综合示例">综合示例
&lt;/h3>&lt;p>以下是一个综合示例，展示了正则表达式在 Nginx 中的使用：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-nginx" data-lang="nginx">&lt;span class="line">&lt;span class="cl">&lt;span class="k">server&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">listen&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">server_name&lt;/span> &lt;span class="s">example.com&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 匹配以 /user/ 开头的 URL，并捕获用户 ID
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">location&lt;/span> &lt;span class="p">~&lt;/span> &lt;span class="sr">^/user/(\d+)$&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">proxy_pass&lt;/span> &lt;span class="s">http://backend/user/\&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 匹配以 .jpg、.jpeg、.png 或 .gif 结尾的 URL，不区分大小写
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">location&lt;/span> &lt;span class="p">~&lt;/span>&lt;span class="sr">*&lt;/span> &lt;span class="s">\.(jpg|jpeg|png|gif)&lt;/span>$ &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">access_log&lt;/span> &lt;span class="no">off&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">expires&lt;/span> &lt;span class="s">30d&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 重写 /old/ 开头的 URL 到 /new/
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">rewrite&lt;/span> &lt;span class="s">^/old/(.*)&lt;/span>$ &lt;span class="s">/new/\&lt;/span>&lt;span class="nv">$1&lt;/span> &lt;span class="s">permanent&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 如果请求的 URL 以 /admin 开头，返回 403
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kn">if&lt;/span> &lt;span class="s">(&lt;/span>&lt;span class="nv">$request_uri&lt;/span> &lt;span class="p">~&lt;/span>&lt;span class="sr">*&lt;/span> &lt;span class="s">&amp;#34;^/admin&amp;#34;)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kn">return&lt;/span> &lt;span class="mi">403&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>3.0 Kubernetes集群核心概念Pod</title><link>https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/</link><pubDate>Wed, 24 Jul 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/</guid><description>&lt;img src="https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/cover.jpg" alt="Featured image of post 3.0 Kubernetes集群核心概念Pod" />&lt;h1 id="kubernetes集群核心概念-pod">Kubernetes集群核心概念 Pod
&lt;/h1>&lt;h2 id="工作负载workloads">工作负载(workloads)
&lt;/h2>&lt;p>参考链接：&lt;a class="link" href="https://kubernetes.io/zh-cn/docs/concepts/workloads/" target="_blank" rel="noopener"
>工作负载 | Kubernetes&lt;/a>&lt;/p>
&lt;p>工作负载（workload）是在kubernetes集群中运行的应用程序。无论你的工作负载是单一服务还是多个一同工作的服务构成，在kubernetes中都可以使用pod来运行它。&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/image-%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD.png"
width="1911"
height="845"
srcset="https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/image-%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD_hu_9eb8ce042826bc19.png 480w, https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/image-%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD_hu_cdc57ea1b2baf247.png 1024w"
loading="lazy"
alt="image-工作负载"
class="gallery-image"
data-flex-grow="226"
data-flex-basis="542px"
>&lt;/p>
&lt;p>workloads分为pod与controllers&lt;/p>
&lt;ul>
&lt;li>pod通过控制器实现应用的运行，如何伸缩，升级等&lt;/li>
&lt;li>controllers 在集群中管理pod&lt;/li>
&lt;li>pod与控制器之间通过label-selector相关联，是唯一的关联方式&lt;/li>
&lt;/ul>
&lt;p>在pod的YAML里指定pod标签&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 定义标签&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app: nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在控制器的YAML里指定标签选择器匹配标签&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 通过标签选择器选择对应的pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> selector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> matchLabels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app: nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="pod介绍">pod介绍
&lt;/h2>&lt;p>参考链接: &lt;a class="link" href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/" target="_blank" rel="noopener"
>Pod | Kubernetes&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/image-pod%E6%98%AF%E4%BB%80%E4%B9%88.png"
width="1606"
height="787"
srcset="https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/image-pod%E6%98%AF%E4%BB%80%E4%B9%88_hu_b10ab4509ccdf644.png 480w, https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/image-pod%E6%98%AF%E4%BB%80%E4%B9%88_hu_120f7edbb52a069a.png 1024w"
loading="lazy"
alt="image-pod是什么"
class="gallery-image"
data-flex-grow="204"
data-flex-basis="489px"
>&lt;/p>
&lt;h3 id="查看pod方法">查看pod方法
&lt;/h3>&lt;p>pod是一种计算资源，可以通过&lt;code>kubectl get pod&lt;/code>来查看&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod # pod或pods都可以，不指定namespace,默认是名为default的namespace&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No resources found in default namespace.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod -n kube-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-gbgsh 1/1 Running &lt;span class="m">13&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-pm85d 1/1 Running &lt;span class="m">13&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-k8s-master01 1/1 Running &lt;span class="m">13&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-apiserver-k8s-master01 1/1 Running &lt;span class="m">14&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-controller-manager-k8s-master01 1/1 Running &lt;span class="m">13&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-h7s9b 1/1 Running &lt;span class="m">7&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 3d20h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-qt8px 1/1 Running &lt;span class="m">7&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 3d20h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-wlvrg 1/1 Running &lt;span class="m">7&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 3d20h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-scheduler-k8s-master01 1/1 Running &lt;span class="m">13&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metrics-server-596474b58-697f8 1/1 Running &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 19h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="pod的yaml资源清单格式">pod的YAML资源清单格式
&lt;/h3>&lt;p>YAML格式查找帮助方法&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl explain namespace&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl explain pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl explain pod.spec&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl explain pod.spec.containers&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>样例，及供参考。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># yaml格式的pod定义文件完整内容：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1 &lt;span class="c1">#必选，api版本号，例如v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Pod &lt;span class="c1">#必选，Pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata: &lt;span class="c1">#必选，元数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: string &lt;span class="c1">#必选，Pod名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: string &lt;span class="c1">#Pod所属的命名空间,默认在default的namespace&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels: &lt;span class="c1"># 自定义标签&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: string &lt;span class="c1">#自定义标签名字&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> annotations: &lt;span class="c1">#自定义注释列表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec: &lt;span class="c1">#必选，Pod中容器的详细定义(期望)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containers: &lt;span class="c1">#必选，Pod中容器列表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string &lt;span class="c1">#必选，容器名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image: string &lt;span class="c1">#必选，容器的镜像名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imagePullPolicy: &lt;span class="o">[&lt;/span>Always &lt;span class="p">|&lt;/span> Never &lt;span class="p">|&lt;/span> IfNotPresent&lt;span class="o">]&lt;/span> &lt;span class="c1">#获取镜像的策略 Alawys表示下载镜像 IfnotPresent表示优先使用本地镜像，否则下载镜像，Nerver表示仅使用本地镜像&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command: &lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span> &lt;span class="c1">#容器的启动命令列表，如不指定，使用打包时使用的启动命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> args: &lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span> &lt;span class="c1">#容器的启动命令参数列表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> workingDir: string &lt;span class="c1">#容器的工作目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> volumeMounts: &lt;span class="c1">#挂载到容器内部的存储卷配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string &lt;span class="c1">#引用pod定义的共享存储卷的名称，需用volumes[]部分定义的的卷名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mountPath: string &lt;span class="c1">#存储卷在容器内mount的绝对路径，应少于512字符&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> readOnly: boolean &lt;span class="c1">#是否为只读模式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ports: &lt;span class="c1">#需要暴露的端口库号列表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string &lt;span class="c1">#端口号名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containerPort: int &lt;span class="c1">#容器需要监听的端口号&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostPort: int &lt;span class="c1">#容器所在主机需要监听的端口号，默认与Container相同&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> protocol: string &lt;span class="c1">#端口协议，支持TCP和UDP，默认TCP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> env: &lt;span class="c1">#容器运行前需设置的环境变量列表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string &lt;span class="c1">#环境变量名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: string &lt;span class="c1">#环境变量的值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resources: &lt;span class="c1">#资源限制和请求的设置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> limits: &lt;span class="c1">#资源限制的设置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpu: string &lt;span class="c1">#Cpu的限制，单位为core数，将用于docker run --cpu-shares参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory: string &lt;span class="c1">#内存限制，单位可以为Mib/Gib，将用于docker run --memory参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> requests: &lt;span class="c1">#资源请求的设置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpu: string &lt;span class="c1">#Cpu请求，容器启动的初始可用数量&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory: string &lt;span class="c1">#内存清求，容器启动的初始可用数量&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> livenessProbe: &lt;span class="c1">#对Pod内个容器健康检查的设置，当探测无响应几次后将自动重启该容器，检查方法有exec、httpGet和tcpSocket，对一个容器只需设置其中一种方法即可&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> exec: &lt;span class="c1">#对Pod容器内检查方式设置为exec方式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command: &lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span> &lt;span class="c1">#exec方式需要制定的命令或脚本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> httpGet: &lt;span class="c1">#对Pod内个容器健康检查方法设置为HttpGet，需要制定Path、port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> path: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: number
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> host: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> scheme: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HttpHeaders:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tcpSocket: &lt;span class="c1">#对Pod内个容器健康检查方式设置为tcpSocket方式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: number
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> initialDelaySeconds: &lt;span class="m">0&lt;/span> &lt;span class="c1">#容器启动完成后首次探测的时间，单位为秒&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeoutSeconds: &lt;span class="m">0&lt;/span> &lt;span class="c1">#对容器健康检查探测等待响应的超时时间，单位秒，默认1秒&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> periodSeconds: &lt;span class="m">0&lt;/span> &lt;span class="c1">#对容器监控检查的定期探测时间设置，单位秒，默认10秒一次&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> successThreshold: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> failureThreshold: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> securityContext:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> privileged:false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> restartPolicy: &lt;span class="o">[&lt;/span>Always &lt;span class="p">|&lt;/span> Never &lt;span class="p">|&lt;/span> OnFailure&lt;span class="o">]&lt;/span> &lt;span class="c1"># Pod的重启策略，Always表示一旦不管以何种方式终止运行，kubelet都将重启，OnFailure表示只有Pod以非0退出码退出才重启，Nerver表示不再重启该Pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector: obeject &lt;span class="c1"># 设置NodeSelector表示将该Pod调度到包含这个label的node上，以key：value的格式指定&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imagePullSecrets: &lt;span class="c1">#Pull镜像时使用的secret名称，以key：secretkey格式指定&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostNetwork: &lt;span class="nb">false&lt;/span> &lt;span class="c1">#是否使用主机网络模式，默认为false，如果设置为true，表示使用宿主机网络&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> volumes: &lt;span class="c1">#在该pod上定义共享存储卷列表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string &lt;span class="c1">#共享存储卷名称 （volumes类型有很多种）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> emptyDir: &lt;span class="o">{}&lt;/span> &lt;span class="c1">#类型为emtyDir的存储卷，与Pod同生命周期的一个临时目录。为空值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostPath: string &lt;span class="c1">#类型为hostPath的存储卷，表示挂载Pod所在宿主机的目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> path: string &lt;span class="c1">#Pod所在宿主机的目录，将被用于同期中mount的目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> secret: &lt;span class="c1">#类型为secret的存储卷，挂载集群与定义的secret对象到容器内部&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> scretname: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> items:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - key: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> path: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> configMap: &lt;span class="c1">#类型为configMap的存储卷，挂载预定义的configMap对象到容器内部&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> items:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - key: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> path: string
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="pod创建与验证">pod创建与验证
&lt;/h2>&lt;h3 id="命令创建podv118变化">命令创建pod(v1.18变化)
&lt;/h3>&lt;ul>
&lt;li>k8s之前版本中, kubectl run命令用于创建deployment控制器&lt;/li>
&lt;li>在v1.18版本中, kubectl run命令改为创建pod&lt;/li>
&lt;/ul>
&lt;h4 id="创建一个名为pod-nginx的pod">创建一个名为pod-nginx的pod
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl run nginx1 --image=nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nginx1 created
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="验证">验证
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx1 1/1 Running &lt;span class="m">0&lt;/span> 41s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># NAME：Pod 的名称。名称在同一命名空间内必须唯一。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># READY：Pod 中容器的就绪状态。格式为 就绪容器数量/总容器数量。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># STATUS：Pod 的当前状态。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 常见的状态包括：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Running：Pod 中的所有容器已成功启动并正在运行。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Pending：Pod 已被调度到节点，但容器尚未启动（例如，正在拉取镜像）。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Succeeded：Pod 中的所有容器已成功完成任务并退出。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Failed：Pod 中的至少一个容器因错误退出。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># CrashLoopBackOff：容器启动失败，Kubernetes 正在重试。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Unknown：无法获取 Pod 的状态（通常是由于与节点通信失败）。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># RESTARTS：Pod 中容器的重启次数。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># AGE：Pod 的存活时间。从 Pod 创建到当前时间的时间间隔。时间单位可以是秒（s）、分钟（m）、小时（h）或天（d）。&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="yaml创建pod">YAML创建pod
&lt;/h3>&lt;h4 id="准备yaml文件">准备yaml文件
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># vim pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1 &lt;span class="c1"># api版本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Pod &lt;span class="c1"># 资源类型为Pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: pod-stress &lt;span class="c1"># 自定义pod的名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containers: &lt;span class="c1"># 定义pod里包含的容器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: c1 &lt;span class="c1"># 自定义pod中的容器名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image: polinux/stress &lt;span class="c1"># 启动容器的镜像名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;stress&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="c1"># 自定义启动容器时要执行的命令(类似dockerfile里的CMD)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> args: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;--vm&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;--vm-bytes&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;150M&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;--vm-hang&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="c1"># 自定义启动容器执行命令的参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># polinux/stress这个镜像用于压力测试,在启动容器时传命令与参数就是相当于分配容器运行时需要的压力&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl apply -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress created
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="查看pod信息">查看pod信息
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 3m32s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod -o wide&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 4m14s 10.244.69.215 k8s-worker02 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl describe pod pod-stress&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: pod-stress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Namespace: default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Events:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Reason Age From Message
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ---- ---- -------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Scheduled 4m50s default-scheduler Successfully assigned default/pod-stress to k8s-worker02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Pulling 4m49s kubelet Pulling image &lt;span class="s2">&amp;#34;polinux/stress&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Pulled 4m38s kubelet Successfully pulled image &lt;span class="s2">&amp;#34;polinux/stress&amp;#34;&lt;/span> in 11.549s &lt;span class="o">(&lt;/span>11.549s including waiting&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Created 4m38s kubelet Created container c1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Started 4m38s kubelet Started container c1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="删除pod">删除pod
&lt;/h3>&lt;h4 id="单个pod删除">单个pod删除
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方式1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl delete -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod &lt;span class="s2">&amp;#34;pod-stress&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方式2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl delete pod pod-stress&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="多个pod删除">多个pod删除
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方法1: 后接多个pod名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master1 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl delete pod pod名1 pod名2 pod名3 ......&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方法2: 通过awk截取要删除的pod名称，然后管道给xargs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master1 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods |awk &amp;#39;NR&amp;gt;1 {print $1}&amp;#39; |xargs kubectl delete pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方法3: 如果要删除的pod都在同一个非default的命名空间，则可直接删除命名空间&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master1 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl delete ns xxxx&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="镜像拉取策略">镜像拉取策略
&lt;/h3>&lt;p>由imagePullPolicy参数控制&lt;/p>
&lt;ul>
&lt;li>Always : 不管本地有没有镜像，都要从仓库中下载镜像&lt;/li>
&lt;li>Never : 从来不从仓库下载镜像, 只用本地镜像,本地没有就算了&lt;/li>
&lt;li>IfNotPresent: 如果本地存在就直接使用, 不存在才从仓库下载&lt;/li>
&lt;/ul>
&lt;p>默认的策略是：&lt;/p>
&lt;ul>
&lt;li>当镜像标签版本是latest，默认策略就是Always&lt;/li>
&lt;li>如果指定特定版本默认拉取策略就是IfNotPresent。&lt;/li>
&lt;/ul>
&lt;h4 id="将上面的pod删除再创建使用下面命令查看信息">将上面的pod删除再创建，使用下面命令查看信息
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl delete -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod &lt;span class="s2">&amp;#34;pod-stress&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No resources found in default namespace.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># docker images | grep stress&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">polinux/stress latest df58d15b053d &lt;span class="m">5&lt;/span> years ago 9.74MB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl apply -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl describe pod pod-stress&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Events:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Reason Age From Message
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ---- ---- -------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Scheduled 26s default-scheduler Successfully assigned default/pod-stress to k8s-worker02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Pulling 25s kubelet Pulling image &lt;span class="s2">&amp;#34;polinux/stress&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Pulled 17s kubelet Successfully pulled image &lt;span class="s2">&amp;#34;polinux/stress&amp;#34;&lt;/span> in 7.253s &lt;span class="o">(&lt;/span>7.253s including waiting&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Created 17s kubelet Created container c1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Started 17s kubelet Started container c1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>说明: 可以看到第二行信息还是&lt;code>pulling image&lt;/code>下载镜像&lt;/strong>&lt;/p>
&lt;h4 id="修改yaml">修改YAML
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># cat pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Pod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: pod-stress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: c1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image: polinux/stress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;stress&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> args: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;--vm&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;--vm-bytes&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;150M&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;--vm-hang&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imagePullPolicy: IfNotPresent &lt;span class="c1"># 增加了这一句&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="再次删除再创建">再次删除再创建
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl delete -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod &lt;span class="s2">&amp;#34;pod-stress&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl apply -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl describe pod pod-stress&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Events:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Reason Age From Message
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ---- ---- -------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Scheduled 18s default-scheduler Successfully assigned default/pod-stress to k8s-worker02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Pulled 17s kubelet Container image &lt;span class="s2">&amp;#34;polinux/stress&amp;#34;&lt;/span> already present on machine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Created 17s kubelet Created container c1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Started 17s kubelet Started container c1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>说明: 第二行信息是说镜像已经存在，直接使用了&lt;/strong>&lt;/p>
&lt;h3 id="pod的标签">pod的标签
&lt;/h3>&lt;ul>
&lt;li>为pod设置label,用于控制器通过label与pod关联&lt;/li>
&lt;li>语法与前面学的node标签几乎一致&lt;/li>
&lt;/ul>
&lt;h4 id="通过命令管理pod标签">通过命令管理Pod标签
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod pod-stress --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 4m58s &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label pod pod-stress region=huanan zone=A env=test bussiness=game&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod pod-stress --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 7m27s &lt;span class="nv">bussiness&lt;/span>&lt;span class="o">=&lt;/span>game,env&lt;span class="o">=&lt;/span>test,region&lt;span class="o">=&lt;/span>huanan,zone&lt;span class="o">=&lt;/span>A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods -l zone=A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 8m45s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods -l &amp;#34;zone in (A,B,C)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 9m22s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label pod pod-stress zone=B --overwrite=true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod pod-stress --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 11m &lt;span class="nv">bussiness&lt;/span>&lt;span class="o">=&lt;/span>game,env&lt;span class="o">=&lt;/span>test,region&lt;span class="o">=&lt;/span>huanan,zone&lt;span class="o">=&lt;/span>B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label pod pod-stress bussiness- env- region- zone-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress unlabeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod pod-stress --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 12m &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>小结:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>pod的label与node的label操作方式几乎相同&lt;/li>
&lt;li>node的label用于pod调度到指定label的node节点&lt;/li>
&lt;li>pod的label用于controller关联控制的pod&lt;/li>
&lt;/ul>
&lt;h4 id="通过yaml创建pod时添加标签">通过YAML创建Pod时添加标签
&lt;/h4>&lt;p>修改yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Pod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: pod-stress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels: &lt;span class="c1"># 增加多个标签&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> env: dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app: nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: c1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image: polinux/stress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;stress&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> args: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;--vm&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;--vm-bytes&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;150M&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;--vm-hang&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imagePullPolicy: IfNotPresent
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>直接apply应用&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl apply -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress configured
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>验证&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod pod-stress --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 16m &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>nginx,env&lt;span class="o">=&lt;/span>dev
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>4.0 kubernetes核心概念Controller</title><link>https://caijemmy.github.io/p/4.0-kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5controller/</link><pubDate>Wed, 24 Jul 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/4.0-kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5controller/</guid><description>&lt;img src="https://caijemmy.github.io/p/4.0-kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5controller/cover.jpg" alt="Featured image of post 4.0 kubernetes核心概念Controller" />&lt;h1 id="kubernetes核心概念-controller">kubernetes核心概念 Controller
&lt;/h1>&lt;h2 id="pod控制器controller">pod控制器controller
&lt;/h2>&lt;h3 id="controller作用及分类">Controller作用及分类
&lt;/h3>&lt;p>参考: &lt;a class="link" href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/" target="_blank" rel="noopener"
>工作负载管理 | Kubernetes&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/4.0-kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5controller/image-controller%E5%88%86%E7%B1%BB.png"
width="1895"
height="1051"
srcset="https://caijemmy.github.io/p/4.0-kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5controller/image-controller%E5%88%86%E7%B1%BB_hu_d25a81c2f74e4dba.png 480w, https://caijemmy.github.io/p/4.0-kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5controller/image-controller%E5%88%86%E7%B1%BB_hu_a881f27a54378454.png 1024w"
loading="lazy"
alt="image-controller分类"
class="gallery-image"
data-flex-grow="180"
data-flex-basis="432px"
>&lt;/p>
&lt;h3 id="deployment">Deployment
&lt;/h3></description></item><item><title>2.0 Kubernetes集群Node管理</title><link>https://caijemmy.github.io/p/2.0-kubernetes%E9%9B%86%E7%BE%A4node%E7%AE%A1%E7%90%86/</link><pubDate>Tue, 23 Jul 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/2.0-kubernetes%E9%9B%86%E7%BE%A4node%E7%AE%A1%E7%90%86/</guid><description>&lt;img src="https://caijemmy.github.io/p/2.0-kubernetes%E9%9B%86%E7%BE%A4node%E7%AE%A1%E7%90%86/cover.jpg" alt="Featured image of post 2.0 Kubernetes集群Node管理" />&lt;h1 id="kubernetes集群node管理">Kubernetes集群Node管理
&lt;/h1>&lt;p>&lt;img src="https://caijemmy.github.io/p/2.0-kubernetes%E9%9B%86%E7%BE%A4node%E7%AE%A1%E7%90%86/image-node%E7%AE%A1%E7%90%86.jpg"
width="2392"
height="1231"
srcset="https://caijemmy.github.io/p/2.0-kubernetes%E9%9B%86%E7%BE%A4node%E7%AE%A1%E7%90%86/image-node%E7%AE%A1%E7%90%86_hu_2ed481cf5a2ea76b.jpg 480w, https://caijemmy.github.io/p/2.0-kubernetes%E9%9B%86%E7%BE%A4node%E7%AE%A1%E7%90%86/image-node%E7%AE%A1%E7%90%86_hu_4e55511947d6a392.jpg 1024w"
loading="lazy"
alt="image-node管理"
class="gallery-image"
data-flex-grow="194"
data-flex-basis="466px"
>&lt;/p>
&lt;h2 id="查看集群信息">查看集群信息
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl cluster-info&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Kubernetes control plane is running at https://192.168.52.129:6443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CoreDNS is running at https://192.168.52.129:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To further debug and diagnose cluster problems, use &lt;span class="s1">&amp;#39;kubectl cluster-info dump&amp;#39;&lt;/span>.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="查看节点信息">查看节点信息
&lt;/h2>&lt;h3 id="查看集群节点信息">查看集群节点信息
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 34h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="查看集群节点详细信息">查看集群节点详细信息
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes -o wide&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 34h v1.28.15 192.168.52.129 &amp;lt;none&amp;gt; Debian GNU/Linux &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>bookworm&lt;span class="o">)&lt;/span> 6.1.0-34-amd64 docker://28.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15 192.168.52.140 &amp;lt;none&amp;gt; Debian GNU/Linux &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>bookworm&lt;span class="o">)&lt;/span> 6.1.0-34-amd64 docker://28.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15 192.168.52.141 &amp;lt;none&amp;gt; Debian GNU/Linux &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>bookworm&lt;span class="o">)&lt;/span> 6.1.0-34-amd64 docker://28.1.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="查看节点描述详细信息">查看节点描述详细信息
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl describe node k8s-master01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: k8s-master01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Roles: control-plane
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Labels: beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-master01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/os&lt;span class="o">=&lt;/span>linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/control-plane&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node.kubernetes.io/exclude-from-external-load-balancers&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Annotations: csi.volume.kubernetes.io/nodeid: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;csi.tigera.io&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;k8s-master01&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubeadm.alpha.kubernetes.io/cri-socket: unix:///var/run/cri-dockerd.sock
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node.alpha.kubernetes.io/ttl: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> projectcalico.org/IPv4Address: 192.168.52.129/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> projectcalico.org/IPv4VXLANTunnelAddr: 10.244.32.128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> volumes.kubernetes.io/controller-managed-attach-detach: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CreationTimestamp: Mon, &lt;span class="m">12&lt;/span> May &lt;span class="m">2025&lt;/span> 00:14:17 -0400
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Taints: node-role.kubernetes.io/control-plane:NoSchedule
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Unschedulable: &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Lease:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HolderIdentity: k8s-master01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AcquireTime: &amp;lt;unset&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RenewTime: Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 11:01:37 -0400
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Conditions:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Status LastHeartbeatTime LastTransitionTime Reason Message
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ----------------- ------------------ ------ -------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> NetworkUnavailable False Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 10:56:59 -0400 Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 10:56:59 -0400 CalicoIsUp Calico is running on this node
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> MemoryPressure False Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 10:56:41 -0400 Mon, &lt;span class="m">12&lt;/span> May &lt;span class="m">2025&lt;/span> 00:14:16 -0400 KubeletHasSufficientMemory kubelet has sufficient memory available
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> DiskPressure False Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 10:56:41 -0400 Mon, &lt;span class="m">12&lt;/span> May &lt;span class="m">2025&lt;/span> 00:14:16 -0400 KubeletHasNoDiskPressure kubelet has no disk pressure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PIDPressure False Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 10:56:41 -0400 Mon, &lt;span class="m">12&lt;/span> May &lt;span class="m">2025&lt;/span> 00:14:16 -0400 KubeletHasSufficientPID kubelet has sufficient PID available
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ready True Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 10:56:41 -0400 Mon, &lt;span class="m">12&lt;/span> May &lt;span class="m">2025&lt;/span> 05:46:53 -0400 KubeletReady kubelet is posting ready status. AppArmor enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Addresses:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> InternalIP: 192.168.52.129
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Hostname: k8s-master01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Capacity:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpu: &lt;span class="m">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ephemeral-storage: 101639152Ki
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hugepages-1Gi: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hugepages-2Mi: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory: 5284488Ki
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pods: &lt;span class="m">110&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Allocatable:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpu: &lt;span class="m">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ephemeral-storage: &lt;span class="m">93670642329&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hugepages-1Gi: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hugepages-2Mi: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory: 5182088Ki
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pods: &lt;span class="m">110&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">System Info:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Machine ID: f0d5fce3fd2f48b7ae64f003370f9732
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> System UUID: 7bf54d56-e453-1f28-83fb-20ad43599d29
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Boot ID: ec68e796-ffa6-4076-89f4-ebaae9433dbb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Kernel Version: 6.1.0-34-amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> OS Image: Debian GNU/Linux &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>bookworm&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Operating System: linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Architecture: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Container Runtime Version: docker://28.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Kubelet Version: v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Kube-Proxy Version: v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PodCIDR: 10.244.0.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PodCIDRs: 10.244.0.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Non-terminated Pods: &lt;span class="o">(&lt;/span>&lt;span class="m">15&lt;/span> in total&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Namespace Name CPU Requests CPU Limits Memory Requests Memory Limits Age
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --------- ---- ------------ ---------- --------------- ------------- ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-apiserver calico-apiserver-5b9b48d497-5ck29 &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-apiserver calico-apiserver-5b9b48d497-lm8jm &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-system calico-kube-controllers-789b9578b6-296xf &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-system calico-node-vll2x 250m &lt;span class="o">(&lt;/span>6%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 27h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-system calico-typha-5dd4d5c669-7mcsb &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 27h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-system csi-node-driver-gwsql &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-system goldmane-8456f8bf4d-vdc4h &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system coredns-5dd5756b68-gbgsh 100m &lt;span class="o">(&lt;/span>2%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 70Mi &lt;span class="o">(&lt;/span>1%&lt;span class="o">)&lt;/span> 170Mi &lt;span class="o">(&lt;/span>3%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system coredns-5dd5756b68-pm85d 100m &lt;span class="o">(&lt;/span>2%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 70Mi &lt;span class="o">(&lt;/span>1%&lt;span class="o">)&lt;/span> 170Mi &lt;span class="o">(&lt;/span>3%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system etcd-k8s-master01 100m &lt;span class="o">(&lt;/span>2%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 100Mi &lt;span class="o">(&lt;/span>1%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system kube-apiserver-k8s-master01 250m &lt;span class="o">(&lt;/span>6%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system kube-controller-manager-k8s-master01 200m &lt;span class="o">(&lt;/span>5%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system kube-proxy-qt8px &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 26h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system kube-scheduler-k8s-master01 100m &lt;span class="o">(&lt;/span>2%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tigera-operator tigera-operator-5b59476cb-gnd5z &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Allocated resources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">(&lt;/span>Total limits may be over &lt;span class="m">100&lt;/span> percent, i.e., overcommitted.&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Resource Requests Limits
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -------- -------- ------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpu 1100m &lt;span class="o">(&lt;/span>27%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory 240Mi &lt;span class="o">(&lt;/span>4%&lt;span class="o">)&lt;/span> 340Mi &lt;span class="o">(&lt;/span>6%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ephemeral-storage &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hugepages-1Gi &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hugepages-2Mi &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Events:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Reason Age From Message
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ---- ---- -------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Starting 115m kube-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Starting 4m56s kube-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeHasSufficientMemory 117m &lt;span class="o">(&lt;/span>x8 over 117m&lt;span class="o">)&lt;/span> kubelet Node k8s-master01 status is now: NodeHasSufficientMemory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Warning InvalidDiskCapacity 117m kubelet invalid capacity &lt;span class="m">0&lt;/span> on image filesystem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeHasNoDiskPressure 117m &lt;span class="o">(&lt;/span>x7 over 117m&lt;span class="o">)&lt;/span> kubelet Node k8s-master01 status is now: NodeHasNoDiskPressure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeHasSufficientPID 117m &lt;span class="o">(&lt;/span>x7 over 117m&lt;span class="o">)&lt;/span> kubelet Node k8s-master01 status is now: NodeHasSufficientPID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeAllocatableEnforced 117m kubelet Updated Node Allocatable limit across pods
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Starting 117m kubelet Starting kubelet.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal RegisteredNode 116m node-controller Node k8s-master01 event: Registered Node k8s-master01 in Controller
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Starting 5m7s kubelet Starting kubelet.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Warning InvalidDiskCapacity 5m7s kubelet invalid capacity &lt;span class="m">0&lt;/span> on image filesystem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeHasSufficientMemory 5m7s &lt;span class="o">(&lt;/span>x8 over 5m7s&lt;span class="o">)&lt;/span> kubelet Node k8s-master01 status is now: NodeHasSufficientMemory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeHasNoDiskPressure 5m7s &lt;span class="o">(&lt;/span>x7 over 5m7s&lt;span class="o">)&lt;/span> kubelet Node k8s-master01 status is now: NodeHasNoDiskPressure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeHasSufficientPID 5m7s &lt;span class="o">(&lt;/span>x7 over 5m7s&lt;span class="o">)&lt;/span> kubelet Node k8s-master01 status is now: NodeHasSufficientPID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeAllocatableEnforced 5m7s kubelet Updated Node Allocatable limit across pods
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal RegisteredNode 4m32s node-controller Node k8s-master01 event: Registered Node k8s-master01 in Controller
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="worker-node节点管理集群">worker node节点管理集群
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>&lt;strong>如果是kubeasz安装，所有节点(包括master与node)都已经可以对集群进行管理&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>如果是kubeadm安装，在node节点上管理时会报如下错误&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-worker01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The connection to the server localhost:8080 was refused - did you specify the right host or port?
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>只要把master上的管理文件&lt;code>/etc/kubernetes/admin.conf&lt;/code>拷贝到node节点的&lt;code>$HOME/.kube/config&lt;/code>就可以让node节点也可以实现kubectl命令管理&lt;/p>
&lt;p>1, 在node节点的用户家目录创建&lt;code>.kube&lt;/code>目录&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-worker01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># mkdir /root/.kube&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>2, 在worker节点做如下操作&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-worker01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># [ ! -f /root/.kube/config ] &amp;amp;&amp;amp; scp k8s-master01:/etc/kubernetes/admin.conf /root/.kube/config&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>3, 在worker node节点验证&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-worker01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 34h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="节点标签label">节点标签(label)
&lt;/h2>&lt;ul>
&lt;li>k8s集群如果由大量节点组成，可将节点打上对应的标签，然后通过标签进行筛选及查看,更好的进行资源对象的相关选择与匹配&lt;/li>
&lt;/ul>
&lt;h3 id="查看节点标签信息">查看节点标签信息
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get node --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 34h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-master01,kubernetes.io/os&lt;span class="o">=&lt;/span>linux,node-role.kubernetes.io/control-plane&lt;span class="o">=&lt;/span>,node.kubernetes.io/exclude-from-external-load-balancers&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-worker01,kubernetes.io/os&lt;span class="o">=&lt;/span>linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-worker02,kubernetes.io/os&lt;span class="o">=&lt;/span>linux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="设置节点标签信息">设置节点标签信息
&lt;/h3>&lt;h4 id="设置节点标签">设置节点标签
&lt;/h4>&lt;p>为节点&lt;code>k8s-worker01&lt;/code>打一个&lt;code>region=cainiao&lt;/code> 的标签&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label node k8s-worker01 region=cainiao&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/k8s-worker01 labeled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="查看所有节点标签">查看所有节点标签
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get node --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 34h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-master01,kubernetes.io/os&lt;span class="o">=&lt;/span>linux,node-role.kubernetes.io/control-plane&lt;span class="o">=&lt;/span>,node.kubernetes.io/exclude-from-external-load-balancers&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-worker01,kubernetes.io/os&lt;span class="o">=&lt;/span>linux,region&lt;span class="o">=&lt;/span>cainiao
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-worker02,kubernetes.io/os&lt;span class="o">=&lt;/span>linux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="查看所有节点带region的标签">查看所有节点带region的标签
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes -L region&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION REGION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 34h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15 cainiao
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="多维度标签">多维度标签
&lt;/h3>&lt;h4 id="设置多维度标签">设置多维度标签
&lt;/h4>&lt;p>也可以加其它的多维度标签,用于不同的需要区分的场景&lt;/p>
&lt;p>如把&lt;code>k8s-worker02&lt;/code>标签为华南区,A机房,测试环境,游戏业务&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label node k8s-worker02 zone=A env=test bussiness=game&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/k8s-worker02 labeled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes k8s-worker02 --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,bussiness&lt;span class="o">=&lt;/span>game,env&lt;span class="o">=&lt;/span>test,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-worker02,kubernetes.io/os&lt;span class="o">=&lt;/span>linux,zone&lt;span class="o">=&lt;/span>A
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="显示节点的相应标签">显示节点的相应标签
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes -L region,zone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION REGION ZONE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 35h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15 cainiao
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15 A
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="查找regioncainiao的节点">查找&lt;code>region=cainiao&lt;/code>的节点
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes -l region=cainiao&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="标签的修改">标签的修改
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label node k8s-worker02 bussiness=ad --overwrite=true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/k8s-worker02 labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">加上--overwrite&lt;span class="o">=&lt;/span>true覆盖原标签的value进行修改操作
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get node k8s-worker02 -L bussiness&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION BUSSINESS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15 ad
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="标签的删除">标签的删除
&lt;/h4>&lt;p>使用key加一个减号的写法来取消标签&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label node k8s-worker01 region-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/k8s-worker01 unlabeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes k8s-worker01 --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 32h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-worker01,kubernetes.io/os&lt;span class="o">=&lt;/span>linux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="标签选择器">标签选择器
&lt;/h4>&lt;p>标签选择器主要有2类:&lt;/p>
&lt;ul>
&lt;li>等值关系: =, !=&lt;/li>
&lt;li>集合关系: KEY in {VALUE1, VALUE2&amp;hellip;&amp;hellip;}&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label node k8s-master01 env=test1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/k8s-master01 labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label node k8s-worker01 env=test2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/k8s-worker01 labeled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get node -l &amp;#34;env in (test1,test2)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 35h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 32h v1.28.15
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>1.0 kubeadm部署单Master节点kubernetes集群</title><link>https://caijemmy.github.io/p/1.0-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95master%E8%8A%82%E7%82%B9kubernetes%E9%9B%86%E7%BE%A4/</link><pubDate>Mon, 22 Jul 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/1.0-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95master%E8%8A%82%E7%82%B9kubernetes%E9%9B%86%E7%BE%A4/</guid><description>&lt;img src="https://caijemmy.github.io/p/1.0-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95master%E8%8A%82%E7%82%B9kubernetes%E9%9B%86%E7%BE%A4/cover.jpg" alt="Featured image of post 1.0 kubeadm部署单Master节点kubernetes集群" />&lt;h1 id="kubeadm部署单master节点kubernetes集群">kubeadm部署单Master节点kubernetes集群
&lt;/h1>&lt;h2 id="kubernetes-12815-部署环境准备">kubernetes 1.28.15 部署环境准备
&lt;/h2>&lt;h3 id="主机操作系统说明">主机操作系统说明
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: center">序号&lt;/th>
&lt;th style="text-align: center">操作系统及版本&lt;/th>
&lt;th style="text-align: center">备注&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: center">1&lt;/td>
&lt;td style="text-align: center">Debian GNU/Linux 12 (bookworm)&lt;/td>
&lt;td style="text-align: center">Debian 6.1.135-1 (2025-04-25)&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="主机硬件配置说明">主机硬件配置说明
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>需求&lt;/th>
&lt;th>CPU&lt;/th>
&lt;th>内存&lt;/th>
&lt;th>硬盘&lt;/th>
&lt;th>角色&lt;/th>
&lt;th>主机名&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>值&lt;/td>
&lt;td>4C&lt;/td>
&lt;td>4G&lt;/td>
&lt;td>100GB&lt;/td>
&lt;td>master&lt;/td>
&lt;td>k8s-master01&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>值&lt;/td>
&lt;td>4C&lt;/td>
&lt;td>4G&lt;/td>
&lt;td>100GB&lt;/td>
&lt;td>worker(node)&lt;/td>
&lt;td>k8s-worker01&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>值&lt;/td>
&lt;td>4C&lt;/td>
&lt;td>4G&lt;/td>
&lt;td>100GB&lt;/td>
&lt;td>worker(node)&lt;/td>
&lt;td>k8s-worker02&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="主机配置">主机配置
&lt;/h3>&lt;h4 id="配置root-账号可以直接登录">配置root 账号可以直接登录
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 虚机配置过程，已经提炼为shell脚本，参考 VM/init_vm.sh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># vim /etc/ssh/sshd_config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PermitRootLogin yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl restart ssh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="主机名配置">主机名配置
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># master节点,名称为k8s-master01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hostnamectl set-hostname k8s-master01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># worker1节点,名称为k8s-worker01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hostnamectl set-hostname k8s-worker01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># worker2节点,名称为k8s-worker02&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hostnamectl set-hostname k8s-worker02
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="主机ip地址配置">主机IP地址配置
&lt;/h4>&lt;p>NetworkManager 的配置文件位于 /etc/NetworkManager/system-connections/ 目录下。可以通过编辑配置文件来设置静态 IP。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方式1：修改以下部分：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> /etc/NetworkManager/system-connections/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mv &lt;span class="s2">&amp;#34;Wired connection 1&amp;#34;&lt;/span> master01_ens33.nmconnection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>ipv4&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">method&lt;/span>&lt;span class="o">=&lt;/span>manual
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address1&lt;/span>&lt;span class="o">=&lt;/span>192.168.52.129/24,192.168.52.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">dns&lt;/span>&lt;span class="o">=&lt;/span>192.168.52.2&lt;span class="p">;&lt;/span>8.8.8.8&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行以下命令重新加载配置：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection down master01_ens33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection up master01_ens33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方式2：命令修改以下部分：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> /etc/NetworkManager/system-connections/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mv &lt;span class="s2">&amp;#34;Wired connection 1&amp;#34;&lt;/span> master01_ens33.nmconnection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection modify master01_ens33 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> ipv4.method manual &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> ipv4.addresses 192.168.52.129/24 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> ipv4.gateway 192.168.52.2 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> ipv4.dns &lt;span class="s2">&amp;#34;192.168.52.2 8.8.8.8&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 激活连接&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection down master01_ens33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection up master01_ens33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection down master01_ens33 &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> sudo nmcli connection up master01_ens33
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="主机名与ip地址解析">主机名与IP地址解析
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有集群主机均需要进行配置。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cat /etc/hosts&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">::1 localhost localhost.localdomain localhost6 localhost6.localdomain6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.129 k8s-master01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.140 k8s-worker01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.141 k8s-worker02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 验证： ping -c 4 k8s-master01 &amp;amp;&amp;amp; ping -c 4 k8s-worker01 &amp;amp;&amp;amp; ping -c 4 k8s-worker02&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="防火墙配置">防火墙配置
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有主机均需要操作。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在 Debian 12 中，默认的防火墙工具是 nftables（替代了之前的 iptables）。以下是关闭防火墙和查看防火墙状态的命令：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 检查 nftables 状态&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nft list ruleset
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 检查 firewalld 状态（如果安装了）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo firewall-cmd --state
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 检查 ufw 状态（如果安装了）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ufw status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl status nftables.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="selinux配置">SELINUX配置
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有主机均需要操作。修改SELinux配置需要重启操作系统。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sed -ri &amp;#39;s/SELINUX=enforcing/SELINUX=disabled/&amp;#39; /etc/selinux/config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在 Debian 系统中，默认不安装 SELinux。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo aa-status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果输出显示 apparmor module is loaded，表示 AppArmor 正在运行。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在 Debian 系统上安装 Kubernetes 时，通常不需要关闭 AppArmor。AppArmor 与 Kubernetes 和常见容器运行时兼容，&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 并提供额外的安全性。只有在特定情况下（如配置不当或兼容性问题）才需要关闭 AppArmor。&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="时间同步配置">时间同步配置
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有主机均需要操作。最小化安装系统需要安装ntpdate软件。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># apt -y install ntpdate&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crontab -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">0&lt;/span> */1 * * * /usr/sbin/ntpdate time1.aliyun.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="升级操作系统内核">升级操作系统内核
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有主机均需要操作。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt upgrade
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置内核转发及网桥过滤">配置内核转发及网桥过滤
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有主机均需要操作。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 添加网桥过滤及内核转发配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cat /etc/sysctl.d/k8s.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-ip6tables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-iptables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.ipv4.ip_forward &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vm.swappiness &lt;span class="o">=&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 加载br_netfilter模块&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">modprobe br_netfilter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看是否加载&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lsmod | grep br_netfilter&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">br_netfilter &lt;span class="m">22256&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bridge &lt;span class="m">151336&lt;/span> &lt;span class="m">1&lt;/span> br_netfilter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 加载网桥过滤及内核转发配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sysctl -p /etc/sysctl.d/k8s.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-ip6tables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-iptables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.ipv4.ip_forward &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vm.swappiness &lt;span class="o">=&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="安装ipset及ipvsadm">安装ipset及ipvsadm
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有主机均需要操作。主要用于实现service转发。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装ipset及ipvsadm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt -y install ipset ipvsadm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置ipvsadm模块加载方式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 添加需要加载的模块，这里需要把br_netfilter也加上，减少一个配置内核转发及网桥过滤的单独服务。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; /etc/ipvsadm.rules &lt;span class="s">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">modprobe -- br_netfilter
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">modprobe -- ip_vs
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">modprobe -- ip_vs_rr
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">modprobe -- ip_vs_wrr
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">modprobe -- ip_vs_sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">modprobe -- nf_conntrack
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 授权、运行、检查是否加载&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod &lt;span class="m">755&lt;/span> /etc/ipvsadm.rules &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> bash /etc/ipvsadm.rules &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> lsmod &lt;span class="p">|&lt;/span> grep -e ip_vs -e nf_conntrack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vim /etc/systemd/system/ipvsadm.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将启动内容拷贝&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Unit&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Description&lt;/span>&lt;span class="o">=&lt;/span>IPVS Load Balancer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">After&lt;/span>&lt;span class="o">=&lt;/span>network.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Service&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Type&lt;/span>&lt;span class="o">=&lt;/span>oneshot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>/bin/bash /etc/ipvsadm.rules
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStop&lt;/span>&lt;span class="o">=&lt;/span>/sbin/ipvsadm -C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">RemainAfterExit&lt;/span>&lt;span class="o">=&lt;/span>yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Install&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">WantedBy&lt;/span>&lt;span class="o">=&lt;/span>multi-user.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> ipvsadm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start ipvsadm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status ipvsadm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="关闭swap分区">关闭SWAP分区
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改完成后需要重启操作系统，如不重启，可临时关闭，命令为swapoff -a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 永远关闭swap分区，需要重启操作系统&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cat /etc/fstab&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># /dev/mapper/centos-swap swap swap defaults 0 0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在上一行中行首添加#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="docker准备">Docker准备
&lt;/h3>&lt;p>所有集群主机均需操作。
&lt;a class="link" href="https://docker.github.net.cn/engine/install/debian/#uninstall-docker-engine" target="_blank" rel="noopener"
>Debian安装docker官网参考&lt;/a>&lt;/p>
&lt;h4 id="卸载已安装decker">卸载已安装decker
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo apt-get purge docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm -rf /var/lib/docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm -rf /var/lib/containerd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="安装docker">安装docker
&lt;/h4>&lt;p>&lt;a class="link" href="https://developer.aliyun.com/mirror/docker-ce?spm=a2c6h.13651102.0.0.57e31b11LDVOCk" target="_blank" rel="noopener"
>阿里云docker源及安装配置参考&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># step 1: 安装必要的一些系统工具&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get -y install ca-certificates curl gnupg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># step 2: 信任 Docker 的 GPG 公钥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo install -m &lt;span class="m">0755&lt;/span> -d /etc/apt/keyrings
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/debian/gpg &lt;span class="p">|&lt;/span> sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo chmod a+r /etc/apt/keyrings/docker.gpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Step 3: 写入软件源信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="s2">&amp;#34;deb [arch=&lt;/span>&lt;span class="k">$(&lt;/span>dpkg --print-architecture&lt;span class="k">)&lt;/span>&lt;span class="s2"> signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.aliyun.com/docker-ce/linux/debian \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> &amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>. /etc/os-release &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$VERSION_CODENAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34; stable&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> sudo tee /etc/apt/sources.list.d/docker.list &amp;gt; /dev/null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Step 4: 安装Docker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get -y install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="修改cgroup方式">修改cgroup方式
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在/etc/docker/daemon.json添加如下内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cat /etc/docker/daemon.json&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;exec-opts&amp;#34;&lt;/span>: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;native.cgroupdriver=systemd&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 重启docker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl restart docker
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="安装cri-dockerd">安装cri-dockerd
&lt;/h4>&lt;p>&lt;a class="link" href="https://github.com/Mirantis/cri-dockerd/releases" target="_blank" rel="noopener"
>Releases · Mirantis/cri-dockerd&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 每个节点都安装&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.17/cri-dockerd_0.3.17.3-0.debian-bookworm_amd64.deb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dpkg -i cri-dockerd_0.3.17.3-0.debian-bookworm_amd64.deb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dpkg -l &lt;span class="p">|&lt;/span> grep cri-docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># vim /usr/lib/systemd/system/cri-docker.service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改第10行内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># --pod-infra-container-image：指定 Kubernetes 使用的 pause 容器镜像，确保 Pod 的基础功能正常运行。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># --container-runtime-endpoint：指定 cri-docker 与容器运行时的通信方式，确保 Kubernetes 能够管理容器。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>/usr/bin/cri-dockerd --pod-infra-container-image&lt;span class="o">=&lt;/span>registry.k8s.io/pause:3.9 --container-runtime-endpoint fd://
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start cri-docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> cri-docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status cri-docker
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="kubernetes-128x--集群部署">kubernetes 1.28.X 集群部署
&lt;/h3>&lt;h4 id="集群软件及版本说明">集群软件及版本说明
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>kubeadm&lt;/th>
&lt;th>kubelet&lt;/th>
&lt;th>kubectl&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>版本&lt;/td>
&lt;td>1.28.X&lt;/td>
&lt;td>1.28.X&lt;/td>
&lt;td>1.28.X&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>安装位置&lt;/td>
&lt;td>集群所有主机&lt;/td>
&lt;td>集群所有主机&lt;/td>
&lt;td>集群所有主机&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>作用&lt;/td>
&lt;td>初始化集群、管理集群等&lt;/td>
&lt;td>用于接收api-server指令，对pod生命周期进行管理&lt;/td>
&lt;td>集群应用命令行管理工具&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="阿里源安装集群软件">阿里源安装集群软件
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># debian 系统安装&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get update &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt-get install -y apt-transport-https
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -fsSL https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.28/deb/Release.key &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.28/deb/ /&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tee /etc/apt/sources.list.d/kubernetes.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install -y kubelet kubeadm kubectl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置kubelet">配置kubelet
&lt;/h4>&lt;p>为了实现docker使用的cgroupdriver与kubelet使用的cgroup的一致性，建议修改如下文件内容。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># vim /etc/sysconfig/kubelet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">KUBELET_EXTRA_ARGS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;--cgroup-driver=systemd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># debian 系统 /etc/default/kubelet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> kubelet
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="集群镜像准备">集群镜像准备
&lt;/h4>&lt;blockquote>
&lt;p>&lt;strong>必须科学上网，否则都是徒劳&lt;/strong>&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看要下载的镜像信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubeadm config images list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用下面的命令进行镜像下载&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubeadm config images pull --cri-socket unix:///var/run/cri-dockerd.sock
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="集群初始化">集群初始化
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubeadm init --kubernetes-version&lt;span class="o">=&lt;/span>v1.28.15 --pod-network-cidr&lt;span class="o">=&lt;/span>10.244.0.0/16 --apiserver-advertise-address&lt;span class="o">=&lt;/span>192.168.52.129 --cri-socket unix:///var/run/cri-dockerd.sock
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果不添加--cri-socket选项，则会报错，内容如下：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Found multiple CRI endpoints on the host. Please define which one do you wish to use by setting the &amp;#39;criSocket&amp;#39; field in the kubeadm configuration file: unix:///var/run/containerd/containerd.sock, unix:///var/run/cri-dockerd.sock&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># To see the stack trace of this error execute with --v=5 or higher&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置输出&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>init&lt;span class="o">]&lt;/span> Using Kubernetes version: v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Running pre-flight checks
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Pulling images required &lt;span class="k">for&lt;/span> setting up a Kubernetes cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> This might take a minute or two, depending on the speed of your internet connection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> You can also perform this action in beforehand using &lt;span class="s1">&amp;#39;kubeadm config images pull&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">W0504 12:48:00.026524 &lt;span class="m">2144&lt;/span> checks.go:835&lt;span class="o">]&lt;/span> detected that the sandbox image &lt;span class="s2">&amp;#34;registry.k8s.io/pause:3.8&amp;#34;&lt;/span> of the container runtime is inconsistent with that used by kubeadm. It is recommended that using &lt;span class="s2">&amp;#34;registry.k8s.io/pause:3.9&amp;#34;&lt;/span> as the CRI sandbox image.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Using certificateDir folder &lt;span class="s2">&amp;#34;/etc/kubernetes/pki&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;ca&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> apiserver serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local master01&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>10.96.0.1 192.168.52.129&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver-kubelet-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;front-proxy-ca&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;front-proxy-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/ca&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/server&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> etcd/server serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>localhost master01&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>192.168.52.129 127.0.0.1 ::1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/peer&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> etcd/peer serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>localhost master01&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>192.168.52.129 127.0.0.1 ::1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/healthcheck-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver-etcd-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;sa&amp;#34;&lt;/span> key and public key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Using kubeconfig folder &lt;span class="s2">&amp;#34;/etc/kubernetes&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;admin.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;kubelet.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;controller-manager.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;scheduler.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>etcd&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="nb">local&lt;/span> etcd in &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Using manifest folder &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-apiserver&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-controller-manager&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-scheduler&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Writing kubelet environment file with flags to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/kubeadm-flags.env&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Writing kubelet configuration to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/config.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Starting the kubelet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>wait-control-plane&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> the kubelet to boot up the control plane as static Pods from directory &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>. This can take up to 4m0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>apiclient&lt;span class="o">]&lt;/span> All control plane components are healthy after 21.505666 seconds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>upload-config&lt;span class="o">]&lt;/span> Storing the configuration used in ConfigMap &lt;span class="s2">&amp;#34;kubeadm-config&amp;#34;&lt;/span> in the &lt;span class="s2">&amp;#34;kube-system&amp;#34;&lt;/span> Namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet&lt;span class="o">]&lt;/span> Creating a ConfigMap &lt;span class="s2">&amp;#34;kubelet-config&amp;#34;&lt;/span> in namespace kube-system with the configuration &lt;span class="k">for&lt;/span> the kubelets in the cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>upload-certs&lt;span class="o">]&lt;/span> Skipping phase. Please see --upload-certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>mark-control-plane&lt;span class="o">]&lt;/span> Marking the node master01 as control-plane by adding the labels: &lt;span class="o">[&lt;/span>node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>mark-control-plane&lt;span class="o">]&lt;/span> Marking the node master01 as control-plane by adding the taints &lt;span class="o">[&lt;/span>node-role.kubernetes.io/control-plane:NoSchedule&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Using token: o4l5gb.8jem7v7x9upd376t
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow Node Bootstrap tokens to get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order &lt;span class="k">for&lt;/span> nodes to get long term certificate credentials
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow certificate rotation &lt;span class="k">for&lt;/span> all node client certificates in the cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Creating the &lt;span class="s2">&amp;#34;cluster-info&amp;#34;&lt;/span> ConfigMap in the &lt;span class="s2">&amp;#34;kube-public&amp;#34;&lt;/span> namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-finalize&lt;span class="o">]&lt;/span> Updating &lt;span class="s2">&amp;#34;/etc/kubernetes/kubelet.conf&amp;#34;&lt;/span> to point to a rotatable kubelet client certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>addons&lt;span class="o">]&lt;/span> Applied essential addon: CoreDNS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>addons&lt;span class="o">]&lt;/span> Applied essential addon: kube-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your Kubernetes control-plane has initialized successfully!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To start using your cluster, you need to run the following as a regular user:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mkdir -p &lt;span class="nv">$HOME&lt;/span>/.kube
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo cp -i /etc/kubernetes/admin.conf &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo chown &lt;span class="k">$(&lt;/span>id -u&lt;span class="k">)&lt;/span>:&lt;span class="k">$(&lt;/span>id -g&lt;span class="k">)&lt;/span> &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Alternatively, &lt;span class="k">if&lt;/span> you are the root user, you can run:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">export&lt;/span> &lt;span class="nv">KUBECONFIG&lt;/span>&lt;span class="o">=&lt;/span>/etc/kubernetes/admin.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You should now deploy a pod network to the cluster.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Run &lt;span class="s2">&amp;#34;kubectl apply -f [podnetwork].yaml&amp;#34;&lt;/span> with one of the options listed at:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> https://kubernetes.io/docs/concepts/cluster-administration/addons/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Then you can join any number of worker nodes by running the following on each as root:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubeadm join 192.168.52.129:6443 --token ghwg0j.hwc8l4o3h8j65le4 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --discovery-token-ca-cert-hash sha256:31ae1608dded0e8a442eaa653e52fc371f46bcbe3b047aa4a7a0a218d2601a50
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="集群应用客户端管理集群文件准备">集群应用客户端管理集群文件准备
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 根据提示执行命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># mkdir -p $HOME/.kube&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># cp -i /etc/kubernetes/admin.conf $HOME/.kube/config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># chown $(id -u):$(id -g) $HOME/.kube/config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># export KUBECONFIG=/etc/kubernetes/admin.conf&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="集群网络插件部署-calico">集群网络插件部署 calico
&lt;/h4>&lt;blockquote>
&lt;p>使用calico部署集群网络&lt;/p>
&lt;p>安装参考网址：&lt;a class="link" href="https://docs.tigera.io/calico/latest/getting-started/kubernetes/k8s-single-node" target="_blank" rel="noopener"
>Tutorial: Install Calico on single-host k8s cluster | Calico Documentation&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95master%E8%8A%82%E7%82%B9kubernetes%E9%9B%86%E7%BE%A4/image-calico%E5%AE%89%E8%A3%85.png"
width="2346"
height="1322"
srcset="https://caijemmy.github.io/p/1.0-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95master%E8%8A%82%E7%82%B9kubernetes%E9%9B%86%E7%BE%A4/image-calico%E5%AE%89%E8%A3%85_hu_fb582bdbf774394c.png 480w, https://caijemmy.github.io/p/1.0-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95master%E8%8A%82%E7%82%B9kubernetes%E9%9B%86%E7%BE%A4/image-calico%E5%AE%89%E8%A3%85_hu_7f9ae086208c15bd.png 1024w"
loading="lazy"
alt="image-calico安装"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="425px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 应用operator资源清单文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.30.0/manifests/tigera-operator.yaml&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 下载自定义资源文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># wget https://raw.githubusercontent.com/projectcalico/calico/v3.30.0/manifests/custom-resources.yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改文件第13行，修改为使用kubeadm init ----pod-network-cidr对应的IP地址段&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># vim custom-resources.yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">11&lt;/span> ipPools:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">12&lt;/span> - blockSize: &lt;span class="m">26&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">13&lt;/span> cidr: 10.244.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">14&lt;/span> encapsulation: VXLANCrossSubnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 应用资源清单文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl create -f custom-resources.yaml&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 监视calico-sysem命名空间中pod运行情况&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># watch kubectl get pods -n calico-system&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Wait until each pod has the &lt;code>STATUS&lt;/code> of &lt;code>Running&lt;/code>.&lt;/p>
&lt;p>1、科学上网很重要&lt;/p>
&lt;p>2、重启虚机，重启主机，科学上网断开重连&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 已经全部运行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods -n calico-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-kube-controllers-789b9578b6-296xf 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d21h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-node-hrqlr 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-node-l7dhd 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-node-vll2x 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-typha-5dd4d5c669-49svd 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-typha-5dd4d5c669-7mcsb 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-node-driver-fcx7c 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d19h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-node-driver-gwsql 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d21h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-node-driver-qlx46 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d19h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">goldmane-8456f8bf4d-vdc4h 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d21h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">whisker-594579fbdd-dtbjt 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="集群工作节点添加">集群工作节点添加
&lt;/h4>&lt;blockquote>
&lt;p>因容器镜像下载较慢，可能会导致报错，主要错误为没有准备好cni（集群网络插件），如有网络，请耐心等待即可。&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-worker01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubeadm join 192.168.52.129:6443 --token ghwg0j.hwc8l4o3h8j65le4 \&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --discovery-token-ca-cert-hash sha256:31ae1608dded0e8a442eaa653e52fc371f46bcbe3b047aa4a7a0a218d2601a50
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-worker02 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubeadm join 192.168.52.129:6443 --token ghwg0j.hwc8l4o3h8j65le4 \&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --discovery-token-ca-cert-hash sha256:31ae1608dded0e8a442eaa653e52fc371f46bcbe3b047aa4a7a0a218d2601a50
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="验证集群可用性">验证集群可用性
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看所有的节点&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 2d22h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 2d19h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 2d19h v1.28.15
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看集群健康情况&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get cs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: v1 ComponentStatus is deprecated in v1.19+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS MESSAGE ERROR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">controller-manager Healthy ok
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scheduler Healthy ok
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-0 Healthy ok
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看kubernetes集群pod运行情况&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods -n kube-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-gbgsh 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-pm85d 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-k8s-master01 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-apiserver-k8s-master01 1/1 Running &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-controller-manager-k8s-master01 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-h7s9b 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-qt8px 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-wlvrg 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-scheduler-k8s-master01 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 再次查看calico-system命名空间中pod运行情况。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods -n calico-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-kube-controllers-789b9578b6-296xf 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-node-hrqlr 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-node-l7dhd 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-node-vll2x 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-typha-5dd4d5c669-49svd 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-typha-5dd4d5c669-7mcsb 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-node-driver-fcx7c 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d19h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-node-driver-gwsql 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-node-driver-qlx46 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d19h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">goldmane-8456f8bf4d-vdc4h 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">whisker-594579fbdd-dtbjt 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="环境准备过程中问题排查">环境准备过程中问题排查
&lt;/h2>&lt;h3 id="ip地址配置的问题">IP地址配置的问题
&lt;/h3>&lt;p>&lt;strong>/etc/network/interfaces 这个下面不要做配置，不生效.&lt;/strong>&lt;/p>
&lt;p>使用界面做的配置
Debian 12 默认使用 NetworkManager 或 systemd-networkd 管理网络，而不是传统的 ifupdown 工具。
如果 NetworkManager 或 systemd-networkd 正在管理网络接口，/etc/network/interfaces 的配置会被忽略。&lt;/p>
&lt;p>以下是排查过程
NetworkManager 正在管理该接口&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@master01:~# nmcli device status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEVICE TYPE STATE CONNECTION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ens33 ethernet connected Wired connection &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lo loopback connected &lt;span class="o">(&lt;/span>externally&lt;span class="o">)&lt;/span> lo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看 systemd-networkd 是否启用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@master01:~# systemctl status systemd-networkd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">○ systemd-networkd.service - Network Configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Loaded: loaded &lt;span class="o">(&lt;/span>/lib/systemd/system/systemd-networkd.service&lt;span class="p">;&lt;/span> disabled&lt;span class="p">;&lt;/span> preset: enabled&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Active: inactive &lt;span class="o">(&lt;/span>dead&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TriggeredBy: ○ systemd-networkd.socket
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Docs: man:systemd-networkd.service&lt;span class="o">(&lt;/span>8&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> man:org.freedesktop.network1&lt;span class="o">(&lt;/span>5&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="虚机重启后ipvs和br_netfilter未被加载">虚机重启后，ipvs和br_netfilter未被加载
&lt;/h3>&lt;p>虚机重启后，需要重新加载&lt;code>br_netfilter&lt;/code>模块。&lt;/p>
&lt;p>将 modprobe &amp;ndash; br_netfilter 命令加入到 /etc/ipvsadm.rules&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">vim /etc/systemd/system/ipvsadm.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将启动内容拷贝&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Unit&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Description&lt;/span>&lt;span class="o">=&lt;/span>IPVS Load Balancer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">After&lt;/span>&lt;span class="o">=&lt;/span>network.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Service&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Type&lt;/span>&lt;span class="o">=&lt;/span>oneshot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 启动时不能执行这条命令：/sbin/ipvsadm-restore &amp;lt; /etc/ipvsadm.rules&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 应该使用bash执行相应的规则文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>/bin/bash /etc/ipvsadm.rules
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStop&lt;/span>&lt;span class="o">=&lt;/span>/sbin/ipvsadm -C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">RemainAfterExit&lt;/span>&lt;span class="o">=&lt;/span>yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Install&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">WantedBy&lt;/span>&lt;span class="o">=&lt;/span>multi-user.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="error-cri-container-runtime-is-not-running">[ERROR CRI]: container runtime is not running
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 初始化时报这个错&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>init&lt;span class="o">]&lt;/span> Using Kubernetes version: v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Running pre-flight checks
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">error execution phase preflight: &lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Some fatal errors occurred:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span>ERROR CRI&lt;span class="o">]&lt;/span>: container runtime is not running: output: &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;2025-05-04T11:52:11-04:00&amp;#34;&lt;/span> &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>fatal &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;validate service connection: validate CRI v1 runtime API for endpoint \&amp;#34;unix:///var/run/containerd/containerd.sock\&amp;#34;: rpc error: code = Unimplemented desc = unknown service runtime.v1.RuntimeService&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">, error: &lt;span class="nb">exit&lt;/span> status &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span>ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables&lt;span class="o">]&lt;/span>: /proc/sys/net/bridge/bridge-nf-call-iptables does not exist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> If you know what you are doing, you can make a check non-fatal with &lt;span class="sb">`&lt;/span>--ignore-preflight-errors&lt;span class="o">=&lt;/span>...&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To see the stack trace of this error execute with --v&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> or higher
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>排查过程及解决方法，内核转发及网桥过滤模块没有加载，统一在&lt;code>主机配置 &amp;gt; 安装ipset及ipvsadm&lt;/code>步骤进行优化了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 解决容器运行时问题&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (1) 检查 containerd.md 是否已安装并运行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行以下命令检查 containerd.md 的状态：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status containerd.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (2) 验证 containerd.md 配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 确保 containerd.md 的配置文件（通常位于 /etc/containerd.md/config.toml）正确配置了 CRI（容器运行时接口）。运行以下命令生成默认配置（如果配置文件不存在）：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo containerd.md config default &lt;span class="p">|&lt;/span> sudo tee /etc/containerd.md/config.toml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (3) 重启 containerd.md&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改配置后，重启 containerd.md：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl restart containerd.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (4) 验证 containerd.md 是否支持 CRI&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行以下命令验证 containerd.md 是否支持 CRI：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ctr version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果输出显示版本信息，说明 containerd.md 已正确配置。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 解决 /proc/sys/net/bridge/bridge-nf-call-iptables 问题&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (1) 加载 br_netfilter 内核模块&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行以下命令加载 br_netfilter 模块：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo modprobe br_netfilter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (2) 确保模块已加载&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行以下命令检查模块是否已加载：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lsmod &lt;span class="p">|&lt;/span> grep br_netfilter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果输出显示 br_netfilter，说明模块已加载。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (3) 确保 /proc/sys/net/bridge/bridge-nf-call-iptables 存在&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行以下命令检查文件是否存在：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat /proc/sys/net/bridge/bridge-nf-call-iptables
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果文件不存在，可能是内核未正确配置。可以手动创建并设置值：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="p">|&lt;/span> sudo tee /proc/sys/net/bridge/bridge-nf-call-iptables
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (4) 永久生效&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 为了确保每次重启后配置仍然有效，编辑 /etc/sysctl.conf 文件：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo vim /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 添加以下内容：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-iptables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-ip6tables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 保存并退出，然后应用配置：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sysctl --system
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="kubectl-get-pods-状态未running">kubectl get pods 状态未Running
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl describe pod calico-apiserver-5b9b48d497-5ck29 -n calico-apiserver&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network is not ready: container runtime network not ready: &lt;span class="nv">NetworkReady&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span> reason:NetworkPluginNotReady message:docker: network plugin is not ready: cni config uninitialized
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 这个目录下没有配置文件，说明没有安装 CNI&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ls /etc/cni/net.d/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://docs.projectcalico.org/manifests/calico.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改配置文件中的这个配置项&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- name: CALICO_IPV4POOL_CIDR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &lt;span class="s2">&amp;#34;10.244.0.0/16&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl apply -f calico.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>1.1 Kubernetes集群UI及主机资源监控</title><link>https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/</link><pubDate>Mon, 22 Jul 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/</guid><description>&lt;img src="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/cover.jpg" alt="Featured image of post 1.1 Kubernetes集群UI及主机资源监控" />&lt;h1 id="kubernetes集群ui及主机资源监控">Kubernetes集群UI及主机资源监控
&lt;/h1>&lt;h2 id="kubernetes-dashboard作用">Kubernetes dashboard作用
&lt;/h2>&lt;ul>
&lt;li>通过dashboard能够直观了解Kubernetes集群中运行的资源对象&lt;/li>
&lt;li>通过dashboard可以直接管理（创建、删除、重启等操作）资源对象&lt;/li>
&lt;/ul>
&lt;h2 id="安装kubernetes-dashboard">安装kubernetes dashboard
&lt;/h2>&lt;p>&lt;a class="link" href="https://github.com/kubernetes/dashboard/blob/master/README.md" target="_blank" rel="noopener"
>参考链接：master的 dashboard/README.md ·kubernetes/dashboard&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener"
>helm参考链接：Helm | Installing Helm&lt;/a>&lt;/p>
&lt;h3 id="通过helm工具安装kubernetes-dashboard">通过helm工具安装kubernetes dashboard
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装helm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl https://baltocdn.com/helm/signing.asc &lt;span class="p">|&lt;/span> gpg --dearmor &lt;span class="p">|&lt;/span> sudo tee /usr/share/keyrings/helm.gpg &amp;gt; /dev/null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install apt-transport-https --yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;deb [arch=&lt;/span>&lt;span class="k">$(&lt;/span>dpkg --print-architecture&lt;span class="k">)&lt;/span>&lt;span class="s2"> signed-by=/usr/share/keyrings/helm.gpg] https://baltocdn.com/helm/stable/debian/ all main&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> sudo tee /etc/apt/sources.list.d/helm-stable-debian.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install helm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">helm version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 依赖科学上网&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Add kubernetes-dashboard repository&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;kubernetes-dashboard&amp;#34;&lt;/span> has been added to your repositories
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Deploy a Helm Release named &amp;#34;kubernetes-dashboard&amp;#34; using the kubernetes-dashboard chart&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># helm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard --create-namespace --namespace kubernetes-dashboard&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="命令执行后的回显">命令执行后的回显
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">Release &lt;span class="s2">&amp;#34;kubernetes-dashboard&amp;#34;&lt;/span> does not exist. Installing it now.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME: kubernetes-dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LAST DEPLOYED: Thu May &lt;span class="m">15&lt;/span> 04:25:22 &lt;span class="m">2025&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE: kubernetes-dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STATUS: deployed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REVISION: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TEST SUITE: None
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NOTES:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*** PLEASE BE PATIENT: Kubernetes Dashboard may need a few minutes to get up and become ready ***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Congratulations! You have just installed Kubernetes Dashboard in your cluster.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To access Dashboard run:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NOTE: In &lt;span class="k">case&lt;/span> port-forward &lt;span class="nb">command&lt;/span> does not work, make sure that kong service name is correct.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Check the services in Kubernetes Dashboard namespace using:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubectl -n kubernetes-dashboard get svc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Dashboard will be available at:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> https://localhost:8443
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="查看服务是否已启动">查看服务是否已启动
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">watch kubectl get pods -n kubernetes-dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 等待所有服务都为Running状态&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 可以使用下面的命令查看具体的情况，注意观察Events:中d&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># kubectl describe pods kubernetes-dashboard-api-7bcbc9b5bd-l76bc -n kubernetes-dashboard&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ImagePullBackOff 错误后，重新启动步骤如下&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1、将副本数缩放到 0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl scale deployment kubernetes-dashboard-auth --replicas&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> -n kubernetes-dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2、将副本数恢复到 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl scale deployment kubernetes-dashboard-auth --replicas&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> -n kubernetes-dashboard
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="浏览器localhost访问">浏览器localhost访问
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Forwarding from 127.0.0.1:8443 -&amp;gt; &lt;span class="m">8443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Forwarding from &lt;span class="o">[&lt;/span>::1&lt;span class="o">]&lt;/span>:8443 -&amp;gt; &lt;span class="m">8443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Handling connection &lt;span class="k">for&lt;/span> &lt;span class="m">8443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Handling connection &lt;span class="k">for&lt;/span> &lt;span class="m">8443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">E0515 07:19:42.893297 &lt;span class="m">73613&lt;/span> portforward.go:409&lt;span class="o">]&lt;/span> an error occurred forwarding &lt;span class="m">8443&lt;/span> -&amp;gt; 8443: error forwarding port &lt;span class="m">8443&lt;/span> to pod 161802690a0f8d6f42e5761323b2aafa46ff37baf8eba8e44675e0ef760f08b7, uid : unable to &lt;span class="k">do&lt;/span> port forwarding: socat not found
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上日志说明环境缺少 &lt;code>socat&lt;/code> ，安装之&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install socat
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>登录界面&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2.png"
width="1280"
height="800"
srcset="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2_hu_32019b034cfb1023.png 480w, https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2_hu_ceb0460a338b8919.png 1024w"
loading="lazy"
alt="image-dashboard登录界面"
class="gallery-image"
data-flex-grow="160"
data-flex-basis="384px"
>&lt;/p>
&lt;p>查看&lt;code>kubernetes-dashboard&lt;/code>下的账户&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl -n kubernetes-dashboard get serviceaccounts
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>创建账户&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl -n kubernetes-dashboard create serviceaccount kubernetes-dashboard&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">serviceaccount/kubernetes-dashboard created
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>绑定角色权限&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl create clusterrolebinding kubernetes-dashboard-admin &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --clusterrole&lt;span class="o">=&lt;/span>cluster-admin &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --serviceaccount&lt;span class="o">=&lt;/span>kubernetes-dashboard:kubernetes-dashboard
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>生成 Token&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl -n kubernetes-dashboard create token kubernetes-dashboard
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>通过token成功访问&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F.png"
width="1280"
height="800"
srcset="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F_hu_e8e00ccab3a97dc6.png 480w, https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F_hu_ef3201ce50efd574.png 1024w"
loading="lazy"
alt="image-dashboard登录成功"
class="gallery-image"
data-flex-grow="160"
data-flex-basis="384px"
>&lt;/p>
&lt;h3 id="浏览器节点访问">浏览器节点访问
&lt;/h3>&lt;p>&lt;strong>检查 NodePort 服务配置&lt;/strong>&lt;/p>
&lt;p>确保 &lt;code>kubernetes-dashboard&lt;/code> 服务已正确配置为 &lt;code>NodePort&lt;/code>，并且端口范围在 &lt;code>30000-32767&lt;/code> 之间。&lt;/p>
&lt;p>&lt;strong>检查服务配置&lt;/strong>&lt;/p>
&lt;p>运行以下命令，查看服务的配置：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl -n kubernetes-dashboard get svc kubernetes-dashboard-kong-proxy -o yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>确认以下字段：&lt;/p>
&lt;ul>
&lt;li>&lt;code>spec.type&lt;/code> 应为 &lt;code>NodePort&lt;/code>。&lt;/li>
&lt;li>&lt;code>spec.ports[0].nodePort&lt;/code> 应为 &lt;code>32000&lt;/code>。&lt;/li>
&lt;/ul>
&lt;p>如果配置不正确，可以通过以下命令更新：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl -n kubernetes-dashboard patch svc kubernetes-dashboard-kong-proxy -p &lt;span class="s1">&amp;#39;{&amp;#34;spec&amp;#34;:{&amp;#34;type&amp;#34;:&amp;#34;NodePort&amp;#34;,&amp;#34;ports&amp;#34;:[{&amp;#34;port&amp;#34;:443,&amp;#34;targetPort&amp;#34;:8443,&amp;#34;nodePort&amp;#34;:32000}]}}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>获取节点 IP&lt;/strong>
运行以下命令，获取节点的 IP 地址：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl get nodes -o wide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用 EXTERNAL-IP 或 INTERNAL-IP 访问 Dashboard。&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>生成 Token&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl -n kubernetes-dashboard create token kubernetes-dashboard
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>通过token成功访问&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E8%8A%82%E7%82%B9%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F.png"
width="3000"
height="1754"
srcset="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E8%8A%82%E7%82%B9%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F_hu_341505ebf277ed9.png 480w, https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E8%8A%82%E7%82%B9%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F_hu_488d6754384e9d4b.png 1024w"
loading="lazy"
alt="image-dashboard节点登录成功"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="410px"
>&lt;/p>
&lt;h2 id="安装metrics-server">安装metrics-server
&lt;/h2>&lt;p>使用metrics-server实现主机资源监控，它可以解决的问题：解决上图中CPU和内存使用情况的获取&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/kubernetes-sigs/metrics-server/releases" target="_blank" rel="noopener"
>资源参考链接：Releases · kubernetes-sigs/metrics-server&lt;/a>&lt;/p>
&lt;h3 id="通过配置文件进行安装">通过配置文件进行安装
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 下载资源安装配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.7.2/components.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 因为在使用 metrics-server 过程中没有创建证书，所以添加非安全的tls配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - args:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - --cert-dir&lt;span class="o">=&lt;/span>/tmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - --secure-port&lt;span class="o">=&lt;/span>&lt;span class="m">10250&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - --kubelet-preferred-address-types&lt;span class="o">=&lt;/span>InternalIP,ExternalIP,Hostname
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - --kubelet-use-node-status-port
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - --metric-resolution&lt;span class="o">=&lt;/span>15s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - --kubelet-insecure-tls &lt;span class="c1"># 这一行为添加内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装之&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl apply -f components.yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">serviceaccount/metrics-server created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/system:metrics-server created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrolebinding.rbac.authorization.k8s.io/system:metrics-server created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/metrics-server created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps/metrics-server created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="验证及授权">验证及授权
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods -n kube-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-gbgsh 1/1 Running &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-pm85d 1/1 Running &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-k8s-master01 1/1 Running &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-apiserver-k8s-master01 1/1 Running &lt;span class="m">13&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-controller-manager-k8s-master01 1/1 Running &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-h7s9b 1/1 Running &lt;span class="m">6&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-qt8px 1/1 Running &lt;span class="m">6&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-wlvrg 1/1 Running &lt;span class="m">6&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-scheduler-k8s-master01 1/1 Running &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metrics-server-596474b58-697f8 1/1 Running &lt;span class="m">0&lt;/span> 102s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl top pods -n kube-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME CPU&lt;span class="o">(&lt;/span>cores&lt;span class="o">)&lt;/span> MEMORY&lt;span class="o">(&lt;/span>bytes&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-gbgsh 2m 22Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-pm85d 2m 51Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-k8s-master01 19m 128Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-apiserver-k8s-master01 42m 532Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-controller-manager-k8s-master01 11m 115Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-h7s9b 1m 59Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-qt8px 1m 50Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-wlvrg 1m 52Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-scheduler-k8s-master01 3m 49Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metrics-server-596474b58-697f8 2m 22Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl top nodes -n kube-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME CPU&lt;span class="o">(&lt;/span>cores&lt;span class="o">)&lt;/span> CPU% MEMORY&lt;span class="o">(&lt;/span>bytes&lt;span class="o">)&lt;/span> MEMORY%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 131m 3% 4385Mi 86%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 41m 1% 2149Mi 76%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 45m 1% 2241Mi 79%
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5.png"
width="3000"
height="1754"
srcset="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5_hu_77352025d40cb66b.png 480w, https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5_hu_cd4bf98a45e82224.png 1024w"
loading="lazy"
alt="image-dashboard资源使用情况"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="410px"
>&lt;/p></description></item><item><title>1.0 keepalived</title><link>https://caijemmy.github.io/p/1.0-keepalived/</link><pubDate>Mon, 24 Jun 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/1.0-keepalived/</guid><description>&lt;img src="https://caijemmy.github.io/p/1.0-keepalived/cover.jpg" alt="Featured image of post 1.0 keepalived" />&lt;h2 id="什么是-keepalived">什么是 Keepalived？
&lt;/h2>&lt;p>官网地址：https://keepalived.org/&lt;/p>
&lt;p>Keepalived 是一个基于 &lt;strong>VRRP（Virtual Router Redundancy Protocol，虚拟路由器冗余协议）&lt;/strong> 的高可用性解决方案，主要用于实现 &lt;strong>IP 故障转移&lt;/strong> 和 &lt;strong>负载均衡&lt;/strong>。它通过将多个服务器组成一个虚拟路由器组，确保在主服务器故障时，备用服务器可以接管其 IP 地址和服务，从而实现高可用性。&lt;/p>
&lt;h2 id="keepalived-的核心功能">Keepalived 的核心功能
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>IP 故障转移（Failover）：&lt;/p>
&lt;ul>
&lt;li>当主服务器故障时，备用服务器会自动接管其 IP 地址，确保服务不中断。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>健康检查（Health Check）：&lt;/p>
&lt;ul>
&lt;li>支持对后端服务（如 Nginx、Apache、MySQL 等）进行健康检查，确保只有健康的服务器才会接管 IP 地址。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>负载均衡：&lt;/p>
&lt;ul>
&lt;li>支持基于 Layer 4（传输层）的负载均衡，可以将请求分发到多个后端服务器。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="keepalived-的工作原理">Keepalived 的工作原理
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>VRRP 协议：&lt;/p>
&lt;ul>
&lt;li>Keepalived 使用 VRRP 协议在多个服务器之间同步状态。&lt;/li>
&lt;li>每个服务器在 VRRP 组中有一个优先级（Priority），优先级最高的服务器成为主服务器（Master），其他服务器成为备用服务器（Backup）。&lt;/li>
&lt;li>主服务器负责持有虚拟 IP 地址（VIP），备用服务器处于待命状态。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>故障检测：&lt;/p>
&lt;ul>
&lt;li>Keepalived 通过健康检查机制检测主服务器的状态。&lt;/li>
&lt;li>如果主服务器故障，备用服务器中优先级最高的服务器会接管 VIP，成为新的主服务器。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>状态切换：&lt;/p>
&lt;ul>
&lt;li>当主服务器恢复后，可以根据配置决定是否重新接管 VIP。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="keepalived-的典型应用场景">Keepalived 的典型应用场景
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>高可用性集群：&lt;/p>
&lt;ul>
&lt;li>用于实现 Web 服务器（如 Nginx、Apache）、数据库（如 MySQL）、负载均衡器（如 HAProxy）等的高可用性。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>负载均衡：&lt;/p>
&lt;ul>
&lt;li>通过 Keepalived 和 IPVS（IP Virtual Server）实现基于 Layer 4 的负载均衡。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>网络冗余：&lt;/p>
&lt;ul>
&lt;li>用于确保关键网络服务（如网关、防火墙）的高可用性。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="keepalived-的安装与配置">Keepalived 的安装与配置
&lt;/h2>&lt;h3 id="1-安装-keepalived">1. 安装 Keepalived
&lt;/h3>&lt;p>在基于 Debian/Ubuntu 的系统上：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo apt update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install keepalived
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在基于 CentOS/RHEL 的系统上：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo yum install keepalived
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-配置-keepalived">2. 配置 Keepalived
&lt;/h3>&lt;p>Keepalived 的配置文件通常位于 &lt;code>/etc/keepalived/keepalived.conf&lt;/code>。&lt;/p>
&lt;h4 id="示例配置高可用性-web-服务器">示例配置：高可用性 Web 服务器
&lt;/h4>&lt;p>假设有两台服务器：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>主服务器&lt;/strong>：192.168.1.101&lt;/li>
&lt;li>&lt;strong>备用服务器&lt;/strong>：192.168.1.102&lt;/li>
&lt;li>&lt;strong>虚拟 IP 地址（VIP）&lt;/strong>：192.168.1.100&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>主服务器配置&lt;/strong>：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">vrrp_instance VI_1 &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> state MASTER &lt;span class="c1"># 主服务器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interface eth0 &lt;span class="c1"># 使用的网卡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> virtual_router_id &lt;span class="m">51&lt;/span> &lt;span class="c1"># VRRP 组 ID，范围 0-255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> priority &lt;span class="m">100&lt;/span> &lt;span class="c1"># 优先级，主服务器优先级最高&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> advert_int &lt;span class="m">1&lt;/span> &lt;span class="c1"># VRRP 广播间隔（秒）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> auth_type PASS &lt;span class="c1"># 认证类型&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> auth_pass &lt;span class="m">1234&lt;/span> &lt;span class="c1"># 认证密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> virtual_ipaddress &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 192.168.1.100 &lt;span class="c1"># 虚拟 IP 地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>备用服务器配置&lt;/strong>：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">vrrp_instance VI_1 &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> state BACKUP &lt;span class="c1"># 备用服务器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interface eth0 &lt;span class="c1"># 使用的网卡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> virtual_router_id &lt;span class="m">51&lt;/span> &lt;span class="c1"># VRRP 组 ID，与主服务器一致&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> priority &lt;span class="m">90&lt;/span> &lt;span class="c1"># 优先级，低于主服务器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> advert_int &lt;span class="m">1&lt;/span> &lt;span class="c1"># VRRP 广播间隔（秒）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> auth_type PASS &lt;span class="c1"># 认证类型&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> auth_pass &lt;span class="m">1234&lt;/span> &lt;span class="c1"># 认证密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> virtual_ipaddress &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 192.168.1.100 &lt;span class="c1"># 虚拟 IP 地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="3-启动-keepalived">3. 启动 Keepalived
&lt;/h3>&lt;p>在主服务器和备用服务器上启动 Keepalived：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo systemctl start keepalived
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> keepalived
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="4-测试故障转移">4. 测试故障转移
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>在主服务器上停止 Keepalived：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo systemctl stop keepalived
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>检查备用服务器是否接管了 VIP：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">ip addr show eth0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>恢复主服务器，检查 VIP 是否重新接管。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="keepalived-的健康检查">Keepalived 的健康检查
&lt;/h2>&lt;p>Keepalived 支持对后端服务进行健康检查，确保只有健康的服务器才会接管 VIP。&lt;/p>
&lt;h3 id="示例nginx-健康检查">示例：Nginx 健康检查
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">vrrp_script chk_nginx &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> script &lt;span class="s2">&amp;#34;/usr/bin/pgrep nginx&amp;#34;&lt;/span> &lt;span class="c1"># 检查 Nginx 是否运行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interval &lt;span class="m">2&lt;/span> &lt;span class="c1"># 检查间隔（秒）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> weight &lt;span class="m">2&lt;/span> &lt;span class="c1"># 优先级增减值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vrrp_instance VI_1 &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> state MASTER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interface eth0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> virtual_router_id &lt;span class="m">51&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> priority &lt;span class="m">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> advert_int &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> auth_type PASS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> auth_pass &lt;span class="m">1234&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> virtual_ipaddress &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 192.168.1.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> track_script &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> chk_nginx &lt;span class="c1"># 引用健康检查脚本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="keepalived-的日志">Keepalived 的日志
&lt;/h2>&lt;p>Keepalived 的日志默认输出到 &lt;code>/var/log/syslog&lt;/code>（Debian/Ubuntu）或 &lt;code>/var/log/messages&lt;/code>（CentOS/RHEL）。可以通过以下命令查看日志：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">tail -f /var/log/syslog &lt;span class="p">|&lt;/span> grep keepalived
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>1.0 lua</title><link>https://caijemmy.github.io/p/1.0-lua/</link><pubDate>Mon, 24 Jun 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/1.0-lua/</guid><description>&lt;img src="https://caijemmy.github.io/p/1.0-lua/cover.jpg" alt="Featured image of post 1.0 lua" />&lt;h1 id="lua入门">lua入门
&lt;/h1>&lt;p>官网：&lt;a class="link" href="https://www.lua.org/" target="_blank" rel="noopener"
>https://www.lua.org&lt;/a>&lt;/p>
&lt;p>Lua 是一种轻量级、高效、可嵌入的脚本语言&lt;/p>
&lt;p>教程参考：&lt;a class="link" href="https://www.runoob.com/lua/lua-tutorial.html" target="_blank" rel="noopener"
>https://www.runoob.com/lua/lua-tutorial.html&lt;/a>&lt;/p>
&lt;h2 id="安装lua">安装lua
&lt;/h2>&lt;ul>
&lt;li>Linux 环境已安装 gcc、make。其他环境安装可以参考：&lt;a class="link" href="https://www.runoob.com/lua/lua-environment.html" target="_blank" rel="noopener"
>https://www.runoob.com/lua/lua-environment.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:~# curl -L -R -O https://www.lua.org/ftp/lua-5.4.7.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# tar zxf lua-5.4.7.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# &lt;span class="nb">cd&lt;/span> lua-5.4.7/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~/lua-5.4.7# make all &lt;span class="nb">test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~/lua-5.4.7# make install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> src &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> mkdir -p /usr/local/bin /usr/local/include /usr/local/lib /usr/local/man/man1 /usr/local/share/lua/5.4 /usr/local/lib/lua/5.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> src &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> install -p -m &lt;span class="m">0755&lt;/span> lua luac /usr/local/bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> src &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> install -p -m &lt;span class="m">0644&lt;/span> lua.h luaconf.h lualib.h lauxlib.h lua.hpp /usr/local/include
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> src &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> install -p -m &lt;span class="m">0644&lt;/span> liblua.a /usr/local/lib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> doc &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> install -p -m &lt;span class="m">0644&lt;/span> lua.1 luac.1 /usr/local/man/man1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;print(&amp;#34;Hello World!&amp;#34;)&amp;#39;&lt;/span> &amp;gt; HelloWorld.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# lua HelloWorld.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hello World!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="基本语法">基本语法
&lt;/h2>&lt;h3 id="交互式">交互式
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:~# lua -i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Lua 5.4.7 Copyright &lt;span class="o">(&lt;/span>C&lt;span class="o">)&lt;/span> 1994-2024 Lua.org, PUC-Rio
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; print&lt;span class="o">(&lt;/span>&lt;span class="s2">&amp;#34;hello lua&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hello lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; os.exit&lt;span class="o">()&lt;/span> &lt;span class="c1"># 退出交互式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="脚本式">脚本式
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:~# cat HelloWorld.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">print&lt;span class="o">(&lt;/span>&lt;span class="s2">&amp;#34;Hello World!&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# lua ./HelloWorld.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hello World!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="注释">注释
&lt;/h3>&lt;h4 id="单行">单行
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:~# cat HelloWorld.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-- 这是注释
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">print&lt;span class="o">(&lt;/span>&lt;span class="s2">&amp;#34;Hello World!&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# lua ./HelloWorld.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hello World!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="多行">多行
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:~# cat HelloWorld.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--&lt;span class="o">[[&lt;/span> 这是注释
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">这是多行注释
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--&lt;span class="o">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">print&lt;span class="o">(&lt;/span>&lt;span class="s2">&amp;#34;Hello World!&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:~# lua ./HelloWorld.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hello World!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>多行注释不支持嵌套&lt;/li>
&lt;/ul>
&lt;h3 id="标识符">标识符
&lt;/h3>&lt;p>Lua 标识符用于定义一个变量，函数获取其他用户定义的项。标识符以一个字母 A 到 Z 或 a 到 z 或下划线 &lt;strong>_&lt;/strong> 开头后加上 0 个或多个字母，下划线，数字（0 到 9）。&lt;/p>
&lt;p>最好不要使用下划线加大写字母的标识符，因为Lua的保留字也是这样的。&lt;/p>
&lt;p>Lua 不允许使用特殊字符如 &lt;strong>@&lt;/strong>, &lt;strong>$&lt;/strong>, 和 &lt;strong>%&lt;/strong> 来定义标识符。 Lua 是一个区分大小写的编程语言。&lt;/p>
&lt;h3 id="关键词">关键词
&lt;/h3>&lt;p>以下列出了 Lua 的保留关键词。保留关键字不能作为常量或变量或其他用户自定义标示符：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>and&lt;/th>
&lt;th>break&lt;/th>
&lt;th>do&lt;/th>
&lt;th>else&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>elseif&lt;/td>
&lt;td>end&lt;/td>
&lt;td>false&lt;/td>
&lt;td>for&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>function&lt;/td>
&lt;td>if&lt;/td>
&lt;td>in&lt;/td>
&lt;td>local&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>nil&lt;/td>
&lt;td>not&lt;/td>
&lt;td>or&lt;/td>
&lt;td>repeat&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>return&lt;/td>
&lt;td>then&lt;/td>
&lt;td>true&lt;/td>
&lt;td>until&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>while&lt;/td>
&lt;td>goto&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>一般约定，以下划线开头连接一串大写字母的名字（比如 _VERSION）被保留用于 Lua 内部全局变量。&lt;/p>
&lt;h3 id="全局变量">全局变量
&lt;/h3>&lt;p>在默认情况下，变量总是认为是全局的。&lt;/p>
&lt;p>全局变量不需要声明，给一个变量赋值后即创建了这个全局变量，访问一个没有初始化的全局变量也不会出错，只不过得到的结果是：nil。&lt;/p>
&lt;p>如果你想删除一个全局变量，只需要将变量赋值为nil。换句话说, 当且仅当一个变量不等于nil时，这个变量即存在。&lt;/p>
&lt;h2 id="数据类型">数据类型
&lt;/h2>&lt;p>Lua 是动态类型语言，变量不要类型定义,只需要为变量赋值。 值可以存储在变量中，作为参数传递或结果返回。&lt;/p>
&lt;p>Lua 中有 8 个基本类型分别为：nil、boolean、number、string、userdata、function、thread 和 table。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">数据类型&lt;/th>
&lt;th style="text-align: left">描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">nil&lt;/td>
&lt;td style="text-align: left">这个最简单，只有值nil属于该类，表示一个无效值（在条件表达式中相当于false）。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">boolean&lt;/td>
&lt;td style="text-align: left">包含两个值：false和true。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">number&lt;/td>
&lt;td style="text-align: left">表示双精度类型的实浮点数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">string&lt;/td>
&lt;td style="text-align: left">字符串由一对双引号或单引号来表示&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">function&lt;/td>
&lt;td style="text-align: left">由 C 或 Lua 编写的函数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">userdata&lt;/td>
&lt;td style="text-align: left">表示任意存储在变量中的C数据结构&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">thread&lt;/td>
&lt;td style="text-align: left">表示执行的独立线路，用于执行协同程序&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">table&lt;/td>
&lt;td style="text-align: left">Lua 中的表（table）其实是一个&amp;quot;关联数组&amp;quot;（associative arrays），数组的索引可以是数字、字符串或表类型。在 Lua 里，table 的创建是通过&amp;quot;构造表达式&amp;quot;来完成，最简单构造表达式是{}，用来创建一个空表。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="nil空">nil（空）
&lt;/h3>&lt;ul>
&lt;li>nil 类型表示一种没有任何有效值，它只有一个值 &amp;ndash; nil，例如打印一个没有赋值的变量，便会输出一个 nil 值&lt;/li>
&lt;li>对于全局变量和 table，nil 还有一个&amp;quot;删除&amp;quot;作用，给全局变量或者 table 表里的变量赋一个 nil 值，等同于把它们删掉&lt;/li>
&lt;li>nil 作比较时应该加上双引号 &amp;quot;&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 对保留字nil进行type运算，结果返回nil字符串&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">nil&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">nil&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 未定义变量返回的也是nil字符串&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 对于全局变量和 table，nil 起&amp;#34;删除&amp;#34;作用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xx&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;oo&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">xx&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xx&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">xx&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tab1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">key1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;val1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">key2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;val2&amp;#34;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">for&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="kr">in&lt;/span> &lt;span class="n">pairs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tab1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kr">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="s2">&amp;#34; - &amp;#34;&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tab1.key1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">for&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="kr">in&lt;/span> &lt;span class="n">pairs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tab1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kr">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="s2">&amp;#34; - &amp;#34;&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- nil 作比较时应该加上双引号 &amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="kc">nil&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="s2">&amp;#34;nil&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行结果&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/lua# lua ./lua_type/test_nil.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nil
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nil
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">oo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nil
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">key1 - val1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">key2 - val2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">key2 - val2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="boolean布尔">boolean（布尔）
&lt;/h3>&lt;p>boolean 类型只有两个可选值：true（真） 和 false（假），Lua 把 false 和 nil 看作是 false，其他的都为 true，数字 0 也是 true&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">nil&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">if&lt;/span> &lt;span class="kc">false&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="kr">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;至少有一个是 true&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;false 和 nil 都为 false&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">if&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="kr">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;数字 0 是 true&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;数字 0 为 false&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:/opt/lua# lua ./lua_type/test_boolean.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">boolean
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">boolean
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nil
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">false&lt;/span> 和 nil 都为 &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">数字 &lt;span class="m">0&lt;/span> 是 &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="number数字">number（数字）
&lt;/h3>&lt;p>Lua 默认只有一种 number 类型 &amp;ndash; double（双精度）类型（默认类型可以修改 luaconf.h 里的定义），以下几种写法都被看作是 number 类型&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">2.2&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.2&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">2e+1&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">0.2e-1&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mf">7.8263692594256e-06&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:/opt/lua# lua ./lua_type/test_number.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">number
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">number
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">number
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">number
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">number
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">number
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="string字符串">string（字符串）
&lt;/h3>&lt;ul>
&lt;li>字符串由一对双引号或单引号来表示。&lt;/li>
&lt;li>也可以用 2 个方括号 &amp;ldquo;[[]]&amp;rdquo; 来表示&amp;quot;一块&amp;quot;字符串，&lt;strong>不支持嵌套&lt;/strong>。&lt;/li>
&lt;li>在对一个数字字符串上进行算术操作时，Lua 会尝试将这个数字字符串转成一个数字，&lt;strong>数字字符串中有非数字时，报错&lt;/strong>。&lt;/li>
&lt;li>使用 # 来计算字符串的长度，放在字符串前面，&lt;strong>1汉字为3个长度&lt;/strong>。&lt;/li>
&lt;li>字符串连接使用的是 ..&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 字符串中如果需要单引号或双引号，需根据字符串使用情况进行转义&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">string1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;this is&amp;#39; &amp;#39;&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">string1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">string2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;this is &amp;#34;string2&lt;/span>&lt;span class="se">\&amp;#39;&lt;/span>&lt;span class="s1">&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">string1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">string2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 块字符串不支持嵌套&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">html&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">[[
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">这是块字符串
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">块字符串不支持嵌套
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">html&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 在对一个数字字符串上进行算术操作时，Lua 会尝试将这个数字字符串转成一个数字&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;6&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2 + 6&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;-2e2&amp;#34;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="s2">&amp;#34;6&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- print(&amp;#34;error&amp;#34; + 1) -- attempt to add a &amp;#39;string&amp;#39; with a &amp;#39;number&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2.1&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 字符串连接&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;a&amp;#34;&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="s1">&amp;#39;b&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">157&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="mi">428&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 计算字符串的长度&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">len_test&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;你好 世界&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">#&lt;/span>&lt;span class="n">len_test&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">#&lt;/span>&lt;span class="s2">&amp;#34;你好 lua&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:/opt/lua# lua ./lua_type/test_string.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">this is&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="s2">&amp;#34;string1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">this is &amp;#34;&lt;/span>string2&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="s2">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">这是块字符串
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">块字符串不支持嵌套
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">8
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">8
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">2 + 6
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">-1200.0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">3.1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">ab
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">157428
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">13
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">10
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="table表">table（表）
&lt;/h3>&lt;p>在 Lua 里，table 的创建是通过&amp;quot;构造表达式&amp;quot;来完成，最简单构造表达式是{}，用来创建一个空表。也可以在表里添加一些数据，直接初始化表。&lt;/p>
&lt;p>Lua 中的表（table）其实是一个&amp;quot;关联数组&amp;quot;（associative arrays），数组的索引可以是数字或者是字符串。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 创建一个空的 table&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">local&lt;/span> &lt;span class="n">tbl1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">for&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="kr">in&lt;/span> &lt;span class="n">pairs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tbl1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kr">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="s2">&amp;#34; : &amp;#34;&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 直接初始表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">local&lt;/span> &lt;span class="n">tbl2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s2">&amp;#34;apple&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;pear&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;orange&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;grape&amp;#34;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">for&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="kr">in&lt;/span> &lt;span class="n">pairs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tbl2&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kr">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="s2">&amp;#34; : &amp;#34;&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行结果&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@debian:/opt/lua# lua ./lua_type/test_table.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1&lt;/span> : apple
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">2&lt;/span> : pear
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">3&lt;/span> : orange
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">4&lt;/span> : grape
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>不同于其他语言的数组把 0 作为数组的初始索引，在 Lua 里表的默认初始索引一般以 1 开始。&lt;/li>
&lt;li>table 不会固定长度大小，有新数据添加时 table 长度会自动增长，没初始的 table 都是 nil。&lt;/li>
&lt;/ul>
&lt;h3 id="function函数">function（函数）
&lt;/h3>&lt;p>在 Lua 中，函数是被看作是&amp;quot;第一类值（First-Class Value）&amp;quot;，函数可以存在变量里:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">function&lt;/span> &lt;span class="nf">factorial1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">if&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="kr">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">factorial1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">factorial1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">factorial2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">factorial1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">factorial2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:/opt/lua# lua ./lua_type/test_func.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">120&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">120&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="匿名函数anonymous-function">匿名函数（anonymous function）
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">function&lt;/span> &lt;span class="nf">testFun&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tab&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fun&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">for&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="kr">in&lt;/span> &lt;span class="n">pairs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tab&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="kr">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fun&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tab&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">key1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;val1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">key2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;val2&amp;#34;&lt;/span> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">testFun&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tab&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">val&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">--匿名函数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="s2">&amp;#34;=&amp;#34;&lt;/span> &lt;span class="o">..&lt;/span> &lt;span class="n">val&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@debian:/opt/lua# lua ./lua_type/test_func.lua
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">120&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">120&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">key2&lt;/span>&lt;span class="o">=&lt;/span>val2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">key1&lt;/span>&lt;span class="o">=&lt;/span>val1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="thread线程">thread（线程）
&lt;/h3>&lt;p>在 Lua 里，最主要的线程是协同程序（coroutine）。它跟线程（thread）差不多，拥有自己独立的栈、局部变量和指令指针，可以跟其他协同程序共享全局变量和其他大部分东西。&lt;/p>
&lt;p>线程跟协程的区别：线程可以同时多个运行，而协程任意时刻只能运行一个，并且处于运行状态的协程只有被挂起（suspend）时才会暂停。&lt;/p>
&lt;h3 id="userdata自定义类型">userdata（自定义类型）
&lt;/h3>&lt;p>userdata 是一种用户自定义数据，用于表示一种由应用程序或 C/C++ 语言库所创建的类型，可以将任意 C/C++ 的任意数据类型的数据（通常是 struct 和 指针）存储到 Lua 变量中调用。&lt;/p></description></item></channel></rss>