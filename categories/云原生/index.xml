<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>云原生 on 暮鼓晨钟</title><link>https://caijemmy.github.io/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/</link><description>Recent content in 云原生 on 暮鼓晨钟</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Wed, 24 Jul 2024 00:00:00 +0000</lastBuildDate><atom:link href="https://caijemmy.github.io/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/index.xml" rel="self" type="application/rss+xml"/><item><title>3.0 Kubernetes集群核心概念Pod</title><link>https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/</link><pubDate>Wed, 24 Jul 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/</guid><description>&lt;img src="https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/cover.jpg" alt="Featured image of post 3.0 Kubernetes集群核心概念Pod" />&lt;h1 id="kubernetes集群核心概念-pod">Kubernetes集群核心概念 Pod
&lt;/h1>&lt;h2 id="工作负载workloads">工作负载(workloads)
&lt;/h2>&lt;p>参考链接：&lt;a class="link" href="https://kubernetes.io/zh-cn/docs/concepts/workloads/" target="_blank" rel="noopener"
>工作负载 | Kubernetes&lt;/a>&lt;/p>
&lt;p>工作负载（workload）是在kubernetes集群中运行的应用程序。无论你的工作负载是单一服务还是多个一同工作的服务构成，在kubernetes中都可以使用pod来运行它。&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/image-%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD.png"
width="1911"
height="845"
srcset="https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/image-%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD_hu_9eb8ce042826bc19.png 480w, https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/image-%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD_hu_cdc57ea1b2baf247.png 1024w"
loading="lazy"
alt="image-工作负载"
class="gallery-image"
data-flex-grow="226"
data-flex-basis="542px"
>&lt;/p>
&lt;p>workloads分为pod与controllers&lt;/p>
&lt;ul>
&lt;li>pod通过控制器实现应用的运行，如何伸缩，升级等&lt;/li>
&lt;li>controllers 在集群中管理pod&lt;/li>
&lt;li>pod与控制器之间通过label-selector相关联，是唯一的关联方式&lt;/li>
&lt;/ul>
&lt;p>在pod的YAML里指定pod标签&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 定义标签&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app: nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在控制器的YAML里指定标签选择器匹配标签&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 通过标签选择器选择对应的pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> selector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> matchLabels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app: nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="pod介绍">pod介绍
&lt;/h2>&lt;p>参考链接: &lt;a class="link" href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/" target="_blank" rel="noopener"
>Pod | Kubernetes&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/image-pod%E6%98%AF%E4%BB%80%E4%B9%88.png"
width="1606"
height="787"
srcset="https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/image-pod%E6%98%AF%E4%BB%80%E4%B9%88_hu_b10ab4509ccdf644.png 480w, https://caijemmy.github.io/p/3.0-kubernetes%E9%9B%86%E7%BE%A4%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/image-pod%E6%98%AF%E4%BB%80%E4%B9%88_hu_120f7edbb52a069a.png 1024w"
loading="lazy"
alt="image-pod是什么"
class="gallery-image"
data-flex-grow="204"
data-flex-basis="489px"
>&lt;/p>
&lt;h3 id="查看pod方法">查看pod方法
&lt;/h3>&lt;p>pod是一种计算资源，可以通过&lt;code>kubectl get pod&lt;/code>来查看&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod # pod或pods都可以，不指定namespace,默认是名为default的namespace&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No resources found in default namespace.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod -n kube-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-gbgsh 1/1 Running &lt;span class="m">13&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-pm85d 1/1 Running &lt;span class="m">13&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-k8s-master01 1/1 Running &lt;span class="m">13&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-apiserver-k8s-master01 1/1 Running &lt;span class="m">14&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-controller-manager-k8s-master01 1/1 Running &lt;span class="m">13&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-h7s9b 1/1 Running &lt;span class="m">7&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 3d20h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-qt8px 1/1 Running &lt;span class="m">7&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 3d20h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-wlvrg 1/1 Running &lt;span class="m">7&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 3d20h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-scheduler-k8s-master01 1/1 Running &lt;span class="m">13&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 4d4h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metrics-server-596474b58-697f8 1/1 Running &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>17h ago&lt;span class="o">)&lt;/span> 19h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="pod的yaml资源清单格式">pod的YAML资源清单格式
&lt;/h3>&lt;p>YAML格式查找帮助方法&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl explain namespace&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl explain pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl explain pod.spec&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl explain pod.spec.containers&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>样例，及供参考。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># yaml格式的pod定义文件完整内容：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1 &lt;span class="c1">#必选，api版本号，例如v1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Pod &lt;span class="c1">#必选，Pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata: &lt;span class="c1">#必选，元数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: string &lt;span class="c1">#必选，Pod名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: string &lt;span class="c1">#Pod所属的命名空间,默认在default的namespace&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels: &lt;span class="c1"># 自定义标签&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: string &lt;span class="c1">#自定义标签名字&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> annotations: &lt;span class="c1">#自定义注释列表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec: &lt;span class="c1">#必选，Pod中容器的详细定义(期望)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containers: &lt;span class="c1">#必选，Pod中容器列表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string &lt;span class="c1">#必选，容器名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image: string &lt;span class="c1">#必选，容器的镜像名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imagePullPolicy: &lt;span class="o">[&lt;/span>Always &lt;span class="p">|&lt;/span> Never &lt;span class="p">|&lt;/span> IfNotPresent&lt;span class="o">]&lt;/span> &lt;span class="c1">#获取镜像的策略 Alawys表示下载镜像 IfnotPresent表示优先使用本地镜像，否则下载镜像，Nerver表示仅使用本地镜像&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command: &lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span> &lt;span class="c1">#容器的启动命令列表，如不指定，使用打包时使用的启动命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> args: &lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span> &lt;span class="c1">#容器的启动命令参数列表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> workingDir: string &lt;span class="c1">#容器的工作目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> volumeMounts: &lt;span class="c1">#挂载到容器内部的存储卷配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string &lt;span class="c1">#引用pod定义的共享存储卷的名称，需用volumes[]部分定义的的卷名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mountPath: string &lt;span class="c1">#存储卷在容器内mount的绝对路径，应少于512字符&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> readOnly: boolean &lt;span class="c1">#是否为只读模式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ports: &lt;span class="c1">#需要暴露的端口库号列表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string &lt;span class="c1">#端口号名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containerPort: int &lt;span class="c1">#容器需要监听的端口号&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostPort: int &lt;span class="c1">#容器所在主机需要监听的端口号，默认与Container相同&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> protocol: string &lt;span class="c1">#端口协议，支持TCP和UDP，默认TCP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> env: &lt;span class="c1">#容器运行前需设置的环境变量列表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string &lt;span class="c1">#环境变量名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: string &lt;span class="c1">#环境变量的值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resources: &lt;span class="c1">#资源限制和请求的设置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> limits: &lt;span class="c1">#资源限制的设置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpu: string &lt;span class="c1">#Cpu的限制，单位为core数，将用于docker run --cpu-shares参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory: string &lt;span class="c1">#内存限制，单位可以为Mib/Gib，将用于docker run --memory参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> requests: &lt;span class="c1">#资源请求的设置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpu: string &lt;span class="c1">#Cpu请求，容器启动的初始可用数量&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory: string &lt;span class="c1">#内存清求，容器启动的初始可用数量&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> livenessProbe: &lt;span class="c1">#对Pod内个容器健康检查的设置，当探测无响应几次后将自动重启该容器，检查方法有exec、httpGet和tcpSocket，对一个容器只需设置其中一种方法即可&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> exec: &lt;span class="c1">#对Pod容器内检查方式设置为exec方式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command: &lt;span class="o">[&lt;/span>string&lt;span class="o">]&lt;/span> &lt;span class="c1">#exec方式需要制定的命令或脚本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> httpGet: &lt;span class="c1">#对Pod内个容器健康检查方法设置为HttpGet，需要制定Path、port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> path: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: number
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> host: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> scheme: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HttpHeaders:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tcpSocket: &lt;span class="c1">#对Pod内个容器健康检查方式设置为tcpSocket方式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: number
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> initialDelaySeconds: &lt;span class="m">0&lt;/span> &lt;span class="c1">#容器启动完成后首次探测的时间，单位为秒&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeoutSeconds: &lt;span class="m">0&lt;/span> &lt;span class="c1">#对容器健康检查探测等待响应的超时时间，单位秒，默认1秒&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> periodSeconds: &lt;span class="m">0&lt;/span> &lt;span class="c1">#对容器监控检查的定期探测时间设置，单位秒，默认10秒一次&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> successThreshold: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> failureThreshold: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> securityContext:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> privileged:false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> restartPolicy: &lt;span class="o">[&lt;/span>Always &lt;span class="p">|&lt;/span> Never &lt;span class="p">|&lt;/span> OnFailure&lt;span class="o">]&lt;/span> &lt;span class="c1"># Pod的重启策略，Always表示一旦不管以何种方式终止运行，kubelet都将重启，OnFailure表示只有Pod以非0退出码退出才重启，Nerver表示不再重启该Pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodeSelector: obeject &lt;span class="c1"># 设置NodeSelector表示将该Pod调度到包含这个label的node上，以key：value的格式指定&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imagePullSecrets: &lt;span class="c1">#Pull镜像时使用的secret名称，以key：secretkey格式指定&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostNetwork: &lt;span class="nb">false&lt;/span> &lt;span class="c1">#是否使用主机网络模式，默认为false，如果设置为true，表示使用宿主机网络&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> volumes: &lt;span class="c1">#在该pod上定义共享存储卷列表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: string &lt;span class="c1">#共享存储卷名称 （volumes类型有很多种）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> emptyDir: &lt;span class="o">{}&lt;/span> &lt;span class="c1">#类型为emtyDir的存储卷，与Pod同生命周期的一个临时目录。为空值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostPath: string &lt;span class="c1">#类型为hostPath的存储卷，表示挂载Pod所在宿主机的目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> path: string &lt;span class="c1">#Pod所在宿主机的目录，将被用于同期中mount的目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> secret: &lt;span class="c1">#类型为secret的存储卷，挂载集群与定义的secret对象到容器内部&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> scretname: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> items:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - key: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> path: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> configMap: &lt;span class="c1">#类型为configMap的存储卷，挂载预定义的configMap对象到容器内部&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> items:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - key: string
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> path: string
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="pod创建与验证">pod创建与验证
&lt;/h2>&lt;h3 id="命令创建podv118变化">命令创建pod(v1.18变化)
&lt;/h3>&lt;ul>
&lt;li>k8s之前版本中, kubectl run命令用于创建deployment控制器&lt;/li>
&lt;li>在v1.18版本中, kubectl run命令改为创建pod&lt;/li>
&lt;/ul>
&lt;h4 id="创建一个名为pod-nginx的pod">创建一个名为pod-nginx的pod
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl run nginx1 --image=nginx&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/nginx1 created
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="验证">验证
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx1 1/1 Running &lt;span class="m">0&lt;/span> 41s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># NAME：Pod 的名称。名称在同一命名空间内必须唯一。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># READY：Pod 中容器的就绪状态。格式为 就绪容器数量/总容器数量。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># STATUS：Pod 的当前状态。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 常见的状态包括：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Running：Pod 中的所有容器已成功启动并正在运行。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Pending：Pod 已被调度到节点，但容器尚未启动（例如，正在拉取镜像）。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Succeeded：Pod 中的所有容器已成功完成任务并退出。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Failed：Pod 中的至少一个容器因错误退出。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># CrashLoopBackOff：容器启动失败，Kubernetes 正在重试。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Unknown：无法获取 Pod 的状态（通常是由于与节点通信失败）。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># RESTARTS：Pod 中容器的重启次数。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># AGE：Pod 的存活时间。从 Pod 创建到当前时间的时间间隔。时间单位可以是秒（s）、分钟（m）、小时（h）或天（d）。&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="yaml创建pod">YAML创建pod
&lt;/h3>&lt;h4 id="准备yaml文件">准备yaml文件
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># vim pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1 &lt;span class="c1"># api版本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Pod &lt;span class="c1"># 资源类型为Pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: pod-stress &lt;span class="c1"># 自定义pod的名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containers: &lt;span class="c1"># 定义pod里包含的容器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: c1 &lt;span class="c1"># 自定义pod中的容器名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image: polinux/stress &lt;span class="c1"># 启动容器的镜像名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;stress&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="c1"># 自定义启动容器时要执行的命令(类似dockerfile里的CMD)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> args: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;--vm&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;--vm-bytes&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;150M&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;--vm-hang&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="c1"># 自定义启动容器执行命令的参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># polinux/stress这个镜像用于压力测试,在启动容器时传命令与参数就是相当于分配容器运行时需要的压力&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl apply -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress created
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="查看pod信息">查看pod信息
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 3m32s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod -o wide&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 4m14s 10.244.69.215 k8s-worker02 &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl describe pod pod-stress&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: pod-stress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Namespace: default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Events:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Reason Age From Message
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ---- ---- -------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Scheduled 4m50s default-scheduler Successfully assigned default/pod-stress to k8s-worker02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Pulling 4m49s kubelet Pulling image &lt;span class="s2">&amp;#34;polinux/stress&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Pulled 4m38s kubelet Successfully pulled image &lt;span class="s2">&amp;#34;polinux/stress&amp;#34;&lt;/span> in 11.549s &lt;span class="o">(&lt;/span>11.549s including waiting&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Created 4m38s kubelet Created container c1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Started 4m38s kubelet Started container c1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="删除pod">删除pod
&lt;/h3>&lt;h4 id="单个pod删除">单个pod删除
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方式1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl delete -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod &lt;span class="s2">&amp;#34;pod-stress&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方式2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl delete pod pod-stress&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="多个pod删除">多个pod删除
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方法1: 后接多个pod名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master1 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl delete pod pod名1 pod名2 pod名3 ......&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方法2: 通过awk截取要删除的pod名称，然后管道给xargs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master1 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods |awk &amp;#39;NR&amp;gt;1 {print $1}&amp;#39; |xargs kubectl delete pod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方法3: 如果要删除的pod都在同一个非default的命名空间，则可直接删除命名空间&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master1 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl delete ns xxxx&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="镜像拉取策略">镜像拉取策略
&lt;/h3>&lt;p>由imagePullPolicy参数控制&lt;/p>
&lt;ul>
&lt;li>Always : 不管本地有没有镜像，都要从仓库中下载镜像&lt;/li>
&lt;li>Never : 从来不从仓库下载镜像, 只用本地镜像,本地没有就算了&lt;/li>
&lt;li>IfNotPresent: 如果本地存在就直接使用, 不存在才从仓库下载&lt;/li>
&lt;/ul>
&lt;p>默认的策略是：&lt;/p>
&lt;ul>
&lt;li>当镜像标签版本是latest，默认策略就是Always&lt;/li>
&lt;li>如果指定特定版本默认拉取策略就是IfNotPresent。&lt;/li>
&lt;/ul>
&lt;h4 id="将上面的pod删除再创建使用下面命令查看信息">将上面的pod删除再创建，使用下面命令查看信息
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl delete -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod &lt;span class="s2">&amp;#34;pod-stress&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No resources found in default namespace.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># docker images | grep stress&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">polinux/stress latest df58d15b053d &lt;span class="m">5&lt;/span> years ago 9.74MB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl apply -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl describe pod pod-stress&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Events:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Reason Age From Message
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ---- ---- -------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Scheduled 26s default-scheduler Successfully assigned default/pod-stress to k8s-worker02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Pulling 25s kubelet Pulling image &lt;span class="s2">&amp;#34;polinux/stress&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Pulled 17s kubelet Successfully pulled image &lt;span class="s2">&amp;#34;polinux/stress&amp;#34;&lt;/span> in 7.253s &lt;span class="o">(&lt;/span>7.253s including waiting&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Created 17s kubelet Created container c1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Started 17s kubelet Started container c1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>说明: 可以看到第二行信息还是&lt;code>pulling image&lt;/code>下载镜像&lt;/strong>&lt;/p>
&lt;h4 id="修改yaml">修改YAML
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># cat pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Pod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: pod-stress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: c1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image: polinux/stress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;stress&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> args: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;--vm&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;--vm-bytes&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;150M&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;--vm-hang&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imagePullPolicy: IfNotPresent &lt;span class="c1"># 增加了这一句&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="再次删除再创建">再次删除再创建
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl delete -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod &lt;span class="s2">&amp;#34;pod-stress&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl apply -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl describe pod pod-stress&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Events:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Reason Age From Message
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ---- ---- -------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Scheduled 18s default-scheduler Successfully assigned default/pod-stress to k8s-worker02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Pulled 17s kubelet Container image &lt;span class="s2">&amp;#34;polinux/stress&amp;#34;&lt;/span> already present on machine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Created 17s kubelet Created container c1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Started 17s kubelet Started container c1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>说明: 第二行信息是说镜像已经存在，直接使用了&lt;/strong>&lt;/p>
&lt;h3 id="pod的标签">pod的标签
&lt;/h3>&lt;ul>
&lt;li>为pod设置label,用于控制器通过label与pod关联&lt;/li>
&lt;li>语法与前面学的node标签几乎一致&lt;/li>
&lt;/ul>
&lt;h4 id="通过命令管理pod标签">通过命令管理Pod标签
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod pod-stress --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 4m58s &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label pod pod-stress region=huanan zone=A env=test bussiness=game&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod pod-stress --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 7m27s &lt;span class="nv">bussiness&lt;/span>&lt;span class="o">=&lt;/span>game,env&lt;span class="o">=&lt;/span>test,region&lt;span class="o">=&lt;/span>huanan,zone&lt;span class="o">=&lt;/span>A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods -l zone=A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 8m45s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods -l &amp;#34;zone in (A,B,C)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 9m22s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label pod pod-stress zone=B --overwrite=true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod pod-stress --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 11m &lt;span class="nv">bussiness&lt;/span>&lt;span class="o">=&lt;/span>game,env&lt;span class="o">=&lt;/span>test,region&lt;span class="o">=&lt;/span>huanan,zone&lt;span class="o">=&lt;/span>B
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label pod pod-stress bussiness- env- region- zone-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress unlabeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod pod-stress --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 12m &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>小结:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>pod的label与node的label操作方式几乎相同&lt;/li>
&lt;li>node的label用于pod调度到指定label的node节点&lt;/li>
&lt;li>pod的label用于controller关联控制的pod&lt;/li>
&lt;/ul>
&lt;h4 id="通过yaml创建pod时添加标签">通过YAML创建Pod时添加标签
&lt;/h4>&lt;p>修改yaml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Pod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: pod-stress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels: &lt;span class="c1"># 增加多个标签&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> env: dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app: nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: c1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> image: polinux/stress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> command: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;stress&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> args: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;--vm&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;--vm-bytes&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;150M&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;--vm-hang&amp;#34;&lt;/span>, &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> imagePullPolicy: IfNotPresent
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>直接apply应用&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl apply -f pod1.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/pod-stress configured
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>验证&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pod pod-stress --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod-stress 1/1 Running &lt;span class="m">0&lt;/span> 16m &lt;span class="nv">app&lt;/span>&lt;span class="o">=&lt;/span>nginx,env&lt;span class="o">=&lt;/span>dev
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>4.0 kubernetes核心概念Controller</title><link>https://caijemmy.github.io/p/4.0-kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5controller/</link><pubDate>Wed, 24 Jul 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/4.0-kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5controller/</guid><description>&lt;img src="https://caijemmy.github.io/p/4.0-kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5controller/cover.jpg" alt="Featured image of post 4.0 kubernetes核心概念Controller" />&lt;h1 id="kubernetes核心概念-controller">kubernetes核心概念 Controller
&lt;/h1>&lt;h2 id="pod控制器controller">pod控制器controller
&lt;/h2>&lt;h3 id="controller作用及分类">Controller作用及分类
&lt;/h3>&lt;p>参考: &lt;a class="link" href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/" target="_blank" rel="noopener"
>工作负载管理 | Kubernetes&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/4.0-kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5controller/image-controller%E5%88%86%E7%B1%BB.png"
width="1895"
height="1051"
srcset="https://caijemmy.github.io/p/4.0-kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5controller/image-controller%E5%88%86%E7%B1%BB_hu_d25a81c2f74e4dba.png 480w, https://caijemmy.github.io/p/4.0-kubernetes%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5controller/image-controller%E5%88%86%E7%B1%BB_hu_a881f27a54378454.png 1024w"
loading="lazy"
alt="image-controller分类"
class="gallery-image"
data-flex-grow="180"
data-flex-basis="432px"
>&lt;/p>
&lt;h3 id="deployment">Deployment
&lt;/h3></description></item><item><title>2.0 Kubernetes集群Node管理</title><link>https://caijemmy.github.io/p/2.0-kubernetes%E9%9B%86%E7%BE%A4node%E7%AE%A1%E7%90%86/</link><pubDate>Tue, 23 Jul 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/2.0-kubernetes%E9%9B%86%E7%BE%A4node%E7%AE%A1%E7%90%86/</guid><description>&lt;img src="https://caijemmy.github.io/p/2.0-kubernetes%E9%9B%86%E7%BE%A4node%E7%AE%A1%E7%90%86/cover.jpg" alt="Featured image of post 2.0 Kubernetes集群Node管理" />&lt;h1 id="kubernetes集群node管理">Kubernetes集群Node管理
&lt;/h1>&lt;p>&lt;img src="https://caijemmy.github.io/p/2.0-kubernetes%E9%9B%86%E7%BE%A4node%E7%AE%A1%E7%90%86/image-node%E7%AE%A1%E7%90%86.jpg"
width="2392"
height="1231"
srcset="https://caijemmy.github.io/p/2.0-kubernetes%E9%9B%86%E7%BE%A4node%E7%AE%A1%E7%90%86/image-node%E7%AE%A1%E7%90%86_hu_2ed481cf5a2ea76b.jpg 480w, https://caijemmy.github.io/p/2.0-kubernetes%E9%9B%86%E7%BE%A4node%E7%AE%A1%E7%90%86/image-node%E7%AE%A1%E7%90%86_hu_4e55511947d6a392.jpg 1024w"
loading="lazy"
alt="image-node管理"
class="gallery-image"
data-flex-grow="194"
data-flex-basis="466px"
>&lt;/p>
&lt;h2 id="查看集群信息">查看集群信息
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl cluster-info&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Kubernetes control plane is running at https://192.168.52.129:6443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CoreDNS is running at https://192.168.52.129:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To further debug and diagnose cluster problems, use &lt;span class="s1">&amp;#39;kubectl cluster-info dump&amp;#39;&lt;/span>.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="查看节点信息">查看节点信息
&lt;/h2>&lt;h3 id="查看集群节点信息">查看集群节点信息
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 34h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="查看集群节点详细信息">查看集群节点详细信息
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes -o wide&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 34h v1.28.15 192.168.52.129 &amp;lt;none&amp;gt; Debian GNU/Linux &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>bookworm&lt;span class="o">)&lt;/span> 6.1.0-34-amd64 docker://28.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15 192.168.52.140 &amp;lt;none&amp;gt; Debian GNU/Linux &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>bookworm&lt;span class="o">)&lt;/span> 6.1.0-34-amd64 docker://28.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15 192.168.52.141 &amp;lt;none&amp;gt; Debian GNU/Linux &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>bookworm&lt;span class="o">)&lt;/span> 6.1.0-34-amd64 docker://28.1.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="查看节点描述详细信息">查看节点描述详细信息
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl describe node k8s-master01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: k8s-master01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Roles: control-plane
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Labels: beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-master01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubernetes.io/os&lt;span class="o">=&lt;/span>linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node-role.kubernetes.io/control-plane&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node.kubernetes.io/exclude-from-external-load-balancers&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Annotations: csi.volume.kubernetes.io/nodeid: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;csi.tigera.io&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;k8s-master01&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubeadm.alpha.kubernetes.io/cri-socket: unix:///var/run/cri-dockerd.sock
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node.alpha.kubernetes.io/ttl: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> projectcalico.org/IPv4Address: 192.168.52.129/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> projectcalico.org/IPv4VXLANTunnelAddr: 10.244.32.128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> volumes.kubernetes.io/controller-managed-attach-detach: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CreationTimestamp: Mon, &lt;span class="m">12&lt;/span> May &lt;span class="m">2025&lt;/span> 00:14:17 -0400
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Taints: node-role.kubernetes.io/control-plane:NoSchedule
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Unschedulable: &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Lease:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HolderIdentity: k8s-master01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AcquireTime: &amp;lt;unset&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RenewTime: Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 11:01:37 -0400
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Conditions:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Status LastHeartbeatTime LastTransitionTime Reason Message
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ----------------- ------------------ ------ -------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> NetworkUnavailable False Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 10:56:59 -0400 Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 10:56:59 -0400 CalicoIsUp Calico is running on this node
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> MemoryPressure False Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 10:56:41 -0400 Mon, &lt;span class="m">12&lt;/span> May &lt;span class="m">2025&lt;/span> 00:14:16 -0400 KubeletHasSufficientMemory kubelet has sufficient memory available
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> DiskPressure False Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 10:56:41 -0400 Mon, &lt;span class="m">12&lt;/span> May &lt;span class="m">2025&lt;/span> 00:14:16 -0400 KubeletHasNoDiskPressure kubelet has no disk pressure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PIDPressure False Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 10:56:41 -0400 Mon, &lt;span class="m">12&lt;/span> May &lt;span class="m">2025&lt;/span> 00:14:16 -0400 KubeletHasSufficientPID kubelet has sufficient PID available
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ready True Tue, &lt;span class="m">13&lt;/span> May &lt;span class="m">2025&lt;/span> 10:56:41 -0400 Mon, &lt;span class="m">12&lt;/span> May &lt;span class="m">2025&lt;/span> 05:46:53 -0400 KubeletReady kubelet is posting ready status. AppArmor enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Addresses:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> InternalIP: 192.168.52.129
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Hostname: k8s-master01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Capacity:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpu: &lt;span class="m">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ephemeral-storage: 101639152Ki
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hugepages-1Gi: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hugepages-2Mi: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory: 5284488Ki
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pods: &lt;span class="m">110&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Allocatable:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpu: &lt;span class="m">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ephemeral-storage: &lt;span class="m">93670642329&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hugepages-1Gi: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hugepages-2Mi: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory: 5182088Ki
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pods: &lt;span class="m">110&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">System Info:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Machine ID: f0d5fce3fd2f48b7ae64f003370f9732
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> System UUID: 7bf54d56-e453-1f28-83fb-20ad43599d29
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Boot ID: ec68e796-ffa6-4076-89f4-ebaae9433dbb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Kernel Version: 6.1.0-34-amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> OS Image: Debian GNU/Linux &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>bookworm&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Operating System: linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Architecture: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Container Runtime Version: docker://28.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Kubelet Version: v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Kube-Proxy Version: v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PodCIDR: 10.244.0.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PodCIDRs: 10.244.0.0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Non-terminated Pods: &lt;span class="o">(&lt;/span>&lt;span class="m">15&lt;/span> in total&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Namespace Name CPU Requests CPU Limits Memory Requests Memory Limits Age
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --------- ---- ------------ ---------- --------------- ------------- ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-apiserver calico-apiserver-5b9b48d497-5ck29 &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-apiserver calico-apiserver-5b9b48d497-lm8jm &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-system calico-kube-controllers-789b9578b6-296xf &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-system calico-node-vll2x 250m &lt;span class="o">(&lt;/span>6%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 27h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-system calico-typha-5dd4d5c669-7mcsb &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 27h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-system csi-node-driver-gwsql &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> calico-system goldmane-8456f8bf4d-vdc4h &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system coredns-5dd5756b68-gbgsh 100m &lt;span class="o">(&lt;/span>2%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 70Mi &lt;span class="o">(&lt;/span>1%&lt;span class="o">)&lt;/span> 170Mi &lt;span class="o">(&lt;/span>3%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system coredns-5dd5756b68-pm85d 100m &lt;span class="o">(&lt;/span>2%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 70Mi &lt;span class="o">(&lt;/span>1%&lt;span class="o">)&lt;/span> 170Mi &lt;span class="o">(&lt;/span>3%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system etcd-k8s-master01 100m &lt;span class="o">(&lt;/span>2%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 100Mi &lt;span class="o">(&lt;/span>1%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system kube-apiserver-k8s-master01 250m &lt;span class="o">(&lt;/span>6%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system kube-controller-manager-k8s-master01 200m &lt;span class="o">(&lt;/span>5%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system kube-proxy-qt8px &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 26h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kube-system kube-scheduler-k8s-master01 100m &lt;span class="o">(&lt;/span>2%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tigera-operator tigera-operator-5b59476cb-gnd5z &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> 34h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Allocated resources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">(&lt;/span>Total limits may be over &lt;span class="m">100&lt;/span> percent, i.e., overcommitted.&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Resource Requests Limits
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -------- -------- ------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cpu 1100m &lt;span class="o">(&lt;/span>27%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> memory 240Mi &lt;span class="o">(&lt;/span>4%&lt;span class="o">)&lt;/span> 340Mi &lt;span class="o">(&lt;/span>6%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ephemeral-storage &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hugepages-1Gi &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hugepages-2Mi &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>0%&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Events:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Reason Age From Message
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ---- ------ ---- ---- -------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Starting 115m kube-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Starting 4m56s kube-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeHasSufficientMemory 117m &lt;span class="o">(&lt;/span>x8 over 117m&lt;span class="o">)&lt;/span> kubelet Node k8s-master01 status is now: NodeHasSufficientMemory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Warning InvalidDiskCapacity 117m kubelet invalid capacity &lt;span class="m">0&lt;/span> on image filesystem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeHasNoDiskPressure 117m &lt;span class="o">(&lt;/span>x7 over 117m&lt;span class="o">)&lt;/span> kubelet Node k8s-master01 status is now: NodeHasNoDiskPressure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeHasSufficientPID 117m &lt;span class="o">(&lt;/span>x7 over 117m&lt;span class="o">)&lt;/span> kubelet Node k8s-master01 status is now: NodeHasSufficientPID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeAllocatableEnforced 117m kubelet Updated Node Allocatable limit across pods
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Starting 117m kubelet Starting kubelet.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal RegisteredNode 116m node-controller Node k8s-master01 event: Registered Node k8s-master01 in Controller
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal Starting 5m7s kubelet Starting kubelet.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Warning InvalidDiskCapacity 5m7s kubelet invalid capacity &lt;span class="m">0&lt;/span> on image filesystem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeHasSufficientMemory 5m7s &lt;span class="o">(&lt;/span>x8 over 5m7s&lt;span class="o">)&lt;/span> kubelet Node k8s-master01 status is now: NodeHasSufficientMemory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeHasNoDiskPressure 5m7s &lt;span class="o">(&lt;/span>x7 over 5m7s&lt;span class="o">)&lt;/span> kubelet Node k8s-master01 status is now: NodeHasNoDiskPressure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeHasSufficientPID 5m7s &lt;span class="o">(&lt;/span>x7 over 5m7s&lt;span class="o">)&lt;/span> kubelet Node k8s-master01 status is now: NodeHasSufficientPID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal NodeAllocatableEnforced 5m7s kubelet Updated Node Allocatable limit across pods
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Normal RegisteredNode 4m32s node-controller Node k8s-master01 event: Registered Node k8s-master01 in Controller
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="worker-node节点管理集群">worker node节点管理集群
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>&lt;strong>如果是kubeasz安装，所有节点(包括master与node)都已经可以对集群进行管理&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>如果是kubeadm安装，在node节点上管理时会报如下错误&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-worker01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The connection to the server localhost:8080 was refused - did you specify the right host or port?
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>只要把master上的管理文件&lt;code>/etc/kubernetes/admin.conf&lt;/code>拷贝到node节点的&lt;code>$HOME/.kube/config&lt;/code>就可以让node节点也可以实现kubectl命令管理&lt;/p>
&lt;p>1, 在node节点的用户家目录创建&lt;code>.kube&lt;/code>目录&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-worker01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># mkdir /root/.kube&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>2, 在worker节点做如下操作&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-worker01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># [ ! -f /root/.kube/config ] &amp;amp;&amp;amp; scp k8s-master01:/etc/kubernetes/admin.conf /root/.kube/config&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>3, 在worker node节点验证&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-worker01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 34h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="节点标签label">节点标签(label)
&lt;/h2>&lt;ul>
&lt;li>k8s集群如果由大量节点组成，可将节点打上对应的标签，然后通过标签进行筛选及查看,更好的进行资源对象的相关选择与匹配&lt;/li>
&lt;/ul>
&lt;h3 id="查看节点标签信息">查看节点标签信息
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get node --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 34h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-master01,kubernetes.io/os&lt;span class="o">=&lt;/span>linux,node-role.kubernetes.io/control-plane&lt;span class="o">=&lt;/span>,node.kubernetes.io/exclude-from-external-load-balancers&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-worker01,kubernetes.io/os&lt;span class="o">=&lt;/span>linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-worker02,kubernetes.io/os&lt;span class="o">=&lt;/span>linux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="设置节点标签信息">设置节点标签信息
&lt;/h3>&lt;h4 id="设置节点标签">设置节点标签
&lt;/h4>&lt;p>为节点&lt;code>k8s-worker01&lt;/code>打一个&lt;code>region=cainiao&lt;/code> 的标签&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label node k8s-worker01 region=cainiao&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/k8s-worker01 labeled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="查看所有节点标签">查看所有节点标签
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get node --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 34h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-master01,kubernetes.io/os&lt;span class="o">=&lt;/span>linux,node-role.kubernetes.io/control-plane&lt;span class="o">=&lt;/span>,node.kubernetes.io/exclude-from-external-load-balancers&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-worker01,kubernetes.io/os&lt;span class="o">=&lt;/span>linux,region&lt;span class="o">=&lt;/span>cainiao
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-worker02,kubernetes.io/os&lt;span class="o">=&lt;/span>linux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="查看所有节点带region的标签">查看所有节点带region的标签
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes -L region&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION REGION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 34h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15 cainiao
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="多维度标签">多维度标签
&lt;/h3>&lt;h4 id="设置多维度标签">设置多维度标签
&lt;/h4>&lt;p>也可以加其它的多维度标签,用于不同的需要区分的场景&lt;/p>
&lt;p>如把&lt;code>k8s-worker02&lt;/code>标签为华南区,A机房,测试环境,游戏业务&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label node k8s-worker02 zone=A env=test bussiness=game&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/k8s-worker02 labeled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes k8s-worker02 --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,bussiness&lt;span class="o">=&lt;/span>game,env&lt;span class="o">=&lt;/span>test,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-worker02,kubernetes.io/os&lt;span class="o">=&lt;/span>linux,zone&lt;span class="o">=&lt;/span>A
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="显示节点的相应标签">显示节点的相应标签
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes -L region,zone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION REGION ZONE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 35h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15 cainiao
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15 A
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="查找regioncainiao的节点">查找&lt;code>region=cainiao&lt;/code>的节点
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes -l region=cainiao&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 31h v1.28.15
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="标签的修改">标签的修改
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label node k8s-worker02 bussiness=ad --overwrite=true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/k8s-worker02 labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">加上--overwrite&lt;span class="o">=&lt;/span>true覆盖原标签的value进行修改操作
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get node k8s-worker02 -L bussiness&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION BUSSINESS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 31h v1.28.15 ad
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="标签的删除">标签的删除
&lt;/h4>&lt;p>使用key加一个减号的写法来取消标签&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label node k8s-worker01 region-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/k8s-worker01 unlabeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes k8s-worker01 --show-labels&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 32h v1.28.15 beta.kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,beta.kubernetes.io/os&lt;span class="o">=&lt;/span>linux,kubernetes.io/arch&lt;span class="o">=&lt;/span>amd64,kubernetes.io/hostname&lt;span class="o">=&lt;/span>k8s-worker01,kubernetes.io/os&lt;span class="o">=&lt;/span>linux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="标签选择器">标签选择器
&lt;/h4>&lt;p>标签选择器主要有2类:&lt;/p>
&lt;ul>
&lt;li>等值关系: =, !=&lt;/li>
&lt;li>集合关系: KEY in {VALUE1, VALUE2&amp;hellip;&amp;hellip;}&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label node k8s-master01 env=test1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/k8s-master01 labeled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl label node k8s-worker01 env=test2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node/k8s-worker01 labeled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get node -l &amp;#34;env in (test1,test2)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 35h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 32h v1.28.15
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>1.0 kubeadm部署单Master节点kubernetes集群</title><link>https://caijemmy.github.io/p/1.0-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95master%E8%8A%82%E7%82%B9kubernetes%E9%9B%86%E7%BE%A4/</link><pubDate>Mon, 22 Jul 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/1.0-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95master%E8%8A%82%E7%82%B9kubernetes%E9%9B%86%E7%BE%A4/</guid><description>&lt;img src="https://caijemmy.github.io/p/1.0-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95master%E8%8A%82%E7%82%B9kubernetes%E9%9B%86%E7%BE%A4/cover.jpg" alt="Featured image of post 1.0 kubeadm部署单Master节点kubernetes集群" />&lt;h1 id="kubeadm部署单master节点kubernetes集群">kubeadm部署单Master节点kubernetes集群
&lt;/h1>&lt;h2 id="kubernetes-12815-部署环境准备">kubernetes 1.28.15 部署环境准备
&lt;/h2>&lt;h3 id="主机操作系统说明">主机操作系统说明
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: center">序号&lt;/th>
&lt;th style="text-align: center">操作系统及版本&lt;/th>
&lt;th style="text-align: center">备注&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: center">1&lt;/td>
&lt;td style="text-align: center">Debian GNU/Linux 12 (bookworm)&lt;/td>
&lt;td style="text-align: center">Debian 6.1.135-1 (2025-04-25)&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="主机硬件配置说明">主机硬件配置说明
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>需求&lt;/th>
&lt;th>CPU&lt;/th>
&lt;th>内存&lt;/th>
&lt;th>硬盘&lt;/th>
&lt;th>角色&lt;/th>
&lt;th>主机名&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>值&lt;/td>
&lt;td>4C&lt;/td>
&lt;td>4G&lt;/td>
&lt;td>100GB&lt;/td>
&lt;td>master&lt;/td>
&lt;td>k8s-master01&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>值&lt;/td>
&lt;td>4C&lt;/td>
&lt;td>4G&lt;/td>
&lt;td>100GB&lt;/td>
&lt;td>worker(node)&lt;/td>
&lt;td>k8s-worker01&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>值&lt;/td>
&lt;td>4C&lt;/td>
&lt;td>4G&lt;/td>
&lt;td>100GB&lt;/td>
&lt;td>worker(node)&lt;/td>
&lt;td>k8s-worker02&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="主机配置">主机配置
&lt;/h3>&lt;h4 id="配置root-账号可以直接登录">配置root 账号可以直接登录
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 虚机配置过程，已经提炼为shell脚本，参考 VM/init_vm.sh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># vim /etc/ssh/sshd_config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PermitRootLogin yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl restart ssh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="主机名配置">主机名配置
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># master节点,名称为k8s-master01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hostnamectl set-hostname k8s-master01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># worker1节点,名称为k8s-worker01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hostnamectl set-hostname k8s-worker01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># worker2节点,名称为k8s-worker02&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hostnamectl set-hostname k8s-worker02
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="主机ip地址配置">主机IP地址配置
&lt;/h4>&lt;p>NetworkManager 的配置文件位于 /etc/NetworkManager/system-connections/ 目录下。可以通过编辑配置文件来设置静态 IP。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方式1：修改以下部分：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> /etc/NetworkManager/system-connections/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mv &lt;span class="s2">&amp;#34;Wired connection 1&amp;#34;&lt;/span> master01_ens33.nmconnection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>ipv4&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">method&lt;/span>&lt;span class="o">=&lt;/span>manual
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">address1&lt;/span>&lt;span class="o">=&lt;/span>192.168.52.129/24,192.168.52.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">dns&lt;/span>&lt;span class="o">=&lt;/span>192.168.52.2&lt;span class="p">;&lt;/span>8.8.8.8&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行以下命令重新加载配置：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection down master01_ens33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection up master01_ens33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 方式2：命令修改以下部分：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> /etc/NetworkManager/system-connections/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mv &lt;span class="s2">&amp;#34;Wired connection 1&amp;#34;&lt;/span> master01_ens33.nmconnection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection modify master01_ens33 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> ipv4.method manual &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> ipv4.addresses 192.168.52.129/24 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> ipv4.gateway 192.168.52.2 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> ipv4.dns &lt;span class="s2">&amp;#34;192.168.52.2 8.8.8.8&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 激活连接&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection down master01_ens33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection up master01_ens33
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nmcli connection down master01_ens33 &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> sudo nmcli connection up master01_ens33
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="主机名与ip地址解析">主机名与IP地址解析
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有集群主机均需要进行配置。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cat /etc/hosts&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">::1 localhost localhost.localdomain localhost6 localhost6.localdomain6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.129 k8s-master01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.140 k8s-worker01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.52.141 k8s-worker02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 验证： ping -c 4 k8s-master01 &amp;amp;&amp;amp; ping -c 4 k8s-worker01 &amp;amp;&amp;amp; ping -c 4 k8s-worker02&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="防火墙配置">防火墙配置
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有主机均需要操作。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在 Debian 12 中，默认的防火墙工具是 nftables（替代了之前的 iptables）。以下是关闭防火墙和查看防火墙状态的命令：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 检查 nftables 状态&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo nft list ruleset
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 检查 firewalld 状态（如果安装了）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo firewall-cmd --state
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 检查 ufw 状态（如果安装了）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ufw status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl status nftables.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="selinux配置">SELINUX配置
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有主机均需要操作。修改SELinux配置需要重启操作系统。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sed -ri &amp;#39;s/SELINUX=enforcing/SELINUX=disabled/&amp;#39; /etc/selinux/config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在 Debian 系统中，默认不安装 SELinux。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo aa-status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果输出显示 apparmor module is loaded，表示 AppArmor 正在运行。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在 Debian 系统上安装 Kubernetes 时，通常不需要关闭 AppArmor。AppArmor 与 Kubernetes 和常见容器运行时兼容，&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 并提供额外的安全性。只有在特定情况下（如配置不当或兼容性问题）才需要关闭 AppArmor。&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="时间同步配置">时间同步配置
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有主机均需要操作。最小化安装系统需要安装ntpdate软件。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># apt -y install ntpdate&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crontab -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">0&lt;/span> */1 * * * /usr/sbin/ntpdate time1.aliyun.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="升级操作系统内核">升级操作系统内核
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有主机均需要操作。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt upgrade
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置内核转发及网桥过滤">配置内核转发及网桥过滤
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有主机均需要操作。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 添加网桥过滤及内核转发配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cat /etc/sysctl.d/k8s.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-ip6tables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-iptables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.ipv4.ip_forward &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vm.swappiness &lt;span class="o">=&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 加载br_netfilter模块&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">modprobe br_netfilter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看是否加载&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lsmod | grep br_netfilter&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">br_netfilter &lt;span class="m">22256&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bridge &lt;span class="m">151336&lt;/span> &lt;span class="m">1&lt;/span> br_netfilter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 加载网桥过滤及内核转发配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sysctl -p /etc/sysctl.d/k8s.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-ip6tables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-iptables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.ipv4.ip_forward &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vm.swappiness &lt;span class="o">=&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="安装ipset及ipvsadm">安装ipset及ipvsadm
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 所有主机均需要操作。主要用于实现service转发。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装ipset及ipvsadm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt -y install ipset ipvsadm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置ipvsadm模块加载方式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 添加需要加载的模块，这里需要把br_netfilter也加上，减少一个配置内核转发及网桥过滤的单独服务。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &amp;gt; /etc/ipvsadm.rules &lt;span class="s">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">modprobe -- br_netfilter
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">modprobe -- ip_vs
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">modprobe -- ip_vs_rr
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">modprobe -- ip_vs_wrr
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">modprobe -- ip_vs_sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">modprobe -- nf_conntrack
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 授权、运行、检查是否加载&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chmod &lt;span class="m">755&lt;/span> /etc/ipvsadm.rules &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> bash /etc/ipvsadm.rules &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> lsmod &lt;span class="p">|&lt;/span> grep -e ip_vs -e nf_conntrack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vim /etc/systemd/system/ipvsadm.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将启动内容拷贝&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Unit&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Description&lt;/span>&lt;span class="o">=&lt;/span>IPVS Load Balancer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">After&lt;/span>&lt;span class="o">=&lt;/span>network.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Service&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Type&lt;/span>&lt;span class="o">=&lt;/span>oneshot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>/bin/bash /etc/ipvsadm.rules
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStop&lt;/span>&lt;span class="o">=&lt;/span>/sbin/ipvsadm -C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">RemainAfterExit&lt;/span>&lt;span class="o">=&lt;/span>yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Install&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">WantedBy&lt;/span>&lt;span class="o">=&lt;/span>multi-user.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> ipvsadm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start ipvsadm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status ipvsadm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="关闭swap分区">关闭SWAP分区
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改完成后需要重启操作系统，如不重启，可临时关闭，命令为swapoff -a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 永远关闭swap分区，需要重启操作系统&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cat /etc/fstab&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># /dev/mapper/centos-swap swap swap defaults 0 0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在上一行中行首添加#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="docker准备">Docker准备
&lt;/h3>&lt;p>所有集群主机均需操作。
&lt;a class="link" href="https://docker.github.net.cn/engine/install/debian/#uninstall-docker-engine" target="_blank" rel="noopener"
>Debian安装docker官网参考&lt;/a>&lt;/p>
&lt;h4 id="卸载已安装decker">卸载已安装decker
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo apt-get purge docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm -rf /var/lib/docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm -rf /var/lib/containerd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="安装docker">安装docker
&lt;/h4>&lt;p>&lt;a class="link" href="https://developer.aliyun.com/mirror/docker-ce?spm=a2c6h.13651102.0.0.57e31b11LDVOCk" target="_blank" rel="noopener"
>阿里云docker源及安装配置参考&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># step 1: 安装必要的一些系统工具&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get -y install ca-certificates curl gnupg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># step 2: 信任 Docker 的 GPG 公钥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo install -m &lt;span class="m">0755&lt;/span> -d /etc/apt/keyrings
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/debian/gpg &lt;span class="p">|&lt;/span> sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo chmod a+r /etc/apt/keyrings/docker.gpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Step 3: 写入软件源信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="s2">&amp;#34;deb [arch=&lt;/span>&lt;span class="k">$(&lt;/span>dpkg --print-architecture&lt;span class="k">)&lt;/span>&lt;span class="s2"> signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.aliyun.com/docker-ce/linux/debian \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> &amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>. /etc/os-release &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$VERSION_CODENAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2">&amp;#34; stable&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> sudo tee /etc/apt/sources.list.d/docker.list &amp;gt; /dev/null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Step 4: 安装Docker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get -y install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="修改cgroup方式">修改cgroup方式
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在/etc/docker/daemon.json添加如下内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># cat /etc/docker/daemon.json&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;exec-opts&amp;#34;&lt;/span>: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;native.cgroupdriver=systemd&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 重启docker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl restart docker
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="安装cri-dockerd">安装cri-dockerd
&lt;/h4>&lt;p>&lt;a class="link" href="https://github.com/Mirantis/cri-dockerd/releases" target="_blank" rel="noopener"
>Releases · Mirantis/cri-dockerd&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 每个节点都安装&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.17/cri-dockerd_0.3.17.3-0.debian-bookworm_amd64.deb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dpkg -i cri-dockerd_0.3.17.3-0.debian-bookworm_amd64.deb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dpkg -l &lt;span class="p">|&lt;/span> grep cri-docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># vim /usr/lib/systemd/system/cri-docker.service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改第10行内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># --pod-infra-container-image：指定 Kubernetes 使用的 pause 容器镜像，确保 Pod 的基础功能正常运行。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># --container-runtime-endpoint：指定 cri-docker 与容器运行时的通信方式，确保 Kubernetes 能够管理容器。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>/usr/bin/cri-dockerd --pod-infra-container-image&lt;span class="o">=&lt;/span>registry.k8s.io/pause:3.9 --container-runtime-endpoint fd://
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start cri-docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> cri-docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status cri-docker
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="kubernetes-128x--集群部署">kubernetes 1.28.X 集群部署
&lt;/h3>&lt;h4 id="集群软件及版本说明">集群软件及版本说明
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>kubeadm&lt;/th>
&lt;th>kubelet&lt;/th>
&lt;th>kubectl&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>版本&lt;/td>
&lt;td>1.28.X&lt;/td>
&lt;td>1.28.X&lt;/td>
&lt;td>1.28.X&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>安装位置&lt;/td>
&lt;td>集群所有主机&lt;/td>
&lt;td>集群所有主机&lt;/td>
&lt;td>集群所有主机&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>作用&lt;/td>
&lt;td>初始化集群、管理集群等&lt;/td>
&lt;td>用于接收api-server指令，对pod生命周期进行管理&lt;/td>
&lt;td>集群应用命令行管理工具&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="阿里源安装集群软件">阿里源安装集群软件
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># debian 系统安装&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get update &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt-get install -y apt-transport-https
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -fsSL https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.28/deb/Release.key &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.28/deb/ /&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tee /etc/apt/sources.list.d/kubernetes.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install -y kubelet kubeadm kubectl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="配置kubelet">配置kubelet
&lt;/h4>&lt;p>为了实现docker使用的cgroupdriver与kubelet使用的cgroup的一致性，建议修改如下文件内容。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># vim /etc/sysconfig/kubelet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">KUBELET_EXTRA_ARGS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;--cgroup-driver=systemd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># debian 系统 /etc/default/kubelet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> kubelet
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="集群镜像准备">集群镜像准备
&lt;/h4>&lt;blockquote>
&lt;p>&lt;strong>必须科学上网，否则都是徒劳&lt;/strong>&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看要下载的镜像信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubeadm config images list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用下面的命令进行镜像下载&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubeadm config images pull --cri-socket unix:///var/run/cri-dockerd.sock
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="集群初始化">集群初始化
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubeadm init --kubernetes-version&lt;span class="o">=&lt;/span>v1.28.15 --pod-network-cidr&lt;span class="o">=&lt;/span>10.244.0.0/16 --apiserver-advertise-address&lt;span class="o">=&lt;/span>192.168.52.129 --cri-socket unix:///var/run/cri-dockerd.sock
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果不添加--cri-socket选项，则会报错，内容如下：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Found multiple CRI endpoints on the host. Please define which one do you wish to use by setting the &amp;#39;criSocket&amp;#39; field in the kubeadm configuration file: unix:///var/run/containerd/containerd.sock, unix:///var/run/cri-dockerd.sock&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># To see the stack trace of this error execute with --v=5 or higher&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置输出&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>init&lt;span class="o">]&lt;/span> Using Kubernetes version: v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Running pre-flight checks
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Pulling images required &lt;span class="k">for&lt;/span> setting up a Kubernetes cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> This might take a minute or two, depending on the speed of your internet connection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> You can also perform this action in beforehand using &lt;span class="s1">&amp;#39;kubeadm config images pull&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">W0504 12:48:00.026524 &lt;span class="m">2144&lt;/span> checks.go:835&lt;span class="o">]&lt;/span> detected that the sandbox image &lt;span class="s2">&amp;#34;registry.k8s.io/pause:3.8&amp;#34;&lt;/span> of the container runtime is inconsistent with that used by kubeadm. It is recommended that using &lt;span class="s2">&amp;#34;registry.k8s.io/pause:3.9&amp;#34;&lt;/span> as the CRI sandbox image.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Using certificateDir folder &lt;span class="s2">&amp;#34;/etc/kubernetes/pki&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;ca&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> apiserver serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local master01&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>10.96.0.1 192.168.52.129&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver-kubelet-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;front-proxy-ca&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;front-proxy-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/ca&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/server&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> etcd/server serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>localhost master01&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>192.168.52.129 127.0.0.1 ::1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/peer&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> etcd/peer serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>localhost master01&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>192.168.52.129 127.0.0.1 ::1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/healthcheck-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver-etcd-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;sa&amp;#34;&lt;/span> key and public key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Using kubeconfig folder &lt;span class="s2">&amp;#34;/etc/kubernetes&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;admin.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;kubelet.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;controller-manager.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;scheduler.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>etcd&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="nb">local&lt;/span> etcd in &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Using manifest folder &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-apiserver&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-controller-manager&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-scheduler&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Writing kubelet environment file with flags to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/kubeadm-flags.env&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Writing kubelet configuration to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/config.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Starting the kubelet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>wait-control-plane&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> the kubelet to boot up the control plane as static Pods from directory &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>. This can take up to 4m0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>apiclient&lt;span class="o">]&lt;/span> All control plane components are healthy after 21.505666 seconds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>upload-config&lt;span class="o">]&lt;/span> Storing the configuration used in ConfigMap &lt;span class="s2">&amp;#34;kubeadm-config&amp;#34;&lt;/span> in the &lt;span class="s2">&amp;#34;kube-system&amp;#34;&lt;/span> Namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet&lt;span class="o">]&lt;/span> Creating a ConfigMap &lt;span class="s2">&amp;#34;kubelet-config&amp;#34;&lt;/span> in namespace kube-system with the configuration &lt;span class="k">for&lt;/span> the kubelets in the cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>upload-certs&lt;span class="o">]&lt;/span> Skipping phase. Please see --upload-certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>mark-control-plane&lt;span class="o">]&lt;/span> Marking the node master01 as control-plane by adding the labels: &lt;span class="o">[&lt;/span>node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>mark-control-plane&lt;span class="o">]&lt;/span> Marking the node master01 as control-plane by adding the taints &lt;span class="o">[&lt;/span>node-role.kubernetes.io/control-plane:NoSchedule&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Using token: o4l5gb.8jem7v7x9upd376t
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow Node Bootstrap tokens to get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order &lt;span class="k">for&lt;/span> nodes to get long term certificate credentials
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow certificate rotation &lt;span class="k">for&lt;/span> all node client certificates in the cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Creating the &lt;span class="s2">&amp;#34;cluster-info&amp;#34;&lt;/span> ConfigMap in the &lt;span class="s2">&amp;#34;kube-public&amp;#34;&lt;/span> namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-finalize&lt;span class="o">]&lt;/span> Updating &lt;span class="s2">&amp;#34;/etc/kubernetes/kubelet.conf&amp;#34;&lt;/span> to point to a rotatable kubelet client certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>addons&lt;span class="o">]&lt;/span> Applied essential addon: CoreDNS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>addons&lt;span class="o">]&lt;/span> Applied essential addon: kube-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your Kubernetes control-plane has initialized successfully!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To start using your cluster, you need to run the following as a regular user:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mkdir -p &lt;span class="nv">$HOME&lt;/span>/.kube
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo cp -i /etc/kubernetes/admin.conf &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo chown &lt;span class="k">$(&lt;/span>id -u&lt;span class="k">)&lt;/span>:&lt;span class="k">$(&lt;/span>id -g&lt;span class="k">)&lt;/span> &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Alternatively, &lt;span class="k">if&lt;/span> you are the root user, you can run:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">export&lt;/span> &lt;span class="nv">KUBECONFIG&lt;/span>&lt;span class="o">=&lt;/span>/etc/kubernetes/admin.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You should now deploy a pod network to the cluster.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Run &lt;span class="s2">&amp;#34;kubectl apply -f [podnetwork].yaml&amp;#34;&lt;/span> with one of the options listed at:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> https://kubernetes.io/docs/concepts/cluster-administration/addons/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Then you can join any number of worker nodes by running the following on each as root:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubeadm join 192.168.52.129:6443 --token ghwg0j.hwc8l4o3h8j65le4 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --discovery-token-ca-cert-hash sha256:31ae1608dded0e8a442eaa653e52fc371f46bcbe3b047aa4a7a0a218d2601a50
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="集群应用客户端管理集群文件准备">集群应用客户端管理集群文件准备
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 根据提示执行命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># mkdir -p $HOME/.kube&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># cp -i /etc/kubernetes/admin.conf $HOME/.kube/config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># chown $(id -u):$(id -g) $HOME/.kube/config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># export KUBECONFIG=/etc/kubernetes/admin.conf&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="集群网络插件部署-calico">集群网络插件部署 calico
&lt;/h4>&lt;blockquote>
&lt;p>使用calico部署集群网络&lt;/p>
&lt;p>安装参考网址：&lt;a class="link" href="https://docs.tigera.io/calico/latest/getting-started/kubernetes/k8s-single-node" target="_blank" rel="noopener"
>Tutorial: Install Calico on single-host k8s cluster | Calico Documentation&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.0-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95master%E8%8A%82%E7%82%B9kubernetes%E9%9B%86%E7%BE%A4/image-calico%E5%AE%89%E8%A3%85.png"
width="2346"
height="1322"
srcset="https://caijemmy.github.io/p/1.0-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95master%E8%8A%82%E7%82%B9kubernetes%E9%9B%86%E7%BE%A4/image-calico%E5%AE%89%E8%A3%85_hu_fb582bdbf774394c.png 480w, https://caijemmy.github.io/p/1.0-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95master%E8%8A%82%E7%82%B9kubernetes%E9%9B%86%E7%BE%A4/image-calico%E5%AE%89%E8%A3%85_hu_7f9ae086208c15bd.png 1024w"
loading="lazy"
alt="image-calico安装"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="425px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 应用operator资源清单文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.30.0/manifests/tigera-operator.yaml&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 下载自定义资源文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># wget https://raw.githubusercontent.com/projectcalico/calico/v3.30.0/manifests/custom-resources.yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改文件第13行，修改为使用kubeadm init ----pod-network-cidr对应的IP地址段&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># vim custom-resources.yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">11&lt;/span> ipPools:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">12&lt;/span> - blockSize: &lt;span class="m">26&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">13&lt;/span> cidr: 10.244.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">14&lt;/span> encapsulation: VXLANCrossSubnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 应用资源清单文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl create -f custom-resources.yaml&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 监视calico-sysem命名空间中pod运行情况&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># watch kubectl get pods -n calico-system&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>Wait until each pod has the &lt;code>STATUS&lt;/code> of &lt;code>Running&lt;/code>.&lt;/p>
&lt;p>1、科学上网很重要&lt;/p>
&lt;p>2、重启虚机，重启主机，科学上网断开重连&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 已经全部运行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods -n calico-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-kube-controllers-789b9578b6-296xf 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d21h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-node-hrqlr 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-node-l7dhd 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-node-vll2x 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-typha-5dd4d5c669-49svd 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-typha-5dd4d5c669-7mcsb 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-node-driver-fcx7c 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d19h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-node-driver-gwsql 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d21h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-node-driver-qlx46 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d19h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">goldmane-8456f8bf4d-vdc4h 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d21h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">whisker-594579fbdd-dtbjt 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="集群工作节点添加">集群工作节点添加
&lt;/h4>&lt;blockquote>
&lt;p>因容器镜像下载较慢，可能会导致报错，主要错误为没有准备好cni（集群网络插件），如有网络，请耐心等待即可。&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-worker01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubeadm join 192.168.52.129:6443 --token ghwg0j.hwc8l4o3h8j65le4 \&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --discovery-token-ca-cert-hash sha256:31ae1608dded0e8a442eaa653e52fc371f46bcbe3b047aa4a7a0a218d2601a50
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-worker02 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubeadm join 192.168.52.129:6443 --token ghwg0j.hwc8l4o3h8j65le4 \&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --discovery-token-ca-cert-hash sha256:31ae1608dded0e8a442eaa653e52fc371f46bcbe3b047aa4a7a0a218d2601a50
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="验证集群可用性">验证集群可用性
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看所有的节点&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get nodes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 Ready control-plane 2d22h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 Ready &amp;lt;none&amp;gt; 2d19h v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 Ready &amp;lt;none&amp;gt; 2d19h v1.28.15
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看集群健康情况&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get cs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: v1 ComponentStatus is deprecated in v1.19+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS MESSAGE ERROR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">controller-manager Healthy ok
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scheduler Healthy ok
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-0 Healthy ok
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看kubernetes集群pod运行情况&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods -n kube-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-gbgsh 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-pm85d 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-k8s-master01 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-apiserver-k8s-master01 1/1 Running &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-controller-manager-k8s-master01 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-h7s9b 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-qt8px 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-wlvrg 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-scheduler-k8s-master01 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 再次查看calico-system命名空间中pod运行情况。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods -n calico-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-kube-controllers-789b9578b6-296xf 1/1 Running &lt;span class="m">11&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-node-hrqlr 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-node-l7dhd 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-node-vll2x 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-typha-5dd4d5c669-49svd 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-typha-5dd4d5c669-7mcsb 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-node-driver-fcx7c 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d19h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-node-driver-gwsql 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">csi-node-driver-qlx46 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d19h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">goldmane-8456f8bf4d-vdc4h 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d22h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">whisker-594579fbdd-dtbjt 2/2 Running &lt;span class="m">10&lt;/span> &lt;span class="o">(&lt;/span>21h ago&lt;span class="o">)&lt;/span> 2d14h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="环境准备过程中问题排查">环境准备过程中问题排查
&lt;/h2>&lt;h3 id="ip地址配置的问题">IP地址配置的问题
&lt;/h3>&lt;p>&lt;strong>/etc/network/interfaces 这个下面不要做配置，不生效.&lt;/strong>&lt;/p>
&lt;p>使用界面做的配置
Debian 12 默认使用 NetworkManager 或 systemd-networkd 管理网络，而不是传统的 ifupdown 工具。
如果 NetworkManager 或 systemd-networkd 正在管理网络接口，/etc/network/interfaces 的配置会被忽略。&lt;/p>
&lt;p>以下是排查过程
NetworkManager 正在管理该接口&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@master01:~# nmcli device status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DEVICE TYPE STATE CONNECTION
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ens33 ethernet connected Wired connection &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lo loopback connected &lt;span class="o">(&lt;/span>externally&lt;span class="o">)&lt;/span> lo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看 systemd-networkd 是否启用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@master01:~# systemctl status systemd-networkd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">○ systemd-networkd.service - Network Configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Loaded: loaded &lt;span class="o">(&lt;/span>/lib/systemd/system/systemd-networkd.service&lt;span class="p">;&lt;/span> disabled&lt;span class="p">;&lt;/span> preset: enabled&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Active: inactive &lt;span class="o">(&lt;/span>dead&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TriggeredBy: ○ systemd-networkd.socket
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Docs: man:systemd-networkd.service&lt;span class="o">(&lt;/span>8&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> man:org.freedesktop.network1&lt;span class="o">(&lt;/span>5&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="虚机重启后ipvs和br_netfilter未被加载">虚机重启后，ipvs和br_netfilter未被加载
&lt;/h3>&lt;p>虚机重启后，需要重新加载&lt;code>br_netfilter&lt;/code>模块。&lt;/p>
&lt;p>将 modprobe &amp;ndash; br_netfilter 命令加入到 /etc/ipvsadm.rules&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">vim /etc/systemd/system/ipvsadm.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将启动内容拷贝&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Unit&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Description&lt;/span>&lt;span class="o">=&lt;/span>IPVS Load Balancer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">After&lt;/span>&lt;span class="o">=&lt;/span>network.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Service&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Type&lt;/span>&lt;span class="o">=&lt;/span>oneshot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 启动时不能执行这条命令：/sbin/ipvsadm-restore &amp;lt; /etc/ipvsadm.rules&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 应该使用bash执行相应的规则文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>/bin/bash /etc/ipvsadm.rules
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStop&lt;/span>&lt;span class="o">=&lt;/span>/sbin/ipvsadm -C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">RemainAfterExit&lt;/span>&lt;span class="o">=&lt;/span>yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Install&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">WantedBy&lt;/span>&lt;span class="o">=&lt;/span>multi-user.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="error-cri-container-runtime-is-not-running">[ERROR CRI]: container runtime is not running
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 初始化时报这个错&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>init&lt;span class="o">]&lt;/span> Using Kubernetes version: v1.28.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Running pre-flight checks
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">error execution phase preflight: &lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Some fatal errors occurred:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span>ERROR CRI&lt;span class="o">]&lt;/span>: container runtime is not running: output: &lt;span class="nv">time&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;2025-05-04T11:52:11-04:00&amp;#34;&lt;/span> &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>fatal &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;validate service connection: validate CRI v1 runtime API for endpoint \&amp;#34;unix:///var/run/containerd/containerd.sock\&amp;#34;: rpc error: code = Unimplemented desc = unknown service runtime.v1.RuntimeService&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">, error: &lt;span class="nb">exit&lt;/span> status &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span>ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables&lt;span class="o">]&lt;/span>: /proc/sys/net/bridge/bridge-nf-call-iptables does not exist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> If you know what you are doing, you can make a check non-fatal with &lt;span class="sb">`&lt;/span>--ignore-preflight-errors&lt;span class="o">=&lt;/span>...&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To see the stack trace of this error execute with --v&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span> or higher
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>排查过程及解决方法，内核转发及网桥过滤模块没有加载，统一在&lt;code>主机配置 &amp;gt; 安装ipset及ipvsadm&lt;/code>步骤进行优化了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 解决容器运行时问题&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (1) 检查 containerd.md 是否已安装并运行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行以下命令检查 containerd.md 的状态：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status containerd.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (2) 验证 containerd.md 配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 确保 containerd.md 的配置文件（通常位于 /etc/containerd.md/config.toml）正确配置了 CRI（容器运行时接口）。运行以下命令生成默认配置（如果配置文件不存在）：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo containerd.md config default &lt;span class="p">|&lt;/span> sudo tee /etc/containerd.md/config.toml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (3) 重启 containerd.md&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改配置后，重启 containerd.md：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl restart containerd.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (4) 验证 containerd.md 是否支持 CRI&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行以下命令验证 containerd.md 是否支持 CRI：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ctr version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果输出显示版本信息，说明 containerd.md 已正确配置。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 解决 /proc/sys/net/bridge/bridge-nf-call-iptables 问题&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (1) 加载 br_netfilter 内核模块&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行以下命令加载 br_netfilter 模块：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo modprobe br_netfilter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (2) 确保模块已加载&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行以下命令检查模块是否已加载：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lsmod &lt;span class="p">|&lt;/span> grep br_netfilter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果输出显示 br_netfilter，说明模块已加载。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (3) 确保 /proc/sys/net/bridge/bridge-nf-call-iptables 存在&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 运行以下命令检查文件是否存在：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat /proc/sys/net/bridge/bridge-nf-call-iptables
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果文件不存在，可能是内核未正确配置。可以手动创建并设置值：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="p">|&lt;/span> sudo tee /proc/sys/net/bridge/bridge-nf-call-iptables
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># (4) 永久生效&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 为了确保每次重启后配置仍然有效，编辑 /etc/sysctl.conf 文件：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo vim /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 添加以下内容：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-iptables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.bridge.bridge-nf-call-ip6tables &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 保存并退出，然后应用配置：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sysctl --system
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="kubectl-get-pods-状态未running">kubectl get pods 状态未Running
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl describe pod calico-apiserver-5b9b48d497-5ck29 -n calico-apiserver&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network is not ready: container runtime network not ready: &lt;span class="nv">NetworkReady&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span> reason:NetworkPluginNotReady message:docker: network plugin is not ready: cni config uninitialized
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 这个目录下没有配置文件，说明没有安装 CNI&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ls /etc/cni/net.d/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://docs.projectcalico.org/manifests/calico.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改配置文件中的这个配置项&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- name: CALICO_IPV4POOL_CIDR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> value: &lt;span class="s2">&amp;#34;10.244.0.0/16&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl apply -f calico.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>1.1 Kubernetes集群UI及主机资源监控</title><link>https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/</link><pubDate>Mon, 22 Jul 2024 00:00:00 +0000</pubDate><guid>https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/</guid><description>&lt;img src="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/cover.jpg" alt="Featured image of post 1.1 Kubernetes集群UI及主机资源监控" />&lt;h1 id="kubernetes集群ui及主机资源监控">Kubernetes集群UI及主机资源监控
&lt;/h1>&lt;h2 id="kubernetes-dashboard作用">Kubernetes dashboard作用
&lt;/h2>&lt;ul>
&lt;li>通过dashboard能够直观了解Kubernetes集群中运行的资源对象&lt;/li>
&lt;li>通过dashboard可以直接管理（创建、删除、重启等操作）资源对象&lt;/li>
&lt;/ul>
&lt;h2 id="安装kubernetes-dashboard">安装kubernetes dashboard
&lt;/h2>&lt;p>&lt;a class="link" href="https://github.com/kubernetes/dashboard/blob/master/README.md" target="_blank" rel="noopener"
>参考链接：master的 dashboard/README.md ·kubernetes/dashboard&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener"
>helm参考链接：Helm | Installing Helm&lt;/a>&lt;/p>
&lt;h3 id="通过helm工具安装kubernetes-dashboard">通过helm工具安装kubernetes dashboard
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装helm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl https://baltocdn.com/helm/signing.asc &lt;span class="p">|&lt;/span> gpg --dearmor &lt;span class="p">|&lt;/span> sudo tee /usr/share/keyrings/helm.gpg &amp;gt; /dev/null
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install apt-transport-https --yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;deb [arch=&lt;/span>&lt;span class="k">$(&lt;/span>dpkg --print-architecture&lt;span class="k">)&lt;/span>&lt;span class="s2"> signed-by=/usr/share/keyrings/helm.gpg] https://baltocdn.com/helm/stable/debian/ all main&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> sudo tee /etc/apt/sources.list.d/helm-stable-debian.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install helm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">helm version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 依赖科学上网&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Add kubernetes-dashboard repository&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;kubernetes-dashboard&amp;#34;&lt;/span> has been added to your repositories
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Deploy a Helm Release named &amp;#34;kubernetes-dashboard&amp;#34; using the kubernetes-dashboard chart&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># helm upgrade --install kubernetes-dashboard kubernetes-dashboard/kubernetes-dashboard --create-namespace --namespace kubernetes-dashboard&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="命令执行后的回显">命令执行后的回显
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">Release &lt;span class="s2">&amp;#34;kubernetes-dashboard&amp;#34;&lt;/span> does not exist. Installing it now.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME: kubernetes-dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LAST DEPLOYED: Thu May &lt;span class="m">15&lt;/span> 04:25:22 &lt;span class="m">2025&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE: kubernetes-dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STATUS: deployed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REVISION: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TEST SUITE: None
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NOTES:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*** PLEASE BE PATIENT: Kubernetes Dashboard may need a few minutes to get up and become ready ***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Congratulations! You have just installed Kubernetes Dashboard in your cluster.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To access Dashboard run:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NOTE: In &lt;span class="k">case&lt;/span> port-forward &lt;span class="nb">command&lt;/span> does not work, make sure that kong service name is correct.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Check the services in Kubernetes Dashboard namespace using:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kubectl -n kubernetes-dashboard get svc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Dashboard will be available at:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> https://localhost:8443
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="查看服务是否已启动">查看服务是否已启动
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">watch kubectl get pods -n kubernetes-dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 等待所有服务都为Running状态&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 可以使用下面的命令查看具体的情况，注意观察Events:中d&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># kubectl describe pods kubernetes-dashboard-api-7bcbc9b5bd-l76bc -n kubernetes-dashboard&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ImagePullBackOff 错误后，重新启动步骤如下&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1、将副本数缩放到 0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl scale deployment kubernetes-dashboard-auth --replicas&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> -n kubernetes-dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2、将副本数恢复到 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl scale deployment kubernetes-dashboard-auth --replicas&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> -n kubernetes-dashboard
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="浏览器localhost访问">浏览器localhost访问
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Forwarding from 127.0.0.1:8443 -&amp;gt; &lt;span class="m">8443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Forwarding from &lt;span class="o">[&lt;/span>::1&lt;span class="o">]&lt;/span>:8443 -&amp;gt; &lt;span class="m">8443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Handling connection &lt;span class="k">for&lt;/span> &lt;span class="m">8443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Handling connection &lt;span class="k">for&lt;/span> &lt;span class="m">8443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">E0515 07:19:42.893297 &lt;span class="m">73613&lt;/span> portforward.go:409&lt;span class="o">]&lt;/span> an error occurred forwarding &lt;span class="m">8443&lt;/span> -&amp;gt; 8443: error forwarding port &lt;span class="m">8443&lt;/span> to pod 161802690a0f8d6f42e5761323b2aafa46ff37baf8eba8e44675e0ef760f08b7, uid : unable to &lt;span class="k">do&lt;/span> port forwarding: socat not found
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上日志说明环境缺少 &lt;code>socat&lt;/code> ，安装之&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install socat
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>登录界面&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2.png"
width="1280"
height="800"
srcset="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2_hu_32019b034cfb1023.png 480w, https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2_hu_ceb0460a338b8919.png 1024w"
loading="lazy"
alt="image-dashboard登录界面"
class="gallery-image"
data-flex-grow="160"
data-flex-basis="384px"
>&lt;/p>
&lt;p>查看&lt;code>kubernetes-dashboard&lt;/code>下的账户&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl -n kubernetes-dashboard get serviceaccounts
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>创建账户&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl -n kubernetes-dashboard create serviceaccount kubernetes-dashboard&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">serviceaccount/kubernetes-dashboard created
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>绑定角色权限&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl create clusterrolebinding kubernetes-dashboard-admin &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --clusterrole&lt;span class="o">=&lt;/span>cluster-admin &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --serviceaccount&lt;span class="o">=&lt;/span>kubernetes-dashboard:kubernetes-dashboard
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>生成 Token&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl -n kubernetes-dashboard create token kubernetes-dashboard
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>通过token成功访问&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F.png"
width="1280"
height="800"
srcset="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F_hu_e8e00ccab3a97dc6.png 480w, https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F_hu_ef3201ce50efd574.png 1024w"
loading="lazy"
alt="image-dashboard登录成功"
class="gallery-image"
data-flex-grow="160"
data-flex-basis="384px"
>&lt;/p>
&lt;h3 id="浏览器节点访问">浏览器节点访问
&lt;/h3>&lt;p>&lt;strong>检查 NodePort 服务配置&lt;/strong>&lt;/p>
&lt;p>确保 &lt;code>kubernetes-dashboard&lt;/code> 服务已正确配置为 &lt;code>NodePort&lt;/code>，并且端口范围在 &lt;code>30000-32767&lt;/code> 之间。&lt;/p>
&lt;p>&lt;strong>检查服务配置&lt;/strong>&lt;/p>
&lt;p>运行以下命令，查看服务的配置：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl -n kubernetes-dashboard get svc kubernetes-dashboard-kong-proxy -o yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>确认以下字段：&lt;/p>
&lt;ul>
&lt;li>&lt;code>spec.type&lt;/code> 应为 &lt;code>NodePort&lt;/code>。&lt;/li>
&lt;li>&lt;code>spec.ports[0].nodePort&lt;/code> 应为 &lt;code>32000&lt;/code>。&lt;/li>
&lt;/ul>
&lt;p>如果配置不正确，可以通过以下命令更新：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl -n kubernetes-dashboard patch svc kubernetes-dashboard-kong-proxy -p &lt;span class="s1">&amp;#39;{&amp;#34;spec&amp;#34;:{&amp;#34;type&amp;#34;:&amp;#34;NodePort&amp;#34;,&amp;#34;ports&amp;#34;:[{&amp;#34;port&amp;#34;:443,&amp;#34;targetPort&amp;#34;:8443,&amp;#34;nodePort&amp;#34;:32000}]}}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>获取节点 IP&lt;/strong>
运行以下命令，获取节点的 IP 地址：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl get nodes -o wide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用 EXTERNAL-IP 或 INTERNAL-IP 访问 Dashboard。&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>生成 Token&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl -n kubernetes-dashboard create token kubernetes-dashboard
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>通过token成功访问&lt;/p>
&lt;p>&lt;img src="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E8%8A%82%E7%82%B9%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F.png"
width="3000"
height="1754"
srcset="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E8%8A%82%E7%82%B9%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F_hu_341505ebf277ed9.png 480w, https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E8%8A%82%E7%82%B9%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F_hu_488d6754384e9d4b.png 1024w"
loading="lazy"
alt="image-dashboard节点登录成功"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="410px"
>&lt;/p>
&lt;h2 id="安装metrics-server">安装metrics-server
&lt;/h2>&lt;p>使用metrics-server实现主机资源监控，它可以解决的问题：解决上图中CPU和内存使用情况的获取&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/kubernetes-sigs/metrics-server/releases" target="_blank" rel="noopener"
>资源参考链接：Releases · kubernetes-sigs/metrics-server&lt;/a>&lt;/p>
&lt;h3 id="通过配置文件进行安装">通过配置文件进行安装
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 下载资源安装配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.7.2/components.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 因为在使用 metrics-server 过程中没有创建证书，所以添加非安全的tls配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - args:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - --cert-dir&lt;span class="o">=&lt;/span>/tmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - --secure-port&lt;span class="o">=&lt;/span>&lt;span class="m">10250&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - --kubelet-preferred-address-types&lt;span class="o">=&lt;/span>InternalIP,ExternalIP,Hostname
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - --kubelet-use-node-status-port
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - --metric-resolution&lt;span class="o">=&lt;/span>15s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - --kubelet-insecure-tls &lt;span class="c1"># 这一行为添加内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装之&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl apply -f components.yaml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">serviceaccount/metrics-server created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io/system:metrics-server created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrolebinding.rbac.authorization.k8s.io/system:metrics-server created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/metrics-server created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps/metrics-server created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="验证及授权">验证及授权
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl get pods -n kube-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-gbgsh 1/1 Running &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-pm85d 1/1 Running &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-k8s-master01 1/1 Running &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-apiserver-k8s-master01 1/1 Running &lt;span class="m">13&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-controller-manager-k8s-master01 1/1 Running &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-h7s9b 1/1 Running &lt;span class="m">6&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-qt8px 1/1 Running &lt;span class="m">6&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-wlvrg 1/1 Running &lt;span class="m">6&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-scheduler-k8s-master01 1/1 Running &lt;span class="m">12&lt;/span> &lt;span class="o">(&lt;/span>4h11m ago&lt;span class="o">)&lt;/span> 3d8h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metrics-server-596474b58-697f8 1/1 Running &lt;span class="m">0&lt;/span> 102s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl top pods -n kube-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME CPU&lt;span class="o">(&lt;/span>cores&lt;span class="o">)&lt;/span> MEMORY&lt;span class="o">(&lt;/span>bytes&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-gbgsh 2m 22Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coredns-5dd5756b68-pm85d 2m 51Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">etcd-k8s-master01 19m 128Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-apiserver-k8s-master01 42m 532Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-controller-manager-k8s-master01 11m 115Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-h7s9b 1m 59Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-qt8px 1m 50Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-proxy-wlvrg 1m 52Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-scheduler-k8s-master01 3m 49Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metrics-server-596474b58-697f8 2m 22Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@k8s-master01 ~/dashboard&lt;span class="o">]&lt;/span>&lt;span class="c1"># kubectl top nodes -n kube-system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME CPU&lt;span class="o">(&lt;/span>cores&lt;span class="o">)&lt;/span> CPU% MEMORY&lt;span class="o">(&lt;/span>bytes&lt;span class="o">)&lt;/span> MEMORY%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-master01 131m 3% 4385Mi 86%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker01 41m 1% 2149Mi 76%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">k8s-worker02 45m 1% 2241Mi 79%
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5.png"
width="3000"
height="1754"
srcset="https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5_hu_77352025d40cb66b.png 480w, https://caijemmy.github.io/p/1.1-kubernetes%E9%9B%86%E7%BE%A4ui%E5%8F%8A%E4%B8%BB%E6%9C%BA%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7/image-dashboard%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5_hu_cd4bf98a45e82224.png 1024w"
loading="lazy"
alt="image-dashboard资源使用情况"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="410px"
>&lt;/p></description></item></channel></rss>